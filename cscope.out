cscope 15 $HOME/betweenness_centrality/utexas_modified/May_2016/Dev_1 -q 0000001312 0000185582
	@BorderVertMapping.h

22 
	sBÜd”ToV”‹x


24 
	mv”‹xID
;

29 
	sV”‹xToBÜd”


31 
	mbÜd”ID
;

37 
	sBÜd”V”txM­pšg


41 
	m£qNum
=0;

42 
	mnumV”tiûs
;

43 
	mnumBÜd”s
;

47 
V”‹xToBÜd”
 * 
	mv”‹xToBÜd”
;

48 
BÜd”ToV”‹x
 * 
	mbÜd”ToV”‹x
;

51 
BÜd”V”txM­pšg
 (
numV”tiûs
, 
numBÜd”s
);

52 ~
BÜd”V”txM­pšg
();

55 
g‘V”‹xID
Ğ
bÜd”ID
 );

56 
g‘BÜd”ID
Ğ
v”‹xID
 );

59 
£tV”‹xIDToBÜd”
Ğ
v”‹xID
, 
bÜd”ID
 );

60 
£tBÜd”IDToV”‹x
Ğ
v”‹xID
, 
bÜd”ID
 );

64 
	gBÜd”V”‹xM­pšg
::
	$BÜd”V”txM­pšg
Ğ
numV”tiûs
, 
numBÜd”s
, *
bÜd”
 )

67 
this
.
numV”tiûs
 =‚umVertices;

68 
this
.
numBÜd”s
 =‚umBorders

73 
this
.
v”‹xToBÜd”
 = ( 
V”‹xToBÜd”
 * ) 
	`m®loc
 ( 
numV”tiûs
 * ( VertexToBorder ) );

74 
this
.
bÜd”ToV”‹x
 = ( 
BÜd”ToV”‹x
 * ) 
	`m®loc
 ( 
numBÜd”s
 * ( BorderToVertex ) );

81  
i
 = 0; i < 
numV”tiûs
; i++ )

85 ifĞ
bÜd”
[ 
i
 ] != 0 )

87 
v”‹xToBÜd”
[
i
].
bÜd”ID
 = 
£qNum
;

88 
bÜd”ToV”‹x
[
£qNUM
].
v”‹xID
 = 
i
;

89 ++
£qNum
;

93 
v”‹xToBÜd”
[
i
].
bÜd”ID
 = -1;

96 
	}
}

98 
	gBÜd”V”‹xM­pšg
::~
	$BÜd”V”txM­pšg
()

100 
	`ä“
Ğ
this
.
v”‹xToBÜd”
 )

101 
	`ä“
Ğ
this
.
bÜd”ToV”‹x
 )

102 
	}
}

104 
BÜd”V”‹xM­pšg
::
	$g‘V”‹xID
Ğ
bÜd”ID
 )

106 Ğ
this
.
bÜd”ToV”‹x
[
bÜd”ID
].
v”‹xID
 );

107 
	}
}

109 
	gBÜd”V”‹xM­pšg
::
	$g‘BÜd”ID
Ğ
v”‹xID
 )

111 Ğ
this
.
v”‹xToBÜd”
[
v”‹xID
].
bÜd”ID
 );

112 
	}
}

114 
	gBÜd”V”‹xM­pšg
::
	$£tV”‹xIDToBÜd”
Ğ
v”‹xID
, 
bÜd”ID
 )

116 
this
.
bÜd”ToV”‹x
[
bÜd”ID
].
v”‹xID
 = vertexID;

117 
	}
}

119 
	gBÜd”V”‹xM­pšg
::
	$£tBÜd”IDToV”‹x
Ğ
v”‹xID
, vertexID )

121 
this
.
v”‹xToBÜd”
[
v”‹xID
].
bÜd”ID
 = borderID;

122 
	}
}

	@EMS_x86_64.h

6 
	~<¡dšt.h
>

7 
	~<as£¹.h
>

9 #iâdeà
EMS_X86_64_H


10 
	#EMS_X86_64_H


	)

12 
	#TAKEN
(
boŞ
è
	`__butš_ex³ù
((boŞ),1)

	)

14 
__šlše
 

15 
	$·u£
(*
mem_loc
) {

16 
__asm__
 
	`__vŞ©e__
 ("pause");

18 
	}
}

26 vŞ©
	tšt64_t
 
	tsync_št64_t
;

29 cÚ¡ 
št64_t
 
	gem±y_v®_I8
 = (int64_t)0x8000000000000000ULL;

33 
__šlše
 
št64_t


34 
	$»adFE_I8
(
sync_št64_t
 *
mem_loc
) {

35 
št64_t
 
»t_v®
;

36 
	`__butš_´eãtch
((*)
mem_loc
,1,3);

38  
	`·u£
((*)
mem_loc
) )

39 ifĞ
	`TAKEN
(
em±y_v®_I8
 !ğ(
»t_v®
 = *
mem_loc
)) )

41 iàĞ
	`TAKEN
(
	`__sync_boŞ_com·»_ªd_sw­
(
mem_loc
,
»t_v®
,
em±y_v®_I8
)) )

45  
»t_v®
;

46 
	}
}

50 
__šlše
 
št64_t


51 
	$»adFF_I8
(
sync_št64_t
 *
mem_loc
) {

52 
št64_t
 
»t_v®
;

53 
	`__butš_´eãtch
((*)
mem_loc
,1,3);

54  
	`·u£
((*)
mem_loc
) )

55 iàĞ
	`TAKEN
(
em±y_v®_I8
 !ğ(
»t_v®
 = *
mem_loc
)) )

57  
»t_v®
;

58 
	}
}

62 
__šlše
 
št64_t


63 
	$»adXX_I8
(
sync_št64_t
 *
mem_loc
)

64 {  *
mem_loc
; 
	}
}

68 
__šlše
 

69 
	$wr™eEF_I8
(
sync_št64_t
 *
mem_loc
, 
št64_t
 
mem_v®
) {

70 
	`as£¹
(
em±y_v®_I8
 !ğ
mem_v®
);

71 
	`__butš_´eãtch
((*)
mem_loc
,1,3);

72  
	`·u£
((*)
mem_loc
) )

73 ifĞ
	`TAKEN
(
	`__sync_boŞ_com·»_ªd_sw­
(
mem_loc
,
em±y_v®_I8
,
mem_v®
)) )

77 
	}
}

81 
__šlše
 

82 
	$wr™eFF_I8
(
sync_št64_t
 *
mem_loc
, 
št64_t
 
mem_v®
) {

83 
št64_t
 
»t_v®
;

84 
	`as£¹
(
em±y_v®_I8
 !ğ
mem_v®
);

85 
	`__butš_´eãtch
((*)
mem_loc
,1,3);

87  
	`·u£
((*)
mem_loc
) )

88 iàĞ
	`TAKEN
(
em±y_v®_I8
 !ğ(
»t_v®
 = *
mem_loc
)) )

90 iàĞ
	`TAKEN
(
	`__sync_boŞ_com·»_ªd_sw­
(
mem_loc
,
»t_v®
,
mem_v®
)) )

95 
	}
}

99 
__šlše
 

100 
	$wr™eXF_I8
(
sync_št64_t
 *
mem_loc
, 
št64_t
 
mem_v®
)

101 { 
	`as£¹
(
em±y_v®_I8
 !ğ
mem_v®
); *
mem_loc
 = mem_v®; ; 
	}
}

105 
__šlše
 

106 
	$»£t_I8
(
sync_št64_t
 *
mem_loc
)

107 { *
mem_loc
 = 
em±y_v®_I8
; ; 
	}
}

111 
__šlše
 

112 
	$isFuÎ_I8
(
sync_št64_t
 *
mem_loc
)

113 {  (
em±y_v®_I8
 !ğ*
mem_loc
); 
	}
}

116 vŞ©
	tšt32_t
 
	tsync_št32_t
;

120 vŞ©
	tušt32_t
 
	tsync_ušt32_t
;

123 cÚ¡ 
št32_t
 
	gem±y_v®_I4
 = (int32_t)0x8000000UL;

125 cÚ¡ 
ušt32_t
 
	gem±y_v®_UI4
 = (uint32_t)0xFFFFFFFFUL;

129 
__šlše
 
št32_t


130 
	$»adFE_I4
(
sync_št32_t
 *
mem_loc
) {

131 
št32_t
 
»t_v®
;

132 
	`__butš_´eãtch
((*)
mem_loc
,1,3);

134  
	`·u£
((*)
mem_loc
) )

135 ifĞ
	`TAKEN
(
em±y_v®_I4
 !ğ(
»t_v®
 = *
mem_loc
)) )

137 iàĞ
	`TAKEN
(
	`__sync_boŞ_com·»_ªd_sw­
(
mem_loc
,
»t_v®
,
em±y_v®_I4
)) )

141  
»t_v®
;

142 
	}
}

144 
__šlše
 
ušt32_t


145 
	$»adFE_UI4
(
sync_ušt32_t
 *
mem_loc
) {

146 
ušt32_t
 
»t_v®
;

147 
	`__butš_´eãtch
((*)
mem_loc
,1,3);

149  
	`·u£
((*)
mem_loc
) )

150 ifĞ
	`TAKEN
(
em±y_v®_UI4
 !ğ(
»t_v®
 = *
mem_loc
)) )

152 iàĞ
	`TAKEN
(
	`__sync_boŞ_com·»_ªd_sw­
(
mem_loc
,
»t_v®
,
em±y_v®_UI4
)) )

156  
»t_v®
;

157 
	}
}

161 
__šlše
 
št32_t


162 
	$»adFF_I4
(
sync_št32_t
 *
mem_loc
) {

163 
št32_t
 
»t_v®
;

164 
	`__butš_´eãtch
((*)
mem_loc
,1,3);

165  
	`·u£
((*)
mem_loc
) )

166 iàĞ
	`TAKEN
(
em±y_v®_I4
 !ğ(
»t_v®
 = *
mem_loc
)) )

168  
»t_v®
;

169 
	}
}

173 
__šlše
 
št32_t


174 
	$»adXX_I4
(
sync_št32_t
 *
mem_loc
)

175 {  *
mem_loc
; 
	}
}

179 
__šlše
 

180 
	$wr™eEF_I4
(
sync_št32_t
 *
mem_loc
, 
št32_t
 
mem_v®
) {

181 
	`as£¹
(
em±y_v®_I4
 !ğ
mem_v®
);

182 
	`__butš_´eãtch
((*)
mem_loc
,1,3);

183  
	`·u£
((*)
mem_loc
) )

184 ifĞ
	`TAKEN
(
	`__sync_boŞ_com·»_ªd_sw­
(
mem_loc
,
em±y_v®_I4
,
mem_v®
)) )

188 
	}
}

190 
__šlše
 

191 
	$wr™eEF_UI4
(
sync_ušt32_t
 *
mem_loc
, 
ušt32_t
 
mem_v®
) {

192 
	`as£¹
(
em±y_v®_UI4
 !ğ
mem_v®
);

193 
	`__butš_´eãtch
((*)
mem_loc
,1,3);

194  
	`·u£
((*)
mem_loc
) )

195 ifĞ
	`TAKEN
(
	`__sync_boŞ_com·»_ªd_sw­
(
mem_loc
,
em±y_v®_UI4
,
mem_v®
)) )

199 
	}
}

203 
__šlše
 

204 
	$wr™eFF_I4
(
sync_št32_t
 *
mem_loc
, 
št32_t
 
mem_v®
) {

205 
št32_t
 
»t_v®
;

206 
	`as£¹
(
em±y_v®_I4
 !ğ
mem_v®
);

207 
	`__butš_´eãtch
((*)
mem_loc
,1,3);

209  
	`·u£
((*)
mem_loc
) )

210 iàĞ
	`TAKEN
(
em±y_v®_I4
 !ğ(
»t_v®
 = *
mem_loc
)) )

212 iàĞ
	`TAKEN
(
	`__sync_boŞ_com·»_ªd_sw­
(
mem_loc
,
»t_v®
,
mem_v®
)) )

217 
	}
}

221 
__šlše
 

222 
	$wr™eXF_I4
(
sync_št32_t
 *
mem_loc
, 
št32_t
 
mem_v®
)

223 { 
	`as£¹
(
em±y_v®_I4
 !ğ
mem_v®
); *
mem_loc
 = mem_v®; ; 
	}
}

227 
__šlše
 

228 
	$»£t_I4
(
sync_št32_t
 *
mem_loc
)

229 { *
mem_loc
 = 
em±y_v®_I4
; ; 
	}
}

233 
__šlše
 

234 
	$isFuÎ_I4
(
sync_št32_t
 *
mem_loc
)

235 {  (
em±y_v®_I4
 !ğ*
mem_loc
); 
	}
}

	@PartitionVertexMapping.h

12 
	sG¿phToP¬t™iÚVID


14 
	m·¹™iÚVID
;

17 
	sP¬t™iÚToG¿phVID


19 
	mg¿phVID
;

22 
	sP¬t™iÚV”‹xM­pšg


24 
G¿phToP¬t™iÚVID
 *
	mg¿phToP¬t™iÚVID
;

25 
P¬t™iÚToG¿phVID
 **
	m·¹™iÚToG¿phVID
;

33 
P¬t™iÚV”‹xM­pšg
Ğ
numP¬ts
, *
nodeCouÁ
, *
bÜd”CouÁ
, *
·¹
, 
numG¿phNodes
 );

34 ~
P¬t™iÚV”‹xM­pšg
();

35 
g‘G¿phV”‹xID
Ğ
·¹™iÚV”‹xID
, 
·¹™iÚID
 );

36 
g‘P¬t™iÚV”‹xID
Ğ
g¿phV”‹xID
 );

39 
	gP¬t™iÚV”‹xM­pšg
::
	$P¬t™iÚV”‹xM­pšg
Ğ
numP¬ts
, *
nodeCouÁ
, *
bÜd”CouÁ
, *
·¹
, 
numG¿phNodes
 )

42 
this
.
g¿phToP¬t™iÚVID
 = (
G¿phToP¬t™iÚVID
 *è
	`m®loc
((G¿phToP¬t™iÚVID)*
numG¿phNodes
);

43 
this
.
·¹™iÚToG¿phVID
 = (
P¬t™iÚToG¿phVID
 **è
	`m®loc
((P¬t™iÚToG¿phVID *è* 
numP¬ts
);

46 
·¹™iÚSeqNum
 [
numP¬ts
];

48 
numNodes
[
numP¬ts
];

49 
·¹™iÚIndex
=0 ;…¬t™iÚIndex < 
numP¬ts
 ;…artitionIndex++)

51 
·¹™iÚSeqNum
[
·¹™iÚIndex
] = 0;

53 
numNodes
[
·¹™iÚIndex
] = 
nodeCouÁ
[partitionIndex];

54 
subIndex
 = 0;

55  
subIndex
 < 
numP¬ts
 )

57 if(
subIndex
 !ğ
·¹™iÚIndex
)

60 
numNodes
[
·¹™iÚIndex
] +ğ
bÜd”CouÁ
[1-
subIndex
];

62 
subIndex
++;

64 
this
.
·¹™iÚToG¿phVID
[
·¹™iÚIndex
] = (
P¬t™iÚToG¿phVID
 *è
	`m®loc
((P¬t™iÚToG¿phVIDè* 
numNodes
[partitionIndex]);

70  
g¿phVID
 =0 ; g¿phVID < 
numG¿phNodes
; graphVID++)

73 
ownP¬t™iÚID
 = 
·¹
[
g¿phVID
];

74 
this
.
g¿phToP¬t™iÚVID
[
g¿phVID
].
·¹™iÚVID
 = 
·¹™iÚSeqNum
[
ownP¬t™iÚID
];

75 
this
.
·¹™iÚToG¿phVID
[
ownP¬t™iÚID
][
·¹™iÚSeqNum
[ownP¬t™iÚID]].
g¿phVID
 = graphVID;

76 ++
·¹™iÚSeqNum
[
ownP¬t™iÚID
];

80 ifĞ
bÜd”
[
g¿phVID
] )

82 
Ùh”P¬t™iÚID
=0 ; oth”P¬t™iÚID < 
numP¬ts
 ; otherPartitionID++)

84 ifĞ
·¹™iÚIndex
 !ğ
·¹™iÚID
 )

86 
this
.
g¿phToP¬t™iÚVID
[
g¿phVID
].
·¹™iÚVID
 = 
·¹™iÚSeqNum
[
Ùh”P¬t™iÚID
];

87 
this
.
·¹™iÚToG¿phVID
[
Ùh”P¬t™iÚID
][
·¹™iÚSeqNum
[Ùh”P¬t™iÚID]].
g¿phVID
 = graphVID;

88 ++
·r™iÚSeqNum
[
Ùh”P¬t™iÚID
];

93 
	}
}

95 
	$g‘G¿phV”‹xID
Ğ
·¹™iÚV”‹xID
, 
·¹™iÚID
 )

97 Ğ
this
.
·¹™iÚToG¿phVID
[
·¹™iÚID
][
·¹™iÚV”‹xID
].
g¿phVID
 );

98 
	}
}

99 
	$g‘P¬t™iÚV”‹xID
Ğ
g¿phV”‹xID
 )

101 Ğ
this
.
g¿phToP¬t™iÚVID
[
g¿phV”‹xID
].
·¹™iÚVID
 );

102 
	}
}

	@Structs.h

1 #iâdeà
ASHUUTILS_H


2 
	#ASHUUTILS_H


	)

5 
	#MYINFINITY
 
UINT_MAX


	)

6 
	~"commÚ.h
"

7 #iâdeà
CPU_CODE


8 
	~"m‘is.h
"

11 #ià
USEASYNC
 == 1

12 
	#CUDACOPY
(
a
,
b
,
c
,
d
,
¡»am
è
	`cudaMemıyAsync
×,b,c,d,¡»am)

	)

14 
	#CUDACOPY
(
a
,
b
,
c
,
d
,
¡»am
è
	`cudaMemıy
×,b,c,d)

	)

18 
	#CPUPARTITION
 0

	)

19 
	#GPUPARTITION
 1

	)

23 
	sK”ÃlCÚfig
 {

24 
	mdeviû
;

25 
	m´obËmsize
;

26 
	mnblocks
, 
	mblocksize
;

27 
cudaDeviûPrİ
 
	mdp
;

29 
K”ÃlCÚfig
(
ldeviû
 = 0);

30 
š™
();

31 
£tProbËmSize
(
size
);

32 
£tNumb”OfBlocks
(
Êblocks
);

33 
£tNumb”OfBlocksP”SM
(
Êblocks
);

34 
£tNumb”OfBlockTh»ads
(
lblocksize
);

35 
£tMaxTh»adsP”Block
();

36 
g‘Numb”OfBlocks
();

37 
g‘Numb”OfBlockTh»ads
();

38 
g‘Numb”OfTÙ®Th»ads
();

40 
ÿlcuÏ‹
();

41 
g‘MaxTh»adsP”Block
();

42 
g‘MaxBlocks
();

43 
g‘MaxSh¬edMemÜyP”Block
();

44 
g‘Numb”OfSMs
();

45 
boŞ
 
cov”sProbËm
(
size
 = 0);

46 
g‘ProbËmSize
();

47 } 
	tK”ÃlCÚfig
;

51 
	sG¿ph
 {

52 ’um {
	mNÙAÎoÿ‹d
, 
	mAÎoÿ‹dOnHo¡
, 
	mAÎoÿ‹dOnDeviû
} 
	mmemÜy
;

54 
»ad
(
fe
[], 
boŞ
 
weigh‹d
 = 
Œue
);

55 
´štSts
();

56 
´št
();

58 
G¿ph
(
³rcg¿ph
 = 100);

59 ~
G¿ph
();

60 
š™
(
³rcg¿ph
);

61 
š™From
(
G¿ph
 &
äom
);

62 
®locOnHo¡
();

63 
®locOnDeviû
();

64 
d—Îoc
();

65 
d—ÎocOnHo¡
();

66 
d—ÎocOnDeviû
();

67 
d—Îoc_·¹
();

68 
®locLev–s
();

69 
ä“Lev–s
();

70 
´og»ssPršt
(
maxii
, 
ii
);

71 
»adFromEdges
(
fe
[]);

72 
»adFromGR
(
fe
[], 
boŞ
 
weigh‹d
);

73 
g‘Resid’tI‹¿tiÚs
();

74 
´štResid’tDeviû
(
™
, 
ÅršŠodes
 = 100);

75 
´štEdges
(
¡¬‹e
, 
Ãe
);

76 
´štOÃEdge
(
“
);

77 
´štEdgesOf
(
Â
);

78 
g‘Fœ¡EdgeBS—rch
(
Â
);

79 
´štDeg»es
(
¡¬Šn
, 
Ân
);

80 
fšdS”ŸlBFS
(
¤c
);

82 
g‘I‹¿tiÚFromNode
(
Â
);

83 
__ho¡__
 
__deviû__
 
g‘I‹¿tiÚFromEdge
(
“
);

85 
__deviû__
 
´štSts1x1
();

86 
__ho¡__
 
__deviû__
 
´št1x1
();

87 
__deviû__
 
´štResid’t
(
™
, 
ÅršŠodes
 = 100);

88 
__deviû__
 
´štResid’tNode
(
node
);

89 
__deviû__
 
g‘OutDeg»e
(
¤c
);

90 
__deviû__
 
g‘InDeg»e
(
¤c
);

91 
__deviû__
 
g‘De¡š©iÚ
(
¤c
, 
Áhedge
);

92 
__deviû__
 
fÜu
 
g‘Weight
(
¤c
, 
Áhedge
);

93 
__deviû__
 
g‘MšEdge
(
¤c
);

94 
__deviû__
 
fÜu
 
g‘Di¡ªû
(fÜu *
di¡
, 
Â
);

95 
__deviû__
 
fÜu
 
g‘De¡š©iÚDi¡ªû
(fÜu *
di¡
, 
¤c
, 
ii
);

96 
__deviû__
 
fÜu
 
g‘De¡š©iÚDi¡ªû
(fÜu *
di¡
, 
“
);

97 
__deviû__
 
£tDe¡š©iÚDi¡ªû
(
fÜu
 *
d¡di¡
, 
“
, fÜu 
®tdi¡
);

98 
__deviû__
 
__ho¡__
 
g‘Edge
(
“
, &
¤c
, &
d¡
, 
fÜu
 &
wt
);

100 
__deviû__
 
g‘Sigma
(*
sigma
, 
Â
);

101 
__deviû__
 
addSigma
(
“
, *
d¡sigma
, 
¤csigma
);

102 
__deviû__
 
dÜf
 
addBC
(dÜà*
bc
, 
Â
, dÜà
v®
);

103 
__deviû__
 
dÜf
 
addD–
(dÜà*
d–
, 
Â
, dÜà
v®
);

104 
__deviû__
 
g‘De¡š©iÚSigma
(*
d¡sigma
, 
edge
);

105 
__deviû__
 
dÜf
 
g‘De¡š©iÚD–
(dÜà*
d¡d–
, 
edge
);

107 
__deviû__
 
g‘Fœ¡Edge
(
¤c
);

108 
__deviû__
 
g‘Fœ¡EdgeRªdom
(
¤c
);

109 
__deviû__
 
fšdSts
();

110 
__deviû__
 
compu‹Sts
();

111 
__deviû__
 
boŞ
 
compu‹Lev–s
();

112 
__deviû__
 
fšdMaxLev–
();

113 
__deviû__
 
compu‹DŸm‘”
();

114 
__deviû__
 
compu‹InOut
();

115 
__deviû__
 
š™Lev–s
();

116 
__ho¡__
 
__deviû__
 
g‘S¹Node
(
™
);

117 
__ho¡__
 
__deviû__
 
g‘EndNode
(
™
);

118 
__ho¡__
 
__deviû__
 
g‘S¹NodeFromNode
(
Â
);

119 
__ho¡__
 
__deviû__
 
g‘S¹Edge
(
™
);

120 
__ho¡__
 
__deviû__
 
g‘EndEdge
(
™
);

123 
__deviû__
 
dÜf
 
g‘Insum
(dÜà*
šsum
, 
Â
);

124 
__deviû__
 
dÜf
 
g‘PR
(dÜà*
´
, 
Â
);

125 
__deviû__
 
£tPR
(
dÜf
 *
´
, 
Â
, dÜà
¼
);

127 
	mÂodes
, 
	mÃdges
;

128 
	mÂode¤esid’t
, 
	mÃdge¤esid’t
;

129 
	mÃdges¦idšg
;

130 
	m™
;

131 
	mnum_th»ads
;

136 *
	mnoutgošg
, *
	m¤c¤c
, *
	medges¤cd¡
,*
	medged¡¤c
,*
	mnšcomšg
;

137 
fÜu
 *
	medges¤cwt
;

138 
cudaA¼ay
 *
	mcuA¼ay
;

142 *
	mmaxOutDeg»e
;

143 *
	mp¤c
;

144 
	mdŸm‘”
;

145 
boŞ
 
	mfoundSts
;

148 
	sP¬t™iÚ
{

149 
	mÅ¬ts
;

150 * 
	m·¹
;

151 * 
	mbÜd”
;

152 * 
	mbÜd”CouÁ
;

153 ** 
	mbÜd”Nodes
;

154 * 
	mnodeCouÁ
;

155 * 
	medgeCouÁ
;

156 
	medgecut
;

158 } 
	m·¹™iÚ
;

160 
fÜmM‘isP¬t™iÚs
(
G¿ph
 &
äom
, 
P¬t™iÚ
* 
·¹™iÚ
);

161 
flBÜd”AndCouÁ
(
G¿ph
 &
äom
, 
P¬t™iÚ
* 
·¹™iÚ
);

163 
	sDeviûP¬t™iÚ
{

164 
	mnumEdges
;

165 
	mnumNodes
;

166 *
	medge¤c
;

167 *
	medged¡
;

168 *
	medgewt
;

169 * 
	mnodesigma
;

170 * 
	mnoded–
;

171 * 
	mnodedi¡
;

172 *
	mp¤c
;

173 *
	mnoutgošg
;

174 * 
	medgesigma
;

178 }* 
	mdeviûP¬t™iÚ
;

180 
	mmaxNodeCouÁ
;

181 
	mmaxEdgeCouÁ
;

184 
fÜmDeviûP¬t™iÚs
(
G¿ph
 &
äom
);

185 
»moveDeviûP¬t™iÚs
(
G¿ph
 &
äom
);

186 
u£·toh
(
G¿ph
 &,*
f’ame
,
weight1
,
weight2
);

188 
cİyNodesToEdges_di¡
(
·¹™iÚNumb”
);

189 
cİyNodesToEdges_di¡sigma
(
·¹™iÚNumb”
);

190 
»sŞveNodesFromEdges
(
·¹™iÚNumb”
, ,
sourû
);

191 
cİyNodesToEdges_di¡_omp
(
·¹™iÚNumb”
);

192 
cİyNodesToEdges_di¡sigma_omp
(
·¹™iÚNumb”
);

193 
»sŞveNodesFromEdges_omp
(
·¹™iÚNumb”
, ,
sourû
);

194 
aùiveNodesFromEdges_omp
();

200 
	sWÜkli¡_ıu
 {

201 ’um {
	mNÙAÎoÿ‹d
, 
	mAÎoÿ‹dOnHo¡
, 
	mAÎoÿ‹dOnDeviû
} 
	mmemÜy
;

203 
pushRªge
(*
¡¬t
, 
n™ems
);

204 
pushRªgeEdges
(
¡¬tšdex
, 
n™ems
);

205 
push
(
wÜk
);

206 
pİRªge
(*
¡¬t
, 
n™ems
);

207 
pİ
(&
wÜk
);

208 
ş—r
();

209 
myI‹ms
(&
¡¬t
, &
’d
);

210 
g‘I‹m
(
©
);

211 
g‘I‹mW™hš
(
©
, 
hsize
);

212 
couÁ
();

214 
š™
();

215 
š™
(
š™Ÿlÿ·c™y
);

216 
£tSize
(
hsize
);

217 
g‘Size
();

218 
£tC­ac™y
(
hÿ·c™y
);

219 
g‘C­ac™y
();

220 
pushRªgeHo¡
(*
¡¬t
, 
n™ems
);

221 
pushHo¡
(
wÜk
);

222 
ş—rHo¡
();

223 
£tIn™ŸlSize
(
hsize
);

224 
ÿlcuÏ‹Size
(
h¡¬t
, 
h’d
);

225 
£tS¹End
(
h¡¬t
, 
h’d
);

226 
g‘S¹End
(&
h¡¬t
, &
h’d
);

227 
cİyOldToNew
(*
Şd™ems
, *
Ãw™ems
, 
Şdsize
, 
Şdÿ·c™y
);

228 
com´essHo¡
(
wlsize
, 
£Áš–
);

229 
´štHo¡
();

230 
­³ndHo¡
(
WÜkli¡_ıu
 *
Ùh”wl
);

232 
WÜkli¡_ıu
();

233 ~
WÜkli¡_ıu
();

234 
’su»S·û
(
¥aû
);

235 *
®loc
(
®locsize
);

236 
»®loc
(
¥aû
);

237 
d—Îoc
();

238 
ä“Size
();

240 *
	m™ems
;

241 *
	m¡¬t
, *
	m’d
, *
	mÿ·c™y
;

243 
	mnov”æows
;

300 
	sv¬to_ıu_·¹
{

301 
G¿ph
 *
	mg¿ph
;

302 
	mG¿ph
::
DeviûP¬t™iÚ
 *
·¹™iÚ
;

303 
	mG¿ph
::
P¬t™iÚ
 *
bÜd”Info
;

304 
	msourû
;

305 
	m¤ı¬t™iÚ
, 
	mnÚ¤ı¬t™iÚ
;

306 
	mnum_th»ads
;

307 *
	mbÜd”VeùÜ_ıu
,*
	mbÜd”VeùÜ_gpu
;

308 *
	mbÜd”Sigma_ıu
,*
	mbÜd”Sigma_gpu
;

309 *
	maùu®_di¡
;

310 
m©rix_c¤
 *
	mbÜd”M©rix_ıu
, *
	mbÜd”M©rix_gpu
;

311 
boŞ
 
	msšgË_»Ïx
;

312 *
	mp¤c
, *
	mnoutgošg
;

313 
omp_lock_t
 *
	mlock
;

315 *
	mıu_Ëv–
;

316 vŞ©*
	mgpu_Ëv–
;

317 *
	mıu_Ëv–_mš
, *
	mgpu_Ëv–_mš
;

319 
	mıu_F_I
,
	mıu_F_R
,
	mıu_bck_kÆ_time
,
	mıu_fwd_kÆ_time
,
	mıu_tÙ_bck_time
;

324 
	sv¬to_gpu_·¹
{

325 
G¿ph
 *
	mg¿ph
;

326 
	mG¿ph
::
DeviûP¬t™iÚ
 *
nÚ¤ı¬t
;

327 
	mG¿ph
::
DeviûP¬t™iÚ
 *
¤ı¬t
;

328 
	mG¿ph
::
DeviûP¬t™iÚ
 *
gpu·¹
;

329 
	mG¿ph
::
P¬t™iÚ
 *
bÜd”Info
;

330 
	msourû
;

331 
	m¤ı¬t™iÚ
, 
	mnÚ¤ı¬t™iÚ
;

332 
	mnum_th»ads
;

333 *
	mbÜd”VeùÜ_ıu
,*
	mbÜd”VeùÜ_gpu
;

334 *
	mbÜd”Sigma_ıu
,*
	mbÜd”Sigma_gpu
;

335 
m©rix_c¤
 *
	mbÜd”M©rix
;

336 
cudaSŒ—m_t
 
	msÚe
, 
	m¡wo
,
	m¡h»e
,
	msfour
;

337 *
	mnodesigma
, *
	medgesigma
, *
	medge¤c
, *
	medged¡
, *
	mnodedi¡
, *
	medged¡di¡
, *
	medgewt
,*
	mbÜd”
;

338 *
	mbÜd”Nodes
,*
	mbÜd”Di¡
, *
	mbÜd”Sigma
;

339 *
	mbÜd”D–
;

340 *
	mnoded–
;

341 
boŞ
* 
	maùive
, *
	mloÿlchªged
;

342 
K”ÃlCÚfig
 *
	mkcÚf
;

343 
boŞ
 
	msšgË_»Ïx
;

344 *
	mp¤c
, *
	mnoutgošg
,*
	mÃ¼
;

346 vŞ©*
	mıu_Ëv–
;

347 *
	mgpu_Ëv–
;

348 *
	mıu_Ëv–_mš
, *
	mgpu_Ëv–_mš
;

350 
omp_lock_t
 *
	mlock
;

351 
boŞ
 *
	md_gpu_wa™
;

352 
	mgpu_F_I
,
	mgpu_F_R
,
	mgpu_bck_kÆ_time
,
	mgpu_fwd_kÆ_time
,
	mgpu_tÙ_bck_time
,
	mgpu_memıy
;

	@backward_phase.cu

1 
	~<¡dio.h
>

2 
	~<omp.h
>

3 
	~<cuda.h
>

4 
	~<time.h
>

5 
	~<f¡»am
>

6 
	~<¡ršg
>

7 
	~<veùÜ
>

8 
	~<io¡»am
>

9 
	~<¡ršg.h
>

10 
	~<sys/time.h
>

11 
	~"SŒuùs.h
"

12 
	~"myuts2.h
"

13 
	~"gb¬.cuh
"

58 
	$ıu_compÚ’t
 (*
edge¤c
,*
edged¡
,
Âodes
,
Ãdges
,*
nodedi¡
,*
nodesigma
,*
edgesigma
, *
noded–
,
boŞ
 *
wa™
,
Áh»ads
,*
bÜd”
,
Ëv–
,*
p¤c
, *
noutgošg
){

59 
boŞ
 
lchªged
[
Áh»ads
];

60 #ifdeà
_OPENMP


61 #´agm¨
omp
 
·¿Î–
 (
sh¬ed
è
	`fœ¡´iv©e
(
Ëv–
,
Âodes
,
edged¡
,
p¤c
,
noutgošg
è
	`num_th»ads
(
Áh»ads
)

65 
¤c
,
d¡
,
ii
,
tid
,
j
, 
num_edges_v
;

66 
d–_¤c
,
d–_d¡
;

67 
tid
 = 
	`omp_g‘_th»ad_num
();

68 
lchªged
[
tid
] = 
çl£
;

70 #ifdeà
_OPENMP


71 #´agm¨
omp
 
	`scheduË
(
guided
è
nowa™


73 
ii
 = 0; i˜< 
Âodes
; ii++) {

74 
num_edges_v
 = 
p¤c
[
ii
];

75 if(
nodedi¡
[
ii
]==
Ëv–
){

76 
j
 = 
num_edges_v
; j < (num_edges_v + 
noutgošg
[
ii
]); j++){

77 
d¡
 = 
edged¡
[
j
];

78 if(
nodedi¡
[
d¡
]!=
Ëv–
+1) ;

79 if(
edgesigma
[
j
]==0) ;

80 if(
bÜd”
[
d¡
]!=0){

81 
lchªged
[
tid
] = 
Œue
;

85 
¤c
 = 
ii
;

87 
d–_d¡
 = 
noded–
[
d¡
];

88 
d–_d¡
 += 1;

89 if(
nodesigma
[
d¡
]!=0)

90 
d–_¤c
 = (()(
nodesigma
[
¤c
]/nodesigma[
d¡
])*
d–_d¡
);

91 #ifdeà
_OPENMP


92 #´agm¨
omp
 
©omic


94 
noded–
[
¤c
] +ğ
d–_¤c
;

95 
edgesigma
[
ii
]=0;

108 #ifdeà
_OPENMP


111 
ii
=0 ; i˜< 
Áh»ads
; ii++ )

112 if(
lchªged
[
ii
]){ *
wa™
 = 
Œue
; ;}

113 
	}
}

135 
	$ıu_sšgË_compÚ’t
 (*
edge¤c
,*
edged¡
,
Âodes
,
Ãdges
,*
nodedi¡
,*
nodesigma
,*
edgesigma
, *
noded–
,
Áh»ads
,
Ëv–
,*
p¤c
, *
noutgošg
){

136 #ifdeà
_OPENMP


137 #´agm¨
omp
 
·¿Î–
 (
sh¬ed
è
	`fœ¡´iv©e
(
Ëv–
,
Âodes
,
edged¡
,
p¤c
,
noutgošg
è
	`num_th»ads
(
Áh»ads
)

140 
¤c
,
d¡
,
ii
,
j
, 
num_edges_v
;

141 
d–_¤c
,
d–_d¡
;

142 #ifdeà
_OPENMP


143 #´agm¨
omp
 
	`scheduË
(
guided
è
nowa™


145 
ii
 = 0; i˜< 
Âodes
; ii++) {

147 
num_edges_v
 = 
p¤c
[
ii
];

148 if(
nodedi¡
[
ii
]==
Ëv–
){

149 
j
 = 
num_edges_v
; j < (num_edges_v + 
noutgošg
[
ii
]); j++){

150 
d¡
 = 
edged¡
[
j
];

151 if(
nodedi¡
[
d¡
]!=
Ëv–
+1) ;

153 if(
edgesigma
[
j
]==0) ;

155 
d–_d¡
 = 
noded–
[
d¡
];

156 
d–_d¡
 += 1;

157 if(
nodesigma
[
d¡
]!=0)

158 
d–_¤c
 = (()(
nodesigma
[
ii
]/nodesigma[
d¡
])*
d–_d¡
);

159 #ifdeà
_OPENMP


160 #´agm¨
omp
 
©omic


162 
noded–
[
ii
] +ğ
d–_¤c
;

163 
edgesigma
[
j
]=0;

167 #ifdeà
_OPENMP


170 
	}
}

173 
	$ıu_backw¬d
(
v¬to_ıu_·¹
 *
v¬
)

176 
G¿ph
 *
g¿ph
 = 
v¬
->graph;

177 
numEdges_ıu
,
numNodes_ıu
,
bÜd”Index
,
bÜd”Index2
,
ii
,
bÜd”Sourû
;

178 
num_th»ads
 = 
v¬
->num_threads;

179 
G¿ph
::
DeviûP¬t™iÚ
 *
ıu·¹
 = 
v¬
->
·¹™iÚ
;

180 
G¿ph
::
P¬t™iÚ
 *
bÜd”Info
 = 
v¬
->borderInfo;

181 
numEdges_ıu
 = 
ıu·¹
->
numEdges
;

182 
numNodes_ıu
 = 
ıu·¹
->
numNodes
;

183 * 
ıu_Ëv–
 = 
v¬
->cpu_level ;

184 vŞ©* 
gpu_Ëv–
 = 
v¬
->gpu_level;

185 
boŞ
 
ıu_wa™
 = 
çl£
;

186 
bÜd”CouÁ
 = 
bÜd”Info
->bÜd”CouÁ[
CPUPARTITION
];

187 
¡¬‰ime
, 
’dtime
,
t¡time
,
‹ndtime
;

188 
¡¬‰ime
 = 
	`¹şock
();

189 *
edgesigma
 = 
ıu·¹
->edgesigma;

190 *
noded–
 = 
ıu·¹
->nodedelta;

191 *
gpunod–
 = 
g¿ph
->
deviûP¬t™iÚ
[
GPUPARTITION
].
noded–
;

196 
ii
 = 0 ; i˜< 
numEdges_ıu
 ; ii++){

197 if(
g¿ph
->
·¹™iÚ
.
·¹
[
ıu·¹
->
edged¡
[
ii
]]==
GPUPARTITION
)

198 
ıu·¹
->
edgesigma
[
ii
] = 0 ;

200 --*
ıu_Ëv–
;

201 *
ıu_Ëv–
 > *(
v¬
->
ıu_Ëv–_mš
)){

202 
ıu_wa™
 = 
çl£
;

204 
t¡time
 = 
	`¹şock
();

205 
	`ıu_compÚ’t
 (
ıu·¹
->
edge¤c
,ıu·¹->
edged¡
,
g¿ph
->
Âodes
,
numEdges_ıu
,ıu·¹->
nodedi¡
,ıu·¹->
nodesigma
,
edgesigma
,
noded–
,&
ıu_wa™
,
num_th»ads
,
bÜd”Info
->
bÜd”
,*
ıu_Ëv–
,ıu·¹->
p¤c
,ıu·¹->
noutgošg
);

206 
‹ndtime
 = 
	`¹şock
();

207 
v¬
->
ıu_bck_kÆ_time
 +ğ
‹ndtime
 - 
t¡time
;

208 if(
ıu_wa™
 && *
gpu_Ëv–
 > *(
v¬
->
gpu_Ëv–_mš
)){

209 *
gpu_Ëv–
 > *
ıu_Ëv–
);

211 if(
ıu_wa™
){

213 #ifdeà
_OPENMP


214 #´agm¨
omp
 
·¿Î–
 
	`scheduË
(
dyÇmic
è
	`num_th»ads
(
num_th»ads
)

216 
ii
 = 0 ; i˜< 
bÜd”CouÁ
; ii++){

217 if(
ıu·¹
->
nodedi¡
[
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
][
ii
]]==*
ıu_Ëv–
 && 
g¿ph
->
deviûP¬t™iÚ
[
GPUPARTITION
].
noded–
[borderInfo->borderNodes[CPUPARTITION][ii]] != cpupart->nodedelta[borderInfo->borderNodes[CPUPARTITION][ii]]){

220 
ıu·¹
->
noded–
[
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
][
ii
]] +ğ
gpunod–
[borderInfo->borderNodes[CPUPARTITION][ii]];

227 
t¡time
 = 
	`¹şock
();

228 
	`ıu_sšgË_compÚ’t
 (
ıu·¹
->
edge¤c
,ıu·¹->
edged¡
,
g¿ph
->
Âodes
,
numEdges_ıu
,ıu·¹->
nodedi¡
,ıu·¹->
nodesigma
,
edgesigma
,
noded–
,
num_th»ads
,*
ıu_Ëv–
,ıu·¹->
p¤c
,ıu·¹->
noutgošg
);

229 
‹ndtime
 = 
	`¹şock
();

230 
v¬
->
ıu_bck_kÆ_time
 +ğ
‹ndtime
 - 
t¡time
;

233 *
ıu_Ëv–
=*cpu_level-1;

236 
’dtime
 = 
	`¹şock
();

237 
	`´štf
("CPU Backw¬d Pha£,„uÁimğ%.3làms\n", 1000*(
’dtime
 -
¡¬‰ime
));

238 
v¬
->
ıu_tÙ_bck_time
 +ğ
’dtime
 -
¡¬‰ime
;

239 
	}
}

241 
__deviû__
 
	$A¼ayToBÜd”
(*
D–
, *
bÜd”D–
,*
bÜd”Nodes
,
bÜd”CouÁ
){

242 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

243 
id
 < 
bÜd”CouÁ
){

244 
bÜd”D–
[
id
] = 
D–
[
bÜd”Nodes
[id]];

245 
id
 +ğ
blockDim
.
x
 * 
gridDim
.x;

247 
	}
}

248 
__deviû__
 
	$BÜd”ToA¼ay
(*
D–
, *
bÜd”D–
,*
bÜd”Nodes
,
bÜd”CouÁ
){

249 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

250 
id
 < 
bÜd”CouÁ
){

251 
D–
[
bÜd”Nodes
[
id
]] = 
bÜd”D–
[id];

252 
id
 +ğ
blockDim
.
x
 * 
gridDim
.x;

254 
	}
}

256 
__glob®__


257 
	$gpu_compÚ’t
 (*
edge¤c
,*
edged¡
,
Âodes
,
Ãdges
,*
nodedi¡
,*
nodesigma
,*
edgesigma
,*
noded–
,*
wa™
,*
bÜd”
,*
bÜd”D–
, 
bÜd”CouÁ
,
Ëv–
){

258 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

263 
boŞ
 
lchªged
=
çl£
;

266 
¤c
,
d¡
;

267 
d–_¤c
,
d–_d¡
;

268 ;
id
 < 
Ãdges
;id +ğ
gridDim
.
x
*
blockDim
.x){

271 
d¡
 = 
edged¡
[
id
];

272 if(
nodedi¡
[
d¡
]!=
Ëv–
) ;

273 if(
edgesigma
[
id
]==0) ;

274 if(
bÜd”
[
d¡
]!=0){

275 
lchªged
 = 
Œue
;

278 
¤c
 = 
edge¤c
[
id
];

280 
d–_d¡
 = 
noded–
[
d¡
];

281 
d–_d¡
++;

283 
d–_¤c
 = (()(
nodesigma
[
¤c
]/nodesigma[
d¡
])*
d–_d¡
);

284 
	`©omicAdd
(&
noded–
[
¤c
],
d–_¤c
);

285 
edgesigma
[
id
] = 0;

289 if(
lchªged
è*
wa™
 =1 ;

290 
	`A¼ayToBÜd”
(
noded–
, 
bÜd”D–
,
bÜd”
,
bÜd”CouÁ
);

296 
	}
}

343 
__glob®__


344 
	$gpu_sšgË_compÚ’t
 (*
edge¤c
,*
edged¡
,
Âodes
,
Ãdges
,*
nodedi¡
,*
nodesigma
,*
edgesigma
,*
noded–
,*
bÜd”
,*
bÜd”D–
, 
bÜd”CouÁ
, 
Ëv–
){

345 
	`BÜd”ToA¼ay
(
noded–
, 
bÜd”D–
,
bÜd”
,
bÜd”CouÁ
);

346 
	`__synùh»ads
();

347 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

352 
¤c
,
d¡
;

353 
d–_¤c
,
d–_d¡
;

354 ;
id
 < 
Ãdges
;id +ğ
gridDim
.
x
*
blockDim
.x){

357 
d¡
 = 
edged¡
[
id
];

358 if(
nodedi¡
[
d¡
]!=
Ëv–
) ;

359 if(
bÜd”
[
d¡
]==0) ;

360 if(
edgesigma
[
id
]==0) ;

361 
¤c
 = 
edge¤c
[
id
];

363 
d–_d¡
 = 
noded–
[
d¡
];

364 
d–_d¡
++;

366 
d–_¤c
 = (()(
nodesigma
[
¤c
]/nodesigma[
d¡
])*
d–_d¡
);

367 
	`©omicAdd
(&
noded–
[
¤c
],
d–_¤c
);

368 
edgesigma
[
id
] = 0;

372 
	}
}

374 *
	$gpu_backw¬d
(*
v¬
){

375 
v¬to_gpu_·¹
 *
P
 = (v¬to_gpu_·¹ *è
v¬
;

376 
G¿ph
 *
g¿ph
 = 
P
->graph;

377 
numEdges_gpu
,
numNodes_gpu
,
bÜd”Index
,
bÜd”Index2
,
ii
,
bÜd”Sourû
;

378 
G¿ph
::
DeviûP¬t™iÚ
 *
gpu·¹
 = 
P
->gpupart;

379 
G¿ph
::
P¬t™iÚ
 *
bÜd”Info
 = 
P
->borderInfo;

380 
numEdges_gpu
 = 
gpu·¹
->
numEdges
;

381 
numNodes_gpu
 = 
gpu·¹
->
numNodes
;

382 cÚ¡ vŞ©*
ıu_Ëv–
 = 
P
->cpu_level ;

384 * 
gpu_Ëv–
 = 
P
->gpu_level;

385 
gpu_wa™
=0;

386 *
d_gpu_wa™
;

387 
bÜd”CouÁ
 = 
bÜd”Info
->bÜd”CouÁ[
GPUPARTITION
];

388 *
d_bÜd”
 = 
P
->
bÜd”
,
i
;

389 * 
ıunod–
, *
gpuBÜd”D–
;

390 
ıunod–
 = 
g¿ph
->
deviûP¬t™iÚ
[
CPUPARTITION
].
noded–
;

391 
gpuBÜd”D–
 = (*è
	`m®loc
 ((è* 
bÜd”CouÁ
);

393 
‹mp
;

394 
cudaEv’t_t
 
¡¬t
, 
¡İ
;

395 
	`cudaEv’tC»©e
(&
¡¬t
);

396 
	`cudaEv’tC»©e
(&
¡İ
);

398 
	`cudaM®loc
((**)&
d_gpu_wa™
, ());

404 
¡¬‰ime
, 
’dtime
,
tmp¡¬‰ime
,
tm³ndtime
,
k”ÃÉime
=0;

405 
–­£dTime
=0;

406 
¡¬‰ime
 = 
	`¹şock
();

413 
i
 = 0 ; i < 
numEdges_gpu
 ; i++){

414 if(
g¿ph
->
·¹™iÚ
.
·¹
[
gpu·¹
->
edged¡
[
i
]]==
CPUPARTITION
)

415 
gpu·¹
->
edgesigma
[
i
] = 0 ;

417 
i
 =0 ; i< 
bÜd”CouÁ
 ; i++)

418 
gpuBÜd”D–
[
i
] = 
gpu·¹
->
noded–
[
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
][i]];

420 *
gpu_Ëv–
 > *(
P
->
gpu_Ëv–_mš
)){

421 
gpu_wa™
 = 0;

423 
tmp¡¬‰ime
 = 
	`¹şock
();

424 
	`cudaMem£t
(
d_gpu_wa™
,0,());

425 
tm³ndtime
 = 
	`¹şock
();

426 
P
->
gpu_memıy
 +ğ
tm³ndtime
 - 
tmp¡¬‰ime
 ;

428 
tmp¡¬‰ime
 = 
	`¹şock
();

430 
gpu_compÚ’t
<<<
P
->
kcÚf
->
	`g‘Numb”OfBlocks
(), P->kcÚf->
	`g‘Numb”OfBlockTh»ads
()>>>(P->
edge¤c
,P->
edged¡
,
g¿ph
->
Âodes
,
numEdges_gpu
,P->
nodedi¡
,P->
nodesigma
,P->
edgesigma
,P->
noded–
,
d_gpu_wa™
,
d_bÜd”
,P->
bÜd”D–
,
bÜd”CouÁ
,*
gpu_Ëv–
);

433 
	`cudaDeviûSynchrÚize
();

434 
tm³ndtime
 = 
	`¹şock
();

439 
P
->
gpu_bck_kÆ_time
 +ğ
tm³ndtime
 - 
tmp¡¬‰ime
 ;

441 
	`cudaMemıy
(&
gpu_wa™
,
d_gpu_wa™
,(), 
cudaMemıyDeviûToHo¡
);

442 if(
gpu_wa™
 && *
ıu_Ëv–
 > *(
P
->
ıu_Ëv–_mš
)){

444 
tmp¡¬‰ime
 = 
	`¹şock
();

446 
	`cudaMemıy
(
gpuBÜd”D–
,
P
->
bÜd”D–
,(
bÜd”CouÁ
è* (), 
cudaMemıyDeviûToHo¡
);

447 
tm³ndtime
 = 
	`¹şock
();

448 
k”ÃÉime
 +ğ
tm³ndtime
 - 
tmp¡¬‰ime
 ;

450 *
ıu_Ëv–
 > *
gpu_Ëv–
);

452 if(
gpu_wa™
){

456 
i
 = 0 ; i < 
bÜd”CouÁ
; i++){

457 if(
gpu·¹
->
nodedi¡
[
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
][
i
]]==*
gpu_Ëv–
 && 
g¿ph
->
deviûP¬t™iÚ
[
CPUPARTITION
].
noded–
[bÜd”Info->bÜd”Nodes[GPUPARTITION][i]] !ğ
gpuBÜd”D–
[i] ){

460 
gpuBÜd”D–
[
i
] +ğ
ıunod–
[
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
][i]];

466 
tmp¡¬‰ime
 = 
	`¹şock
();

467 
	`cudaMemıy
(
P
->
bÜd”D–
,
gpuBÜd”D–
,(
bÜd”CouÁ
è* (), 
cudaMemıyHo¡ToDeviû
);

468 
tm³ndtime
 = 
	`¹şock
();

469 
P
->
gpu_memıy
 +ğ
tm³ndtime
 - 
tmp¡¬‰ime
 ;

470 
tmp¡¬‰ime
 = 
	`¹şock
();

473 
gpu_sšgË_compÚ’t
<<<26,704>>>(
P
->
edge¤c
,P->
edged¡
,
g¿ph
->
Âodes
,
numEdges_gpu
,P->
nodedi¡
,P->
nodesigma
,P->
edgesigma
,P->
noded–
,
d_bÜd”
,P->
bÜd”D–
,
bÜd”CouÁ
,*
gpu_Ëv–
);

474 
	`cudaDeviûSynchrÚize
();

479 
tm³ndtime
 = 
	`¹şock
();

480 
P
->
gpu_bck_kÆ_time
 +ğ
tm³ndtime
 - 
tmp¡¬‰ime
 ;

484 *
gpu_Ëv–
 = *gpu_level-1;

487 
tmp¡¬‰ime
 = 
	`¹şock
();

488 
	`cudaMemıy
(
gpu·¹
->
noded–
,
P
->noded–,(
g¿ph
->
Âodes
è* (), 
cudaMemıyDeviûToHo¡
);

489 
tm³ndtime
 = 
	`¹şock
();

490 
P
->
gpu_memıy
 +ğ
tm³ndtime
 - 
tmp¡¬‰ime
 ;

491 
’dtime
 = 
	`¹şock
();

492 
	`´štf
("GPU Backw¬d Pha£,„uÁimğ%.3làm ; k”Ãl_timğ %.3làm \n", 1000*(
’dtime
 -
¡¬‰ime
),1000*
k”ÃÉime
);

493 
P
->
gpu_tÙ_bck_time
 +ğ
’dtime
 -
¡¬‰ime
;

498 
	`ä“
(
gpuBÜd”D–
);

499 
	`±h»ad_ex™
(
NULL
);

500 
	}
}

	@bc.cu

28 
	~"commÚ.h
"

30 
	~"SŒuùs.h
"

31 
	~"scheduËr19.h
"

32 
	~"g¿ph28.h
"

33 
	~"k”ÃlcÚfig.h
"

34 
	~"li¡.h
"

35 
	~<cub/cub.cuh
>

37 
	~"myuts.h
"

38 
	~"myuts2.h
"

40 
	#DIAMETER
 221

	)

44 
	gıu_¿tiÙime
,
	ggpu_¿tiÙime
;

45 
	sd_s
{

46 
	mdi¡
;

47 
	msig
;

49 #iâdeà
USE_DIA


50 
	sm©rix_c¤
{

51 
	mrow_size
;

52 
	mveùÜ
<> 
	mdi¡
;

53 
	mveùÜ
<> 
	msig
;

55 
d_s
 
	$fšd_m©rix
(
m©rix_c¤
 *
M
,
i
, 
j
){

56 
d_s
 
s
;

57 
s
.
di¡
 = 
M
->di¡[
i
*(M->
row_size
)+
j
];

58 
s
.
sig
 = 
M
->sig[
i
*(M->
row_size
)+
j
];

59  
s
;

60 
	}
}

61 
	$modify_m©rix
(
m©rix_c¤
 *
M
,
i
, 
j
,
di¡
,
sig
){

62 
M
->
di¡
.
	`push_back
(dist);

63 
M
->
sig
.
	`push_back
(sig);

64 
	}
}

66 
	sm©rix_c¤
{

67 
	mrow_size
;

68 
	mveùÜ
<
	mboŞ
> 
	mb™s
;

69 
	mveùÜ
<> 
	mdi¡
;

70 
	mveùÜ
<> 
	msig
;

73 
d_s
 
	$fšd_m©rix
(
m©rix_c¤
 *
M
,
i
, 
j
){

74 
d_s
 
s
;

75 if(!
M
->
b™s
[
i
*(M->
row_size
)+
j
]){

76 
s
.
di¡
=
MYINFINITY
;

77 
s
.
sig
=0;

78  
s
;

81 
Áh»ads
=
	`omp_g‘_num_´ocs
()/2;

82 
ušt64_t
 
–e
[
Áh»ads
],
ii
,
tÙ®_–e
=0;

83 
ii
=0;ii<
Áh»ads
;ii++)

84 
–e
[
ii
]=0;

85 #ifdeà
_OPENMP


86 #´agm¨
omp
 
·¿Î–
 
	`scheduË
(è
	`´iv©e
(
ii
è
	`num_th»ads
(
Áh»ads
)

88 
ii
=0;i˜<ğ(
i
*(
M
->
row_size
)+
j
) ; ii++)

89 if(
M
->
b™s
[
ii
])

90 
–e
[
	`omp_g‘_th»ad_num
()]++;

91 
ii
=0;ii<
Áh»ads
;ii++)

92 
tÙ®_–e
 +=
–e
[
ii
];

94 
s
.
di¡
=
M
->di¡[
tÙ®_–e
];

95 
s
.
sig
ğ
M
->sig[
tÙ®_–e
];

97  
s
;

99 
	}
}

100 
	$modify_m©rix
(
m©rix_c¤
 *
M
,
i
, 
j
,
di¡
,
sig
){

101 if(
di¡
 > 
DIAMETER
){

103 
M
->
b™s
.
	`push_back
(
çl£
);

108 
s
 = ()
di¡
;

109 
M
->
b™s
.
	`push_back
(
Œue
);

110 
M
->
di¡
.
	`push_back
(
s
);

111 
M
->
sig
.
	`push_back
(sig);

112 
	}
}

115 
	$š™bc
(
dÜf
 *
bc
, 
nv
) {

116 
ii
 = 0; i˜< 
nv
; ++ii) {

117 
bc
[
ii
] = 0.0;

119 
	}
}

121 
	$v”ify
(
dÜf
 *
bc
, 
G¿ph
 &
g¿ph
) {

122 
Ã¼
 = 1;

123 
	`´štf
("\tVerification‚ot…erformed.\n");

124 
ii
 = 0; ii < 10; ++ii) {

125 
	`´štf
("\tbc[%d] = %lf.\n", 
ii
, 
bc
[ii]);

127  
Ã¼
;

128 
	}
}

130 
	$š™nodesigmadi¡
(
sourû
, 
nodes
, * 
nodesigma
, * 
nodedi¡
){

131 
ii
;

132 
ii
 = 0; i˜< 
nodes
; ii++) {

133 
nodesigma
[
ii
] = 0;

134 
nodedi¡
[
ii
] = 
MYINFINITY
;

136 
nodesigma
[
sourû
] = 1;

137 
nodedi¡
[
sourû
] = 0;

138 
	}
}

139 
	$š™nodesigmadi¡_muÉisourû
(
G¿ph
 *
g¿ph
,*
v®ues
, *
sigma_v®ues
,
nodes
, * 
nodesigma
, * 
nodedi¡
,*
sourûs
,
sourû_couÁ
,*
p¤c
,*
noutgošg
,*
edged¡
,*
bÜd”
){

140 
ii
,
j
;

149  
ii
 = 0; i˜< 
sourû_couÁ
; ii++) {

150 
v
 = 
sourûs
[
ii
],
w
;

151 
num_edges_v
 = 
p¤c
[
v
];

152 
j
 = 
num_edges_v
; j < (num_edges_v + 
noutgošg
[
v
]) ; j++) {

153 
w
 = 
edged¡
[
j
];

154 if(
bÜd”
[
w
]==0);

155 
nodedi¡
[
w
]=
MYINFINITY
;

156 
nodesigma
[
w
]=0;

159 
ii
=0 ; i˜< 
sourû_couÁ
 ; ii++)

161 
nodedi¡
[
sourûs
[
ii
]] = 
v®ues
[ii];

162 
nodesigma
[
sourûs
[
ii
]] = 
sigma_v®ues
[ii];

165 
	}
}

166 
	$š™nodesigmadi¡_muÉisourû_omp
(
G¿ph
 *
g¿ph
,*
v®ues
,*
sigma_v®ues
,
nodes
, * 
nodesigma
, * 
nodedi¡
,*
sourûs
,
sourû_couÁ
,
num_th»ads
,*
p¤c
,*
noutgošg
,*
edged¡
,*
bÜd”
){

167 
ii
,
j
;

177 #ifdeà
_OPENMP


178 #´agm¨
omp
 
·¿Î–
 
	`scheduË
(è
	`´iv©e
(
ii
,
j
è
	`num_th»ads
(
num_th»ads
)

180  
ii
 = 0; i˜< 
sourû_couÁ
; ii++) {

181 
v
 = 
sourûs
[
ii
],
w
;

182 
num_edges_v
 = 
p¤c
[
v
];

183 
j
 = 
num_edges_v
; j < (num_edges_v + 
noutgošg
[
v
]) ; j++) {

184 
w
 = 
edged¡
[
j
];

185 if(
bÜd”
[
w
]==0);

186 
nodedi¡
[
w
]=
MYINFINITY
;

187 
nodesigma
[
w
]=0;

191 
ii
=0 ; i˜< 
sourû_couÁ
 ; ii++)

193 
nodedi¡
[
sourûs
[
ii
]] = 
v®ues
[ii];

194 
nodesigma
[
sourûs
[
ii
]] = 
sigma_v®ues
[ii];

196 
	}
}

197 
	$š™nodesigmadi¡_muÉisourû_sšgË»Ïx
(
G¿ph
 *
g¿ph
,*
v®ues
, *
sigma_v®ues
,
nodes
, * 
nodesigma
, * 
nodedi¡
,*
sourûs
,
sourû_couÁ
){

198 
ii
,
j
;

207 
ii
=0 ; i˜< 
sourû_couÁ
 ; ii++)

209 
nodedi¡
[
sourûs
[
ii
]] = 
v®ues
[ii];

210 
nodesigma
[
sourûs
[
ii
]] = 
sigma_v®ues
[ii];

213 
	}
}

214 
	$š™nodesigmadi¡_muÉisourû_omp_sšgË»Ïx
(
G¿ph
 *
g¿ph
,*
v®ues
,*
sigma_v®ues
,
nodes
, * 
nodesigma
, * 
nodedi¡
,*
sourûs
,
sourû_couÁ
,
num_th»ads
){

215 
ii
,
j
;

226 #ifdeà
_OPENMP


227 #´agm¨
omp
 
	`scheduË
(è
	`´iv©e
(
ii
)

229 
ii
=0 ; i˜< 
sourû_couÁ
 ; ii++)

231 
nodedi¡
[
sourûs
[
ii
]] = 
v®ues
[ii];

232 
nodesigma
[
sourûs
[
ii
]] = 
sigma_v®ues
[ii];

234 
	}
}

237 
	$š™nodesigmadi¡_omp
(
sourû
, 
nodes
, * 
nodesigma
, * 
nodedi¡
,
num_th»ads
){

238 
ii
;

239 #ifdeà
_OPENMP


240 #´agm¨
omp
 
·¿Î–
 
	`´iv©e
(
ii
è
	`scheduË
(
guided
è
	`num_th»ads
(
num_th»ads
)

242 
ii
 = 0; i˜< 
nodes
; ii++) {

243 
nodesigma
[
ii
] = 0;

244 
nodedi¡
[
ii
] = 
MYINFINITY
;

246 
nodesigma
[
sourû
] = 1;

247 
nodedi¡
[
sourû
] = 0;

248 
	}
}

250 
	$bÜd”M©rixVeùÜ_comp
 (
m©rix_c¤
 *
M
, *
Vš
,*
Vout
,*
S_V
,
BcouÁ
)

252 *
bV
 = (*)
	`m®loc
 ((è* 
BcouÁ
);

253 
boŞ
 
æag
;

258 
bÜd”Index
, 
bÜd”Index2
;

259 #ifdeà
_OPENMP


260 #´agm¨
omp
 
·¿Î–
 
	`scheduË
()

262 
bÜd”Index
=0;bÜd”Index < 
BcouÁ
; borderIndex++)

263 
bV
[
bÜd”Index
] = 
Vš
[borderIndex];

267 
æag
 = 
çl£
;

272  
bÜd”Index
=0;bÜd”Index < 
BcouÁ
; borderIndex++){

273 
bÜd”Index2
=0; bÜd”Index2 < 
BcouÁ
; borderIndex2++){

274 
d_s
 
s
=
	`fšd_m©rix
(
M
,
bÜd”Index
,
bÜd”Index2
);

276 if(
bÜd”Index
!=
bÜd”Index2
 && (
bV
 [bÜd”Index2] > 
s
.
di¡
 + bV [borderIndex])){

277 
bV
 [
bÜd”Index2
] = 
s
.
di¡
 + bV[
bÜd”Index
];

278 
S_V
 [
bÜd”Index2
] = 
s
.
sig
-1 + S_V[
bÜd”Index
];

279 
æag
 = 
Œue
;

286 }
æag
);

287 #ifdeà
_OPENMP


288 #´agm¨
omp
 
·¿Î–
 
	`scheduË
()

291 
bÜd”Index
=0;bÜd”Index < 
BcouÁ
; borderIndex++)

292 
Vout
[
bÜd”Index
] = 
bV
[borderIndex];

296 
	`ä“
(
bV
);

297 
	}
}

299 
boŞ
 
	$Equ®s
 (*
V1
, *
V2
, 
BcouÁ
)

302 
bÜd”Index
;

306 
bÜd”Index
 = 0 ; bÜd”Index < 
BcouÁ
 ; borderIndex++)

308 ifĞ
V1
 [
bÜd”Index
] !ğ
V2
 [borderIndex])

309  
çl£
;

312  
Œue
;

322 
	}
}

324 
__glob®__
 
	$A¼ayToBÜd”
(*
Di¡
, *
Sigma
, *
bÜd”Di¡
, *
bÜd”Sigma
,*
bÜd”Nodes
,
bÜd”CouÁ
){

325 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

326 
id
 < 
bÜd”CouÁ
){

327 
bÜd”Di¡
[
id
] = 
Di¡
[
bÜd”Nodes
[id]];

328 
bÜd”Sigma
[
id
] = 
Sigma
[
bÜd”Nodes
[id]];

329 
id
 +ğ
blockDim
.
x
 * 
gridDim
.x;

331 
	}
}

332 
	$gpu_compÚ’t
 (*
p¤c
,*
noutgošg
,*
d_p¤c
,*
d_noutgošg
,*
edgesd¡¤c
,*
edges¤cd¡
,
hedges
,
hnodes
,*
hdi¡
,*
nodesigma
,*
edgesigma
,
sourû_couÁ
,*
sourûs
,
cudaDeviûPrİ
 *
dp
,
boŞ
 
BM_COMP
,*
Ã¼
)

335 
	`lÚe¡¬_gpu
(
p¤c
,
noutgošg
,
d_p¤c
,
d_noutgošg
,
edgesd¡¤c
,
edges¤cd¡
,
hedges
,
hnodes
,
hdi¡
,
nodesigma
,
edgesigma
,
sourû_couÁ
,
sourûs
,
dp
,
BM_COMP
,
Ã¼
);

337 
	}
}

338 
	$ıu_compÚ’t
 (*
p¤c
,*
noutgošg
,*
edgesd¡¤c
,*
edges¤cd¡
,
hnodes
,
hedges
,*
hdi¡
,*
nodesigma
,*
edgesigma
,
sourû_couÁ
,*
sourûs
,
omp_lock_t
 *
lock
,
boŞ
 
BM_COMP
, 
num_th»ads
)

340 
	`b‘w“Âess_ûÁ¿l™y_·¿Î–
(
hnodes
,
hedges
,
p¤c
,
edges¤cd¡
,
edgesd¡¤c
,
noutgošg
,
sourûs
,
sourû_couÁ
,
hdi¡
,
nodesigma
,
edgesigma
,
lock
,
num_th»ads
);

342 
	}
}

344 
	$ıu_bfs_»Ïx
(
Âodes
, 
Ãdges
, *
p¤c
,*
noutgošg
,* 
edge¤c
, * 
edged¡
, * 
edgewt
, *
nodesigma
, 
fÜu
 *
nodedi¡
,*
edgesigma
,
Áh»ads
,*
bÜd”Nodes
, 
bcouÁ
,
omp_lock_t
 *
lock
,*
bÜd”
) {

345 
i
,
j
;

347  
i
 = 0; i < 
bcouÁ
; i++) {

348 
v
 = 
bÜd”Nodes
[
i
],
w
;

349 
num_edges_v
 = 
p¤c
[
v
];

350 
fÜu
 
ddi¡
;

351 
fÜu
 
wt
=1;

352 
j
 = 
num_edges_v
; j < (num_edges_v + 
noutgošg
[
v
]) ; j++) {

353 
w
 = 
edged¡
[
j
];

354 if(
bÜd”
[
w
]==0);

357 
ddi¡
 = 
nodedi¡
[
w
];

358 ià(
ddi¡
 > (
nodedi¡
[
v
] + 
wt
)) {

359 
nodedi¡
[
w
] =‚odedi¡[
v
] + 
wt
;

362 
edgesigma
[
j
] = 
nodesigma
[
v
];

364 
nodesigma
[
w
] = 
edgesigma
[
j
];

365 }ià(
ddi¡
 =ğ(
nodedi¡
[
v
] + 
wt
)){

368 
nodesigma
[
w
] -ğ
edgesigma
[
j
];

369 
edgesigma
[
j
] = 
nodesigma
[
v
];

371 
nodesigma
[
w
] +ğ
edgesigma
[
j
];

375 
	`omp_un£t_lock
(&(
lock
[
w
]));

376 
edgesigma
[
j
] = 0;

380 
	}
}

382 *
	$ıu_BFS
(*
P
){

383 
v¬to_ıu_·¹
 *
v¬
 = (v¬to_ıu_·¹ *)
P
;

384 
G¿ph
 *
g¿ph
 = 
v¬
->graph;

385 
numEdges_¤c
,
numNodes_¤c
,
sourû
 = 
v¬
->sourû,
bÜd”Index
,
ii
;

386 
num_th»ads
 = 
v¬
->num_threads;

387 
¡¬‰ime
, 
’dtime
;

389 
G¿ph
::
DeviûP¬t™iÚ
 *
¤ı¬t
 = 
v¬
->
·¹™iÚ
;

390 
G¿ph
::
P¬t™iÚ
 *
bÜd”Info
 = 
v¬
->borderInfo;

391 
numEdges_¤c
 = 
¤ı¬t
->
numEdges
;

392 
numNodes_¤c
 = 
¤ı¬t
->
numNodes
;

394 
bÜd”CouÁ
 = 
bÜd”Info
->bÜd”CouÁ[
CPUPARTITION
];

397 
	`š™nodesigmadi¡_omp
 (
sourû
,
g¿ph
->
Âodes
, 
¤ı¬t
->
nodesigma
, srı¬t->
nodedi¡
,
num_th»ads
);

398 
¡¬‰ime
 = 
	`¹şock
();

399 
	`ıu_compÚ’t
 (
¤ı¬t
->
p¤c
,¤ı¬t->
noutgošg
,¤ı¬t->
edge¤c
,¤ı¬t->
edged¡
,
g¿ph
->
Âodes
,
numEdges_¤c
,¤ı¬t->
nodedi¡
,¤ı¬t->
nodesigma
,¤ı¬t->
edgesigma
,1,&
sourû
,
v¬
->
lock
,
çl£
,
num_th»ads
);

400 
’dtime
 = 
	`¹şock
 ();

403 if(!
v¬
->
sšgË_»Ïx
)

404 
bÜd”Index
=0; bÜd”Index < 
bÜd”CouÁ
; borderIndex++){

405 
v¬
->
bÜd”VeùÜ_ıu
[
bÜd”Index
] = 
¤ı¬t
->
nodedi¡
[
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
][borderIndex]];

406 
v¬
->
bÜd”Sigma_ıu
[
bÜd”Index
] = 
¤ı¬t
->
nodesigma
[
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
][borderIndex]];

414 
	`´štf
("FÜ CPU BFS„uÁimğ%.3làms\n", 1000*(
’dtime
 -
¡¬‰ime
));

415 
v¬
->
ıu_F_I
 +ğ
’dtime
-
¡¬‰ime
;

416 
ıu_¿tiÙime
 +ğ
’dtime
-
¡¬‰ime
;

417 
	}
}

419 *
	$gpu_BFS
(*
v¬
){

420 
¡¬‰ime
, 
’dtime
;

421 
v¬to_gpu_·¹
 *
P
 = (v¬to_gpu_·¹ *)
v¬
;

422 
bÜd”Index
,
bÜd”Index2
;

423 
G¿ph
 *
g¿ph
 = 
P
->graph;

424 
numEdges
,
numNodes
,
sourû
 = 
P
->sourû,
ii
;

426 
G¿ph
::
DeviûP¬t™iÚ
 *
gpu·¹
 = 
P
->gpupart;

427 
G¿ph
::
P¬t™iÚ
 *
bÜd”Info
 = 
P
->borderInfo;

428 
numEdges
 = 
gpu·¹
->numEdges;

429 
numNodes
 = 
gpu·¹
->numNodes;

430 
fÜu
 
fÜuz”o
 = 0, 
fÜuÚe
=1;

433 
bÜd”CouÁ
 = 
bÜd”Info
->bÜd”CouÁ[
GPUPARTITION
];

434 
cudaSŒ—m_t
 
sÚe
, 
¡wo
;

435 
	`cudaSŒ—mC»©e
(&
sÚe
);

436 
	`cudaSŒ—mC»©e
(&
¡wo
);

449 
	`cudaMemıy
(&(
P
->
nodedi¡
[
sourû
]), &
fÜuz”o
, (fÜuz”o), 
cudaMemıyHo¡ToDeviû
);

450 
	`cudaMemıy
(&(
P
->
nodesigma
[
sourû
]), &
fÜuÚe
, (fÜuÚe), 
cudaMemıyHo¡ToDeviû
);

451 
¡¬‰ime
 = 
	`¹şock
();

452 
	`gpu_compÚ’t
 (
gpu·¹
->
p¤c
,gpu·¹->
noutgošg
,
P
->p¤c,P->noutgošg,P->
edge¤c
,P->
edged¡
,
numEdges
,
g¿ph
->
Âodes
,P->
nodedi¡
,P->
nodesigma
,P->
edgesigma
,1,&
sourû
,&(P->
kcÚf
->
dp
),
çl£
,P->
Ã¼
);

453 
’dtime
 = 
	`¹şock
 ();

455 
	`CUDACOPY
(
gpu·¹
->
nodedi¡
,
P
->nodedi¡,(
g¿ph
->
Âodes
è* (), 
cudaMemıyDeviûToHo¡
,
sÚe
);

456 
	`CUDACOPY
(
gpu·¹
->
nodesigma
,
P
->nodesigma,(
g¿ph
->
Âodes
è* (), 
cudaMemıyDeviûToHo¡
,
¡wo
);

457 
	`CUDACOPY
(
gpu·¹
->
edgesigma
,
P
->edgesigma,(
numEdges
è* (), 
cudaMemıyDeviûToHo¡
,
¡wo
);

458 
	`cudaSŒ—mSynchrÚize
(
sÚe
);

459 
	`cudaSŒ—mSynchrÚize
(
¡wo
);

461 if(!
P
->
sšgË_»Ïx
)

462 
bÜd”Index
=0; bÜd”Index < 
bÜd”CouÁ
; borderIndex++){

463 
P
->
bÜd”VeùÜ_gpu
[
bÜd”Index
] = 
gpu·¹
->
nodedi¡
[
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
][borderIndex]];

464 
P
->
bÜd”Sigma_gpu
[
bÜd”Index
] = 
gpu·¹
->
nodesigma
[
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
][borderIndex]];

467 
	`´štf
("FÜ GPU BFS„uÁimğ%.3làms\n", 1000*(
’dtime
 -
¡¬‰ime
));

468 
P
->
gpu_F_I
 +ğ
’dtime
-
¡¬‰ime
;

469 
gpu_¿tiÙime
 +ğ
’dtime
-
¡¬‰ime
;

473 
	`cudaSŒ—mDe¡roy
(
sÚe
);

474 
	`cudaSŒ—mDe¡roy
(
¡wo
);

476 
	}
}

478 *
	$ıu_R–ax
(*
P
){

479 
v¬to_ıu_·¹
 *
v¬
 = (v¬to_ıu_·¹ *)
P
;

480 
G¿ph
 *
g¿ph
 = 
v¬
->graph;

481 
numEdges_¤c
,
numNodes_¤c
,
sourû
 = 
v¬
->sourû,
bÜd”Index
,
ii
;

482 *
sourûs
,
sourû_couÁ
;

483 
num_th»ads
 = 
v¬
->num_threads;

485 
¡¬‰ime
, 
’dtime
;

486 
G¿ph
::
DeviûP¬t™iÚ
 *
¤ı¬t
 = 
v¬
->
·¹™iÚ
;

487 
G¿ph
::
P¬t™iÚ
 *
bÜd”Info
 = 
v¬
->borderInfo;

488 
numEdges_¤c
 = 
¤ı¬t
->
numEdges
;

489 
numNodes_¤c
 = 
¤ı¬t
->
numNodes
;

491 
bÜd”CouÁ
 = 
bÜd”Info
->bÜd”CouÁ[
CPUPARTITION
];

492 
	`š™nodesigmadi¡_muÉisourû_omp
(
g¿ph
,
v¬
->
bÜd”VeùÜ_ıu
,v¬->
bÜd”Sigma_ıu
,g¿ph->
Âodes
, 
¤ı¬t
->
nodesigma
,¤ı¬t->
nodedi¡
,
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
],
bÜd”CouÁ
,
num_th»ads
,¤ı¬t->
p¤c
,¤ı¬t->
noutgošg
,¤ı¬t->
edged¡
,bÜd”Info->
bÜd”
);

499 if(
sourû
!=
MYINFINITY
){

500 
sourû_couÁ
 = 
bÜd”CouÁ
+1;

501 
sourûs
 = (*)
	`m®loc
 ((
bÜd”CouÁ
+1)* ());

502 
sourûs
[
bÜd”CouÁ
] = 
sourû
;

503 
¤ı¬t
->
nodedi¡
[
sourû
] = 0;

504 
¤ı¬t
->
nodesigma
[
sourû
] = 1;

507 
sourûs
 = (*)
	`m®loc
 ((
bÜd”CouÁ
)* ());

508 
sourû_couÁ
 = 
bÜd”CouÁ
;

510 #ifdeà
_OPENMP


511 #´agm¨
omp
 
·¿Î–
 
	`scheduË
(è
	`num_th»ads
(
num_th»ads
)

513 
bÜd”Index
=0; bÜd”Index < 
bÜd”CouÁ
; borderIndex++)

514 
sourûs
[
bÜd”Index
] = 
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
][borderIndex];

515 
¡¬‰ime
 = 
	`¹şock
();

517 
	`ıu_compÚ’t
 (
¤ı¬t
->
p¤c
,¤ı¬t->
noutgošg
,¤ı¬t->
edge¤c
,¤ı¬t->
edged¡
,
g¿ph
->
Âodes
,
numEdges_¤c
,¤ı¬t->
nodedi¡
,¤ı¬t->
nodesigma
,¤ı¬t->
edgesigma
,
sourû_couÁ
,
sourûs
,
v¬
->
lock
,
çl£
,
num_th»ads
);

518 
’dtime
 = 
	`¹şock
 ();

525 
	`´štf
("FÜ CPU PART„uÁimğ%.3làms\n", 1000*(
’dtime
 -
¡¬‰ime
));

526 
v¬
->
ıu_F_R
 +ğ
’dtime
 -
¡¬‰ime
;

527 
	`ä“
(
sourûs
);

528 
	}
}

530 
	$ıu_SšgËR–ax
(*
P
){

531 
v¬to_ıu_·¹
 *
v¬
 = (v¬to_ıu_·¹ *)
P
;

532 
G¿ph
 *
g¿ph
 = 
v¬
->graph;

533 
numEdges_¤c
,
numNodes_¤c
,
sourû
 = 
v¬
->sourû,
bÜd”Index
,
ii
;

534 
num_th»ads
 = 
v¬
->num_threads;

536 
G¿ph
::
DeviûP¬t™iÚ
 *
¤ı¬t
 = 
v¬
->
·¹™iÚ
;

537 
G¿ph
::
P¬t™iÚ
 *
bÜd”Info
 = 
v¬
->borderInfo;

538 
numEdges_¤c
 = 
¤ı¬t
->
numEdges
;

539 
numNodes_¤c
 = 
¤ı¬t
->
numNodes
;

541 
bÜd”CouÁ
 = 
bÜd”Info
->bÜd”CouÁ[
CPUPARTITION
];

542 #ifdeà
_OPENMP


543 #´agm¨
omp
 
·¿Î–


547 
	`š™nodesigmadi¡_muÉisourû_omp_sšgË»Ïx
(
g¿ph
,
v¬
->
bÜd”VeùÜ_ıu
,v¬->
bÜd”Sigma_ıu
,g¿ph->
Âodes
, 
¤ı¬t
->
nodesigma
,¤ı¬t->
nodedi¡
,
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
],
bÜd”CouÁ
,
num_th»ads
);

555 #ifdeà
_OPENMP


556 #´agm¨
omp
 
	`scheduË
(è
	`´iv©e
(
bÜd”Index
)

558 
bÜd”Index
=0 ; bÜd”Index < 
bÜd”Info
->
bÜd”CouÁ
[
GPUPARTITION
] ; borderIndex++){

559 
¤ı¬t
->
nodedi¡
[
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
][
bÜd”Index
]] = 
v¬
->
bÜd”VeùÜ_gpu
[borderIndex];

560 
¤ı¬t
->
nodesigma
[
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
][
bÜd”Index
]] = 
v¬
->
bÜd”Sigma_gpu
[borderIndex];

562 #ifdeà
_OPENMP


565 if(
sourû
!=
MYINFINITY
){

566 
¤ı¬t
->
nodedi¡
[
sourû
] = 0;

567 
¤ı¬t
->
nodesigma
[
sourû
] = 1;

577 
	`ıu_bfs_»Ïx
(
numNodes_¤c
, 
numEdges_¤c
,
¤ı¬t
->
p¤c
,¤ı¬t->
noutgošg
,¤ı¬t->
edge¤c
, srı¬t->
edged¡
, srı¬t->
edgewt
, srı¬t->
nodesigma
, srı¬t->
nodedi¡
,¤ı¬t->
edgesigma
,
num_th»ads
,
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
],
bÜd”CouÁ
,
v¬
->
lock
,bÜd”Info->
bÜd”
);

580 #ifdeà
_OPENMP


581 #´agm¨
omp
 
·¿Î–


585 #ifdeà
_OPENMP


586 #´agm¨
omp
 
	`scheduË
(è
	`´iv©e
(
bÜd”Index
)

588 
bÜd”Index
=0; bÜd”Index < 
bÜd”Info
->
bÜd”CouÁ
[
GPUPARTITION
]; borderIndex++){

589 
v¬
->
bÜd”VeùÜ_gpu
[
bÜd”Index
] = 
¤ı¬t
->
nodedi¡
[
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
][borderIndex]];

590 
v¬
->
bÜd”Sigma_gpu
[
bÜd”Index
] = 
¤ı¬t
->
nodesigma
[
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
][borderIndex]];

594 #ifdeà
_OPENMP


595 #´agm¨
omp
 
	`scheduË
(è
	`´iv©e
(
bÜd”Index
)

597 
bÜd”Index
=0; bÜd”Index < 
bÜd”CouÁ
; borderIndex++){

598 
v¬
->
bÜd”VeùÜ_ıu
[
bÜd”Index
] = 
¤ı¬t
->
nodedi¡
[
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
][borderIndex]];

599 
v¬
->
bÜd”Sigma_ıu
[
bÜd”Index
] = 
¤ı¬t
->
nodesigma
[
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
][borderIndex]];

602 #ifdeà
_OPENMP


605 
	}
}

606 
	$gpu_SšgËR–ax
(*
P
){

607 
v¬to_gpu_·¹
 *
v¬
 = (v¬to_gpu_·¹ *)
P
;

608 
G¿ph
 *
g¿ph
 = 
v¬
->graph;

609 
numEdges_¤c
,
numNodes_¤c
,
sourû
 = 
v¬
->sourû,
bÜd”Index
;

610 
num_th»ads
 = 
v¬
->num_threads;

612 
G¿ph
::
DeviûP¬t™iÚ
 *
gpu·¹
 = 
v¬
->gpupart;

613 
G¿ph
::
P¬t™iÚ
 *
bÜd”Info
 = 
v¬
->borderInfo;

614 
numEdges_¤c
 = 
gpu·¹
->
numEdges
;

615 
numNodes_¤c
 = 
gpu·¹
->
numNodes
;

617 
bÜd”CouÁ
 = 
bÜd”Info
->bÜd”CouÁ[
GPUPARTITION
];

618 #ifdeà
_OPENMP


619 #´agm¨
omp
 
·¿Î–


622 
	`š™nodesigmadi¡_muÉisourû_omp_sšgË»Ïx
(
g¿ph
,
v¬
->
bÜd”VeùÜ_gpu
,v¬->
bÜd”Sigma_gpu
,g¿ph->
Âodes
, 
gpu·¹
->
nodesigma
,gpu·¹->
nodedi¡
,
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
],
bÜd”CouÁ
,
num_th»ads
);

630 #ifdeà
_OPENMP


631 #´agm¨
omp
 
	`scheduË
(è
	`´iv©e
(
bÜd”Index
)

633 
bÜd”Index
=0 ; bÜd”Index < 
bÜd”Info
->
bÜd”CouÁ
[
CPUPARTITION
] ; borderIndex++){

634 
gpu·¹
->
nodedi¡
[
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
][
bÜd”Index
]] = 
v¬
->
bÜd”VeùÜ_ıu
[borderIndex];

635 
gpu·¹
->
nodesigma
[
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
][
bÜd”Index
]] = 
v¬
->
bÜd”Sigma_ıu
[borderIndex];

637 #ifdeà
_OPENMP


640 if(
sourû
!=
MYINFINITY
){

641 
gpu·¹
->
nodedi¡
[
sourû
] = 0;

642 
gpu·¹
->
nodesigma
[
sourû
] = 1;

645 
	`ıu_bfs_»Ïx
(
numNodes_¤c
, 
numEdges_¤c
,
gpu·¹
->
p¤c
,gpu·¹->
noutgošg
,gpu·¹->
edge¤c
, gpu·¹->
edged¡
, gpu·¹->
edgewt
, gpu·¹->
nodesigma
, gpu·¹->
nodedi¡
,gpu·¹->
edgesigma
,
num_th»ads
,
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
],
bÜd”CouÁ
,
v¬
->
lock
,bÜd”Info->
bÜd”
);

649 #ifdeà
_OPENMP


650 #´agm¨
omp
 
·¿Î–


653 #ifdeà
_OPENMP


654 #´agm¨
omp
 
	`scheduË
(è
	`´iv©e
(
bÜd”Index
)

656 
bÜd”Index
=0; bÜd”Index < 
bÜd”CouÁ
; borderIndex++){

657 
v¬
->
bÜd”VeùÜ_gpu
[
bÜd”Index
] = 
gpu·¹
->
nodedi¡
[
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
][borderIndex]];

658 
v¬
->
bÜd”Sigma_gpu
[
bÜd”Index
] = 
gpu·¹
->
nodesigma
[
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
][borderIndex]];

662 #ifdeà
_OPENMP


663 #´agm¨
omp
 
	`scheduË
(è
	`´iv©e
(
bÜd”Index
)

665 
bÜd”Index
=0; bÜd”Index < 
bÜd”Info
->
bÜd”CouÁ
[
CPUPARTITION
]; borderIndex++){

666 
v¬
->
bÜd”VeùÜ_ıu
[
bÜd”Index
] = 
gpu·¹
->
nodedi¡
[
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
][borderIndex]];

667 
v¬
->
bÜd”Sigma_ıu
[
bÜd”Index
] = 
gpu·¹
->
nodesigma
[
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
][borderIndex]];

670 #ifdeà
_OPENMP


673 
	}
}

676 *
	$ıu_BÜd”M©rix_comp
(*
P
){

677 
Âz
 =0 ;

678 
¡¬‰ime
, 
’dtime
;

679 
¡¬‰ime
 = 
	`¹şock
();

680 
v¬to_ıu_·¹
 *
v¬
 = (v¬to_ıu_·¹ *)
P
;

681 
G¿ph
 *
g¿ph
 = 
v¬
->graph;

682 
numEdges_ıu
,
numNodes_ıu
,
bÜd”Index
,
bÜd”Index2
,
ii
,
bÜd”Sourû
;

683 
num_th»ads
 = 
v¬
->num_threads;

685 
G¿ph
::
DeviûP¬t™iÚ
 *
ıu·¹
 = 
v¬
->
·¹™iÚ
;

686 
G¿ph
::
P¬t™iÚ
 *
bÜd”Info
 = 
v¬
->borderInfo;

687 
numEdges_ıu
 = 
ıu·¹
->
numEdges
;

688 
numNodes_ıu
 = 
ıu·¹
->
numNodes
;

689 
edges_BM
=0, 
tÙ®_BM
=0;

690 
bÜd”CouÁ
 = 
bÜd”Info
->bÜd”CouÁ[
CPUPARTITION
];

691 
	`´štf
("numƒdge oàCPU PARTITION: %d\n", 
numEdges_ıu
);

693 
bÜd”Index
 = 0; bÜd”Index < 
bÜd”CouÁ
; borderIndex++)

695 
bÜd”Sourû
 = 
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
][
bÜd”Index
];

697 
	`š™nodesigmadi¡_omp
 (
bÜd”Sourû
,
g¿ph
->
Âodes
, 
ıu·¹
->
nodesigma
, cpu·¹->
nodedi¡
,
num_th»ads
);

699 
	`ıu_compÚ’t
 (
ıu·¹
->
p¤c
,ıu·¹->
noutgošg
,ıu·¹->
edge¤c
,ıu·¹->
edged¡
,
g¿ph
->
Âodes
,
numEdges_ıu
,ıu·¹->
nodedi¡
,ıu·¹->
nodesigma
,ıu·¹->
edgesigma
,1,&
bÜd”Sourû
,
v¬
->
lock
,
çl£
,
num_th»ads
);

703 
bÜd”Index2
=0; bÜd”Index2 < 
bÜd”CouÁ
; borderIndex2++){

705 
	`modify_m©rix
(
v¬
->
bÜd”M©rix_ıu
,
bÜd”Index
,
bÜd”Index2
, 
ıu·¹
->
nodedi¡
[
bÜd”Info
->
bÜd”Nodes
[
CPUPARTITION
][bÜd”Index2]],ıu·¹->
nodesigma
[borderInfo->borderNodes[CPUPARTITION][borderIndex2]]);

708 
g¿ph
->
	`´og»ssPršt
(
bÜd”CouÁ
,
bÜd”Index
);

710 
’dtime
 = 
	`¹şock
 ();

712 
	`´štf
("CPU BÜd” M©rix„uÁimğ%.3làms\n", 1000*(
’dtime
 -
¡¬‰ime
));

714 
	}
}

717 *
	$gpu_BÜd”M©rix_comp
(*
v¬
){

718 
Âz
 =0 ;

719 
¡¬‰ime
, 
’dtime
;

720 
¡¬‰ime
 = 
	`¹şock
();

721 
v¬to_gpu_·¹
 *
P
 = (v¬to_gpu_·¹ *)
v¬
;

722 
bÜd”Index
,
bÜd”Index2
;

723 
bÜd”Sourû
;

724 
G¿ph
 *
g¿ph
 = 
P
->graph;

725 
numEdges
,
numNodes
,
sourû
 = 
P
->sourû,
ii
;

726 
fÜu
 
fÜuz”o
=0,
fÜuÚe
=1;

727 
G¿ph
::
DeviûP¬t™iÚ
 *
gpu·¹
 = 
P
->gpupart;

728 
G¿ph
::
P¬t™iÚ
 *
bÜd”Info
 = 
P
->borderInfo;

729 
numEdges
 = 
gpu·¹
->numEdges;

730 
numNodes
 = 
gpu·¹
->numNodes;

733 
bÜd”CouÁ
 = 
bÜd”Info
->bÜd”CouÁ[
GPUPARTITION
];

734 
edges_BM
=0,
tÙ®_BM
=0;

735 
cudaSŒ—m_t
 
sÚe
, 
¡wo
;

736 
	`cudaSŒ—mC»©e
(&
sÚe
);

737 
	`cudaSŒ—mC»©e
(&
¡wo
);

738 *
bÜd”Di¡
 = (*)
	`m®loc
(
bÜd”CouÁ
 * ());

739 *
bÜd”Sigma
 = (*)
	`m®loc
(
bÜd”CouÁ
 * ());

741 
bÜd”Index
 = 0; bÜd”Index < 
bÜd”CouÁ
; borderIndex++)

743 
bÜd”Sourû
 = 
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
][
bÜd”Index
];

744 
	`cudaMem£t
(
P
->
edgesigma
,0,(
numEdges
) * ());

745 
	`cudaMem£t
(
P
->
nodesigma
,0,(
g¿ph
->
Âodes
)*());

746 
	`cudaMem£t
(
P
->
nodedi¡
,
MYINFINITY
,(
g¿ph
->
Âodes
)*());

747 
	`cudaMemıy
(&(
P
->
nodedi¡
[
bÜd”Sourû
]), &
fÜuz”o
, (fÜuz”o), 
cudaMemıyHo¡ToDeviû
);

748 
	`cudaMemıy
(&(
P
->
nodesigma
[
bÜd”Sourû
]), &
fÜuÚe
, (fÜuÚe), 
cudaMemıyHo¡ToDeviû
);

750 
	`gpu_compÚ’t
 (
gpu·¹
->
p¤c
,gpu·¹->
noutgošg
,
P
->p¤c,P->noutgošg,P->
edge¤c
,P->
edged¡
,
numEdges
,
g¿ph
->
Âodes
,P->
nodedi¡
,P->
nodesigma
,P->
edgesigma
,1,&
bÜd”Sourû
,&(P->
kcÚf
->
dp
),
çl£
,P->
Ã¼
);

751 
A¼ayToBÜd”
 <<<13,256>>>(
P
->
nodedi¡
,P->
nodesigma
,P->
bÜd”Di¡
, P->
bÜd”Sigma
,P->
bÜd”Nodes
,
bÜd”CouÁ
);

753 
	`CUDACOPY
(
bÜd”Di¡
,
P
->bÜd”Di¡,(
bÜd”CouÁ
è* (), 
cudaMemıyDeviûToHo¡
,
sÚe
);

754 
	`CUDACOPY
(
bÜd”Sigma
,
P
->bÜd”Sigma,(
bÜd”CouÁ
è* (), 
cudaMemıyDeviûToHo¡
,
¡wo
);

755 
	`cudaSŒ—mSynchrÚize
(
sÚe
);

756 
	`cudaSŒ—mSynchrÚize
(
¡wo
);

759 
bÜd”Index2
=0; bÜd”Index2 < 
bÜd”CouÁ
; borderIndex2++)

762 
	`modify_m©rix
(
P
->
bÜd”M©rix
,
bÜd”Index
,
bÜd”Index2
,
bÜd”Di¡
[bÜd”Index2],
bÜd”Sigma
[borderIndex2]);

775 
g¿ph
->
	`´og»ssPršt
(
bÜd”CouÁ
,
bÜd”Index
);

777 
’dtime
 = 
	`¹şock
();

778 
	`´štf
("\ÀGPU bÜd” M©rix com¶‘iÚ„uÁimğ%.3làms\n", 1000*(
’dtime
-
¡¬‰ime
));

779 
	`cudaSŒ—mDe¡roy
(
sÚe
);

780 
	`cudaSŒ—mDe¡roy
(
¡wo
);

781 
	`ä“
(
bÜd”Di¡
);

782 
	`ä“
(
bÜd”Sigma
);

785 
	`±h»ad_ex™
(
NULL
);

786 
	}
}

789 *
	$gpu_R–ax
(*
v¬
){

790 
v¬to_gpu_·¹
 *
P
 = (v¬to_gpu_·¹ *)
v¬
;

791 
G¿ph
 *
g¿ph
 = 
P
->graph;

792 
numEdges
,
numNodes
,
sourû
 = 
P
->sourû,
bÜd”Index
,
ii
;

793 
boŞ
 
hchªged
 = 
çl£
;

794 
¡¬‰ime
, 
’dtime
;

795 
G¿ph
::
P¬t™iÚ
 *
bÜd”Info
 = 
P
->borderInfo;

796 
G¿ph
::
DeviûP¬t™iÚ
 *
nÚ¤ı¬t
 = 
P
->
gpu·¹
;

797 
numEdges
 = 
nÚ¤ı¬t
->numEdges;

798 
numNodes
 = 
nÚ¤ı¬t
->numNodes;

799 *
sourûs
;

800 
bÜd”CouÁ
 = 
bÜd”Info
->bÜd”CouÁ[
GPUPARTITION
],
bcouÁ_‹mp
;

801 
cudaSŒ—m_t
 
sÚe
, 
¡wo
;

802 
	`cudaSŒ—mC»©e
(&
sÚe
);

803 
	`cudaSŒ—mC»©e
(&
¡wo
);

804 
	`š™nodesigmadi¡_muÉisourû
(
g¿ph
,
P
->
bÜd”VeùÜ_gpu
,P->
bÜd”Sigma_gpu
,g¿ph->
Âodes
, 
nÚ¤ı¬t
->
nodesigma
,nÚ¤ı¬t->
nodedi¡
,
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
],
bÜd”CouÁ
,nÚ¤ı¬t->
p¤c
,nÚ¤ı¬t->
noutgošg
,nÚ¤ı¬t->
edged¡
,bÜd”Info->
bÜd”
);

805 if(
sourû
!=
MYINFINITY
){

806 
nÚ¤ı¬t
->
nodedi¡
[
sourû
] = 0;

807 
nÚ¤ı¬t
->
nodesigma
[
sourû
] = 1;

808 
sourûs
 = (*)
	`m®loc
 ((
bÜd”CouÁ
+1) * ());

809 
sourûs
[
bÜd”CouÁ
] = 
sourû
;

810 
bcouÁ_‹mp
 = 
bÜd”CouÁ
+1;

813 
sourûs
 = (*)
	`m®loc
 ((
bÜd”CouÁ
) * ());

814 
bcouÁ_‹mp
 = 
bÜd”CouÁ
;

822 
bÜd”Index
=0; bÜd”Index < 
bÜd”CouÁ
; borderIndex++)

823 
sourûs
[
bÜd”Index
] = 
bÜd”Info
->
bÜd”Nodes
[
GPUPARTITION
][borderIndex];

831 
	`CUDACOPY
(
P
->
nodedi¡
,
nÚ¤ı¬t
->nodedi¡, (
g¿ph
->
Âodes
è* (), 
cudaMemıyHo¡ToDeviû
,
sÚe
);

832 
	`CUDACOPY
(
P
->
nodesigma
,
nÚ¤ı¬t
->nodesigma, (
g¿ph
->
Âodes
è* (), 
cudaMemıyHo¡ToDeviû
,
¡wo
);

834 
	`cudaSŒ—mSynchrÚize
(
sÚe
);

835 
	`cudaSŒ—mSynchrÚize
(
¡wo
);

837 
¡¬‰ime
 = 
	`¹şock
();

841 
	`gpu_compÚ’t
 (
nÚ¤ı¬t
->
p¤c
,nÚ¤ı¬t->
noutgošg
,
P
->p¤c,P->noutgošg,P->
edge¤c
,P->
edged¡
,
numEdges
,
g¿ph
->
Âodes
,P->
nodedi¡
,P->
nodesigma
,P->
edgesigma
,
bcouÁ_‹mp
,
sourûs
,&(P->
kcÚf
->
dp
),
çl£
,P->
Ã¼
);

842 
’dtime
 = 
	`¹şock
();

844 
	`cudaMemıy
(
nÚ¤ı¬t
->
nodedi¡
,
P
->nodedi¡,(
g¿ph
->
Âodes
è* (), 
cudaMemıyDeviûToHo¡
);

854 
	`´štf
("FÜ GPU RELAX„uÁimğ%.3làms\n", 1000*(
’dtime
 -
¡¬‰ime
));

855 
P
->
gpu_F_R
 +ğ
’dtime
 -
¡¬‰ime
;

861 
	`cudaSŒ—mDe¡roy
(
sÚe
);

862 
	`cudaSŒ—mDe¡roy
(
¡wo
);

864 
	`ä“
 (
sourûs
);

865 
	`±h»ad_ex™
(
NULL
);

868 
	}
}

871 
	$maš
(
¬gc
, *
¬gv
[]) {

872 *
nodesigma
, *
edge¤c
, *
edged¡
, *
nodedi¡
, *
edgewt
,*
p¤c
,*
noutgošg
,*
edgesigma
,*
bÜd”
,*
Ã¼
;

873 *
bÜd”Nodes
,*
bÜd”Di¡
, *
bÜd”Sigma
;

874 *
bÜd”D–
;

875 *
noded–
;

876 *
BC
;

877 
boŞ
 *
gpu_wa™
;

878 *
ıu_Ëv–
,*
ıu_Ëv–_mš
,*
gpu_Ëv–
,*
gpu_Ëv–_mš
;

879 
G¿ph
 
g¿ph
;

880 
K”ÃlCÚfig
 
	`kcÚf
(0);

881 
±h»ad_t
 
th»ad1
;

882 
¤ı¬t™iÚ
, 
nÚ¤ı¬t™iÚ
;

883 
numEdges
, 
numNodes
;

884 
sourû
;

885 
bÜd”CouÁ_ıu
, 
bÜd”Index
, 
bÜd”Index2
,
bÜd”CouÁ_gpu
;

886 
m©rix_c¤
 
bÜd”M©rix_ıu
,
bÜd”M©rix_gpu
;

887 *
bÜd”VeùÜ_ıu1
,*
bÜd”VeùÜ_ıu2
,*
bÜd”VeùÜ_gpu1
,*
bÜd”VeùÜ_gpu2
;

888 *
bÜd”Sigma_ıu
,*
bÜd”Sigma_gpu
;

889 
boŞ
 
hchªged
 ;

890 
num_th»ads
=32;

891 
v¬to_ıu_·¹
 
P
;

892 
v¬to_gpu_·¹
 
d©a_gpu
;

893 *
v”nodedi¡
;

894 
¡¬‰ime
, 
’dtime
,
Fš®¡¬‰ime
,
Fš®’dtime
,
tmp¡time
,
tm³ndtime
,
fwdph_¡¬‰ime
,
tÙ®I‹¿tiveTime
,

895 
tÙ®_fwd_time
=0,
F_R
,
tÙ®_bck_time
=0,
bckph_¡¬‰ime
,
ıu¿tio
=0,
gpu¿tio
=0,
š™_¡¬t
,
š™_’d
;

896 
i
=0;

898 ià(
¬gc
 < 2) {

899 
	`´štf
("U§ge: % <g¿ph>\n", 
¬gv
[0]);

900 
	`ex™
(1);

902 
š™_¡¬t
 = 
	`¹şock
();

903 *
šputfe
 = 
¬gv
[1];

904 
weigh‹d
 = 0;

936 if(
	`omp_g‘_num_´ocs
() <= 4)

937 
num_th»ads
 = 
	`omp_g‘_num_´ocs
();

940 
	`´štf
("NØoàCPU %d\n",
	`omp_g‘_num_´ocs
());

941 
num_th»ads
-=0;

942 
num_th»ads
=16;

945 
	`omp_£t_num_th»ads
(
num_th»ads
);

946 
	`´štf
("¬gum’ts: % %d\n", 
šputfe
,
num_th»ads
);

947 
Çme
[80]="";

948 
	`¡rÿt
(
Çme
,"./partition_metis.exe ");

949 
	`¡rÿt
(
Çme
,
šputfe
);

950 
	`sy¡em
(
Çme
);

951 
g¿ph
.
	`»ad
(
šputfe
, 
weigh‹d
);

952 
g¿ph
.
	`š™From
(graph);

967 
if¡»am
 
cfe
;

968 
cfe
.
	`İ’
("partitioninfo.txt");

969 
cfe
>>
g¿ph
.
·¹™iÚ
.
edgecut
;

970 
ii
=0;ii<
g¿ph
.
Âodes
;ii++)

971 
cfe
>>
g¿ph
.
·¹™iÚ
.
·¹
[
ii
];

972 
cfe
.
	`şo£
();

973 
g¿ph
.
	`flBÜd”AndCouÁ
(g¿ph,&g¿ph.
·¹™iÚ
);

974 
g¿ph
.
	`fÜmDeviûP¬t™iÚs
(graph);

975 
cout
<<"G¿ph‚node i : "<<
g¿ph
.
Âodes
<<
’dl
;

976 if(
¬gc
 > 2){

977 
v”nodedi¡
 = (*)
	`m®loc
((è* (
g¿ph
.
Âodes
));

979 
if¡»am
 

;

980 

.
	`İ’
(
¬gv
[2],
ios
::
š
);

981 ià(

.
	`is_İ’
()) {

982 

 >> 
v”nodedi¡
[
i
];

983 !

.
	`eof
()) {

984 
i
++;

985 

 >> 
v”nodedi¡
[
i
];

988 

.
	`şo£
();

990 
	`cudaG‘La¡E¼Ü
();

994 
g¿ph
.
num_th»ads
 =‚um_threads;

995 
	`´štf
("max‚odcouÁ: %d\n", 
g¿ph
.
maxNodeCouÁ
);

996 
	`´štf
("maxƒdgcouÁ: %d\n", 
g¿ph
.
maxEdgeCouÁ
);

997 ià(
	`cudaM®loc
((**)&
edge¤c
, (
g¿ph
.
maxEdgeCouÁ
è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocatingƒdgesrc failed");

998 ià(
	`cudaM®loc
((**)&
edged¡
, (
g¿ph
.
maxEdgeCouÁ
è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocatingƒdgedst failed");

1000 ià(
	`cudaM®loc
((**)&
edgesigma
, (
g¿ph
.
maxEdgeCouÁ
è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocatingƒdgesigma failed");

1001 ià(
	`cudaM®loc
((**)&
nodedi¡
, (
g¿ph
.
Âodes
è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚odedist failed");

1002 ià(
	`cudaM®loc
((**)&
noded–
, (
g¿ph
.
Âodes
è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚odedelta failed");

1003 ià(
	`cudaM®loc
((**)&
nodesigma
, (
g¿ph
.
Âodes
è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚odesigma failed");

1006 ià(
	`cudaM®loc
((**)&
p¤c
, (
g¿ph
.
Âodes
+1è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚odedist failed");

1007 ià(
	`cudaM®loc
((**)&
noutgošg
, (
g¿ph
.
Âodes
+1è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚odedist failed");

1008 ià(
	`cudaM®loc
((**)&
bÜd”
, (
g¿ph
.
Âodes
è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚odedist failed");

1009 ià(
	`cudaM®loc
((**)&
Ã¼
, ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚err failed");

1010 ià(
	`cudaM®loc
((**)&
gpu_wa™
, (
boŞ
)è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating gpu_wait failed");

1011 ià(
	`cudaM®loc
((**)&
bÜd”Nodes
, (
g¿ph
.
·¹™iÚ
.
bÜd”CouÁ
[
GPUPARTITION
]è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚odedist failed");

1012 ià(
	`cudaM®loc
((**)&
bÜd”Di¡
, (
g¿ph
.
·¹™iÚ
.
bÜd”CouÁ
[
GPUPARTITION
]è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚odedist failed");

1013 ià(
	`cudaM®loc
((**)&
bÜd”Sigma
, (
g¿ph
.
·¹™iÚ
.
bÜd”CouÁ
[
GPUPARTITION
]è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚odedist failed");

1014 ià(
	`cudaM®loc
((**)&
bÜd”D–
, (
g¿ph
.
·¹™iÚ
.
bÜd”CouÁ
[
GPUPARTITION
]è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚odedist failed");

1016 
kcÚf
.
	`£tMaxTh»adsP”Block
();

1017 
kcÚf
.
	`£tProbËmSize
(
g¿ph
.
maxEdgeCouÁ
);

1019 ià(!
kcÚf
.
	`cov”sProbËm
()) {

1020 
	`´štf
("Thnumb” oàth»ads(%dèdÛ nÙ cov”h´obËm(%d),‚umb” oà™em ³¸th»ad=%d.\n", 
kcÚf
.
	`g‘Numb”OfBlockTh»ads
()*kcÚf.
	`g‘Numb”OfBlocks
(), kcÚf.
	`g‘ProbËmSize
(), kconf.getProblemSize() / (kconf.getNumberOfBlockThreads()*kconf.getNumberOfBlocks()));

1023 
	`´štf
("GPU backw¬d…ha£ #block %d, #blocksiz%d\n",
kcÚf
.
	`g‘Numb”OfBlocks
(), kcÚf.
	`g‘Numb”OfBlockTh»ads
());

1025 
numEdges
 = 
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].numEdges;

1026 
numNodes
 = 
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].numNodes;

1027 
cudaSŒ—m_t
 
sÚe
, 
¡wo
,
¡h»e
,
sfour
;

1028 
	`cudaSŒ—mC»©e
(&
sÚe
);

1029 
	`cudaSŒ—mC»©e
(&
¡wo
);

1030 
	`cudaSŒ—mC»©e
(&
¡h»e
);

1031 
	`cudaSŒ—mC»©e
(&
sfour
);

1032 
	`CUDACOPY
(
edge¤c
, 
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].edge¤c, (
numEdges
è* (), 
cudaMemıyHo¡ToDeviû
,
sÚe
);

1033 
	`CUDACOPY
(
edged¡
, 
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].edged¡, (
numEdges
è* (), 
cudaMemıyHo¡ToDeviû
,
¡wo
);

1035 
	`CUDACOPY
(
p¤c
, 
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].p¤c, (g¿ph.
Âodes
+1è* (), 
cudaMemıyHo¡ToDeviû
,
sÚe
);

1036 
	`CUDACOPY
(
noutgošg
, 
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].noutgošg, (g¿ph.
Âodes
+1è* (), 
cudaMemıyHo¡ToDeviû
,
¡wo
);

1037 
	`CUDACOPY
(
bÜd”
, 
g¿ph
.
·¹™iÚ
.bÜd”, (g¿ph.
Âodes
è* (), 
cudaMemıyHo¡ToDeviû
,
¡wo
);

1038 
	`CUDACOPY
(
bÜd”Nodes
, 
g¿ph
.
·¹™iÚ
.bÜd”Nodes[
GPUPARTITION
], (g¿ph.·¹™iÚ.
bÜd”CouÁ
[GPUPARTITION]è* (), 
cudaMemıyHo¡ToDeviû
,
¡wo
);

1039 
	`cudaSŒ—mSynchrÚize
(
sÚe
);

1040 
	`cudaSŒ—mSynchrÚize
(
¡wo
);

1041 
	`cudaSŒ—mSynchrÚize
(
¡h»e
);

1043 
omp_lock_t
 *
wr™–ock
=(omp_lock_ˆ*)
	`m®loc
(
g¿ph
.
Âodes
*(omp_lock_t));

1044 
ıu_Ëv–
 = (*è
	`m®loc
 (());

1045 
gpu_Ëv–
 = (*è
	`m®loc
 (());

1046 
ıu_Ëv–_mš
 = (*è
	`m®loc
 (());

1047 
gpu_Ëv–_mš
 = (*è
	`m®loc
 (());

1050 
BC
 = (*)
	`m®loc
 ((è* 
g¿ph
.
Âodes
);

1051 
	`mem£t
(
BC
,0,((
g¿ph
.
Âodes
) * ()));

1053 
i
 = 0;˜< 
g¿ph
.
Âodes
 ; i++)

1054 
	`omp_š™_lock
(&
wr™–ock
[
i
]);

1059 
P
.
·¹™iÚ
 = &(
g¿ph
.
deviûP¬t™iÚ
[
CPUPARTITION
]);

1060 
P
.
num_th»ads
 =‚um_threads;

1061 
P
.
g¿ph
 = &graph;

1062 
P
.
bÜd”Info
 = &(
g¿ph
.
·¹™iÚ
);

1063 
P
.
bÜd”M©rix_ıu
 = &borderMatrix_cpu;

1064 
P
.
sšgË_»Ïx
 = 
Œue
;

1065 
P
.
lock
 = 
wr™–ock
;

1066 
P
.
ıu_F_I
=P.
ıu_F_R
=P.
ıu_bck_kÆ_time
=P.
ıu_fwd_kÆ_time
=P.
ıu_tÙ_bck_time
=0;

1069 
d©a_gpu
.
gpu·¹
 = &(
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
]);

1070 
d©a_gpu
.
g¿ph
 = &graph;

1071 
d©a_gpu
.
bÜd”M©rix
 = &
bÜd”M©rix_gpu
;

1072 
d©a_gpu
.
bÜd”Info
 = &(
g¿ph
.
·¹™iÚ
);

1073 
d©a_gpu
.
nodesigma
 =‚odesigma;

1074 
d©a_gpu
.
edge¤c
 =ƒdgesrc;

1075 
d©a_gpu
.
edged¡
 =ƒdgedst;

1076 
d©a_gpu
.
nodedi¡
 =‚odedist;

1077 
d©a_gpu
.
edgewt
 =ƒdgewt;

1078 
d©a_gpu
.
edgesigma
 =ƒdgesigma;

1079 
d©a_gpu
.
noded–
 =‚odedelta;

1082 
d©a_gpu
.
kcÚf
 = &kconf;

1083 
d©a_gpu
.
sšgË_»Ïx
 = 
Œue
;

1084 
d©a_gpu
.
p¤c
 =…src;

1085 
d©a_gpu
.
noutgošg
 =‚outgoing;

1086 
d©a_gpu
.
bÜd”
 = border;

1087 
d©a_gpu
.
bÜd”Nodes
 = borderNodes;

1088 
d©a_gpu
.
bÜd”Di¡
 = borderDist;

1089 
d©a_gpu
.
bÜd”Sigma
 = borderSigma;

1090 
d©a_gpu
.
bÜd”D–
 = borderDelta;

1091 
d©a_gpu
.
Ã¼
 =‚err;

1092 
d©a_gpu
.
num_th»ads
 =‚um_threads;

1093 
d©a_gpu
.
lock
 = 
wr™–ock
;

1094 
d©a_gpu
.
d_gpu_wa™
 = 
gpu_wa™
;

1095 
d©a_gpu
.
gpu_F_I
=d©a_gpu.
gpu_F_R
=d©a_gpu.
gpu_bck_kÆ_time
=d©a_gpu.
gpu_fwd_kÆ_time
=d©a_gpu.
gpu_tÙ_bck_time
=0;

1099 
bÜd”CouÁ_ıu
 = 
g¿ph
.
·¹™iÚ
.
bÜd”CouÁ
[
CPUPARTITION
];

1100 
bÜd”CouÁ_gpu
 = 
g¿ph
.
·¹™iÚ
.
bÜd”CouÁ
[
GPUPARTITION
];

1101 
bÜd”M©rix_gpu
.
row_size
ğ
bÜd”CouÁ_gpu
;

1102 
bÜd”M©rix_ıu
.
row_size
 = 
bÜd”CouÁ_ıu
;

1103 
bÜd”VeùÜ_ıu1
 = (*è
	`m®loc
 ((è* 
bÜd”CouÁ_ıu
);

1104 
bÜd”VeùÜ_ıu2
 = (*è
	`m®loc
 ((è* 
bÜd”CouÁ_ıu
);

1105 
bÜd”VeùÜ_gpu1
 = (*è
	`m®loc
 ((è* 
bÜd”CouÁ_gpu
);

1106 
bÜd”VeùÜ_gpu2
 = (*è
	`m®loc
 ((è* 
bÜd”CouÁ_gpu
);

1107 
bÜd”Sigma_ıu
 = (*è
	`m®loc
 ((è* 
bÜd”CouÁ_ıu
);

1108 
bÜd”Sigma_gpu
 = (*è
	`m®loc
 ((è* 
bÜd”CouÁ_gpu
);

1111 
	`±h»ad_ü—‹
(&
th»ad1
,
NULL
,
gpu_BÜd”M©rix_comp
,&(
d©a_gpu
));

1112 
	`ıu_BÜd”M©rix_comp
(&
P
);

1113 
	`±h»ad_još
(
th»ad1
,
NULL
);

1115 
s_couÁ_gpu
=0,
s_couÁ_ıu
=0;

1116 
num_¤cs
=1000;

1117 
	`¤ªd
 (
	`time
(
NULL
));

1118 
š™_’d
 = 
	`¹şock
();

1119 
	`´štf
("\nIn™Ÿliz©iÚ RuÁimğ%.3làms\n", 1000*(
š™_’d
-
š™_¡¬t
));

1120 
Fš®¡¬‰ime
 = 
	`¹şock
();

1122 
™”
=0 ; i‹¸< 
num_¤cs
 ; iter++) {

1123 
Œy
{

1124 
fwdph_¡¬‰ime
 = 
	`¹şock
();

1125 
	`´štf
("\nI‹¿tiÚ# %d",
™”
);

1128 if(
s_couÁ_ıu
 < 
num_¤cs
/2){

1129 
s_couÁ_ıu
++;

1131 
sourû
 = 
	`¿nd
(è% 
g¿ph
.
Âodes
;

1132 if(
g¿ph
.
·¹™iÚ
.
·¹
[
sourû
]==
CPUPARTITION
) ;

1134 }if(
s_couÁ_gpu
 < 
num_¤cs
/2){

1135 
s_couÁ_gpu
++;

1137 
sourû
 = 
	`¿nd
(è% 
g¿ph
.
Âodes
;

1138 if(
g¿ph
.
·¹™iÚ
.
·¹
[
sourû
]==
GPUPARTITION
);

1144 
	`cudaMem£t
(
edgesigma
,0,((
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].
numEdges
) * ()));

1145 
	`cudaMem£t
(
nodesigma
,0,((
g¿ph
.
Âodes
) * ()));

1146 
	`cudaMem£t
(
noded–
,0,((
g¿ph
.
Âodes
) * ()));

1147 
	`cudaMem£t
(
nodedi¡
,
MYINFINITY
,((
g¿ph
.
Âodes
) * ()));

1149 
	`mem£t
(
g¿ph
.
deviûP¬t™iÚ
[
CPUPARTITION
].
edgesigma
,0,((g¿ph.deviûP¬t™iÚ[CPUPARTITION].
numEdges
) * ()));

1150 
	`mem£t
(
g¿ph
.
deviûP¬t™iÚ
[
CPUPARTITION
].
nodesigma
,0,((g¿ph.
Âodes
) * ()));

1151 
	`mem£t
(
g¿ph
.
deviûP¬t™iÚ
[
CPUPARTITION
].
noded–
,0,((g¿ph.
Âodes
) * ()));

1152 
	`mem£t
(
g¿ph
.
deviûP¬t™iÚ
[
CPUPARTITION
].
nodedi¡
,
MYINFINITY
,((g¿ph.
Âodes
) * ()));

1153 
	`mem£t
(
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].
edgesigma
,0,((g¿ph.deviûP¬t™iÚ[GPUPARTITION].
numEdges
) * ()));

1154 
	`mem£t
(
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].
nodesigma
,0,((g¿ph.
Âodes
) * ()));

1155 
	`mem£t
(
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].
noded–
,0,((g¿ph.
Âodes
) * ()));

1156 
	`mem£t
(
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].
nodedi¡
,
MYINFINITY
,((g¿ph.
Âodes
) * ()));

1158 
bÜd”Index
=0; bÜd”Index < 
bÜd”CouÁ_gpu
; borderIndex++){

1159 
bÜd”VeùÜ_gpu1
[
bÜd”Index
] = 
bÜd”VeùÜ_gpu2
[bÜd”Index] = 
MYINFINITY
;

1160 
bÜd”Sigma_gpu
[
bÜd”Index
] = 0;

1162 
bÜd”Index
=0; bÜd”Index < 
bÜd”CouÁ_ıu
; borderIndex++){

1163 
bÜd”VeùÜ_ıu1
[
bÜd”Index
] = 
bÜd”VeùÜ_ıu2
[bÜd”Index] = 
MYINFINITY
;

1164 
bÜd”Sigma_ıu
[
bÜd”Index
] = 0;

1167 
¤ı¬t™iÚ
 = 
g¿ph
.
·¹™iÚ
.
·¹
[
sourû
];

1168 
nÚ¤ı¬t™iÚ
 = 1-
¤ı¬t™iÚ
;

1171 
P
.
·¹™iÚ
 = &(
g¿ph
.
deviûP¬t™iÚ
[
CPUPARTITION
]);

1172 
P
.
num_th»ads
 =‚um_threads;

1173 
P
.
g¿ph
 = &graph;

1174 
P
.
bÜd”Info
 = &(
g¿ph
.
·¹™iÚ
);

1175 
P
.
sšgË_»Ïx
 = 
çl£
;

1177 
d©a_gpu
.
gpu·¹
 = &(
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
]);

1178 
d©a_gpu
.
g¿ph
 = &graph;

1179 
d©a_gpu
.
¤ı¬t™iÚ
 = srcpartition;

1180 
d©a_gpu
.
nÚ¤ı¬t™iÚ
 =‚onsrcpartition;

1181 
d©a_gpu
.
g¿ph
 = &graph;

1182 
d©a_gpu
.
bÜd”Info
 = &(
g¿ph
.
·¹™iÚ
);

1183 
d©a_gpu
.
nodesigma
 =‚odesigma;

1184 
d©a_gpu
.
edge¤c
 =ƒdgesrc;

1185 
d©a_gpu
.
edged¡
 =ƒdgedst;

1186 
d©a_gpu
.
nodedi¡
 =‚odedist;

1187 
d©a_gpu
.
edgewt
 =ƒdgewt;

1188 
d©a_gpu
.
sšgË_»Ïx
 = 
çl£
;

1191 
d©a_gpu
.
kcÚf
 = &kconf;

1192 
d©a_gpu
.
p¤c
 =…src;

1193 
d©a_gpu
.
noutgošg
 =‚outgoing;

1196 
™”©iÚs
=0;

1197 if(
¤ı¬t™iÚ
==
CPUPARTITION
){

1198 
	`´štf
("\nSourû %u iÀCPU P¬t™iÚ\n",
sourû
);

1199 
P
.
sourû
 = source;

1200 
d©a_gpu
.
sourû
 = 
MYINFINITY
;

1201 
P
.
bÜd”VeùÜ_ıu
 = 
bÜd”VeùÜ_ıu1
;

1202 
P
.
bÜd”Sigma_ıu
 = borderSigma_cpu;

1205 
	`ıu_BFS
(&
P
);

1208 
¡¬‰ime
 = 
	`¹şock
();

1211 
™”©iÚs
++;

1213 
P
.
bÜd”VeùÜ_gpu
 = 
bÜd”VeùÜ_gpu1
;

1214 
P
.
bÜd”Sigma_gpu
 = borderSigma_gpu;

1216 
	`ıu_SšgËR–ax
(&
P
);

1221 
	`bÜd”M©rixVeùÜ_comp
 (&
bÜd”M©rix_gpu
,
bÜd”VeùÜ_gpu1
,
bÜd”VeùÜ_gpu2
,
bÜd”Sigma_gpu
,
bÜd”CouÁ_gpu
);

1225 #ifdeà
_OPENMP


1226 #´agm¨
omp
 
·¿Î–
 
	`scheduË
(è
	`´iv©e
(
bÜd”Index
)

1228 
bÜd”Index
=0; bÜd”Index < 
bÜd”CouÁ_ıu
; borderIndex++){

1229 
bÜd”VeùÜ_ıu2
[
bÜd”Index
] = 
bÜd”VeùÜ_ıu1
[borderIndex];

1232 
d©a_gpu
.
bÜd”VeùÜ_ıu
 = 
bÜd”VeùÜ_ıu2
;

1233 
d©a_gpu
.
bÜd”VeùÜ_gpu
 = 
bÜd”VeùÜ_gpu2
;

1234 
d©a_gpu
.
bÜd”Sigma_ıu
 = borderSigma_cpu;

1235 
d©a_gpu
.
bÜd”Sigma_gpu
 = borderSigma_gpu;

1237 
	`gpu_SšgËR–ax
 (&
d©a_gpu
);

1241 
	`bÜd”M©rixVeùÜ_comp
 (&
bÜd”M©rix_ıu
,
bÜd”VeùÜ_ıu2
,
bÜd”VeùÜ_ıu1
,
bÜd”Sigma_ıu
,
bÜd”CouÁ_ıu
);

1244 ià(
	`Equ®s
 (
bÜd”VeùÜ_ıu1
,
bÜd”VeùÜ_ıu2
,
bÜd”CouÁ_ıu
è|| 
™”©iÚs
==5)

1247 
’dtime
 = 
	`¹şock
();

1248 
	`´štf
("\nEnd oàI‹¿tiv¡•: #I‹¿tiÚ %d RuÁimğ%.3làms\ÀCPU‚ GPU simuÈ»Ïx\n", 
™”©iÚs
,1000*(
’dtime
-
¡¬‰ime
));

1249 
tÙ®I‹¿tiveTime
 +ğ
’dtime
-
¡¬‰ime
;

1250 
P
.
bÜd”VeùÜ_ıu
 = 
bÜd”VeùÜ_ıu1
;

1251 
d©a_gpu
.
bÜd”VeùÜ_gpu
 = 
bÜd”VeùÜ_gpu2
;

1252 
P
.
bÜd”Sigma_ıu
 = borderSigma_cpu;

1253 
d©a_gpu
.
bÜd”Sigma_gpu
 = borderSigma_gpu;

1254 
	`±h»ad_ü—‹
(&
th»ad1
,
NULL
,
gpu_R–ax
,&(
d©a_gpu
));

1255 
	`ıu_R–ax
(&
P
);

1256 
	`±h»ad_još
(
th»ad1
,
NULL
);

1260 
	`´štf
("\nSourû %u iÀGPU P¬t™iÚ\n",
sourû
);

1261 
d©a_gpu
.
sourû
 = source;

1262 
P
.
sourû
 = 
MYINFINITY
;

1263 
d©a_gpu
.
bÜd”VeùÜ_gpu
 = 
bÜd”VeùÜ_gpu1
; d©a_gpu.
bÜd”Sigma_gpu
 = borderSigma_gpu;

1265 
	`gpu_BFS
(&
d©a_gpu
);

1266 
¡¬‰ime
 = 
	`¹şock
();

1269 
™”©iÚs
++;

1271 
d©a_gpu
.
bÜd”VeùÜ_ıu
 = 
bÜd”VeùÜ_ıu1
; d©a_gpu.
bÜd”Sigma_ıu
 = borderSigma_cpu;

1272 
	`gpu_SšgËR–ax
(&
d©a_gpu
);

1274 
	`bÜd”M©rixVeùÜ_comp
 (&
bÜd”M©rix_ıu
,
bÜd”VeùÜ_ıu1
,
bÜd”VeùÜ_ıu2
,
bÜd”Sigma_ıu
,
bÜd”CouÁ_ıu
);

1276 #ifdeà
_OPENMP


1277 #´agm¨
omp
 
·¿Î–
 
	`scheduË
(è
	`´iv©e
(
bÜd”Index
)

1279 
bÜd”Index
=0; bÜd”Index < 
bÜd”CouÁ_gpu
; borderIndex++){

1280 
bÜd”VeùÜ_gpu2
[
bÜd”Index
] = 
bÜd”VeùÜ_gpu1
[borderIndex];

1283 
P
.
bÜd”VeùÜ_ıu
 = 
bÜd”VeùÜ_ıu2
;

1284 
P
.
bÜd”VeùÜ_gpu
 = 
bÜd”VeùÜ_gpu2
;

1285 
P
.
bÜd”Sigma_ıu
 = borderSigma_cpu;

1286 
P
.
bÜd”Sigma_gpu
 = borderSigma_gpu;

1287 
	`ıu_SšgËR–ax
 (&
P
);

1289 
	`bÜd”M©rixVeùÜ_comp
 (&
bÜd”M©rix_gpu
,
bÜd”VeùÜ_gpu2
,
bÜd”VeùÜ_gpu1
,
bÜd”Sigma_gpu
,
bÜd”CouÁ_gpu
);

1291 ià(
	`Equ®s
 (
bÜd”VeùÜ_gpu1
,
bÜd”VeùÜ_gpu2
,
bÜd”CouÁ_gpu
è|| 
™”©iÚs
==5)

1294 
’dtime
 = 
	`¹şock
();

1295 
	`´štf
("\nEnd oàI‹¿tiv¡•: #I‹¿tiÚ %d RuÁimğ%.3làms\ÀCPU‚ GPU simuÈ»Ïx\n", 
™”©iÚs
,1000*(
’dtime
-
¡¬‰ime
));

1296 
tÙ®I‹¿tiveTime
 +ğ
’dtime
-
¡¬‰ime
;

1297 
P
.
bÜd”VeùÜ_ıu
 = 
bÜd”VeùÜ_ıu2
;

1298 
d©a_gpu
.
bÜd”VeùÜ_gpu
 = 
bÜd”VeùÜ_gpu1
;

1299 
P
.
bÜd”Sigma_ıu
 = borderSigma_cpu;

1300 
d©a_gpu
.
bÜd”Sigma_gpu
 = borderSigma_gpu;

1301 
	`±h»ad_ü—‹
(&
th»ad1
,
NULL
,
gpu_R–ax
,&(
d©a_gpu
));

1302 
	`ıu_R–ax
(&
P
);

1303 
	`±h»ad_još
(
th»ad1
,
NULL
);

1305 
Fš®’dtime
 = 
	`¹şock
();

1306 
	`´štf
("\nFÜw¬d Pha£ RuÁimğ%.3làms\n", 1000*(
Fš®’dtime
-
fwdph_¡¬‰ime
));

1307 
tÙ®_fwd_time
 +ğ
Fš®’dtime
-
fwdph_¡¬‰ime
;

1309 if(
¬gc
 > 2){

1310 
	`´štf
("\nVerifyinghe BFS is correct or‚ot:-\n");

1311 
út
=0;

1312 
·¹
;

1313 
fÜu
 
di¡
;

1314 
of¡»am
 
İ
,
sigİ
;

1315 
İ
.
	`İ’
("my_bfs.txt",
ios
::
out
);

1316 
sigİ
.
	`İ’
("my_sigma.txt",
ios
::
out
);

1317 
i
 = 0 ; i < 
g¿ph
.
Âodes
 ; i++)

1319 
·¹
 = 
g¿ph
.
·¹™iÚ
.·¹[
i
];

1320 
di¡
 = 
g¿ph
.
deviûP¬t™iÚ
[
·¹
].
nodedi¡
[
i
];

1321 if(
v”nodedi¡
[
i
]!=
di¡
){

1323 
cout
<<"node: "<<
i
+1<<" P¬t™iÚ: "<<
·¹
<<" Di¡ªû origš®: "<<
v”nodedi¡
[i]<<" AlgØdi¡ªû: "<<
di¡
<<"\n";

1324 
út
++;

1327 
İ
<<
di¡
<<"\n";

1328 
sigİ
<<
g¿ph
.
deviûP¬t™iÚ
[
·¹
].
nodesigma
[
i
]<<"\n";

1330 if(
út
==0)

1331 
	`´štf
("BFS CORRECT\n");

1333 
	`´štf
("BFS NOT CORRECT, Difã»nû iÀnØoàdi¡ªû v®ue %u\n",
út
);

1334 
İ
.
	`şo£
();

1335 
sigİ
.
	`şo£
();

1338 
bckph_¡¬‰ime
 = 
	`¹şock
();

1340 *
ıu_Ëv–
 = *
gpu_Ëv–
 = 0;

1341 *
ıu_Ëv–_mš
 = *
gpu_Ëv–_mš
 = 
MYINFINITY
;

1343 
P
.
ıu_Ëv–
 = cpu_level;

1344 
P
.
gpu_Ëv–
 = gpu_level;

1345 
P
.
ıu_Ëv–_mš
 = cpu_level_min;

1346 
P
.
gpu_Ëv–_mš
 = gpu_level_min;

1347 
d©a_gpu
.
ıu_Ëv–
 = cpu_level;

1348 
d©a_gpu
.
gpu_Ëv–
 = gpu_level;

1349 
d©a_gpu
.
ıu_Ëv–_mš
 = cpu_level_min;

1350 
d©a_gpu
.
gpu_Ëv–_mš
 = gpu_level_min;

1352 #ifdeà
_OPENMP


1353 #´agm¨
omp
 
·¿Î–
 
£ùiÚs
 
	`num_th»ads
(2)

1355 #´agm¨
omp
 
£ùiÚ


1358 
ii
 = 0 ; i˜< 
g¿ph
.
Âodes
 ; ii++){

1359 ià(*
ıu_Ëv–
 < 
g¿ph
.
deviûP¬t™iÚ
[
CPUPARTITION
].
nodedi¡
[
ii
] && g¿ph.deviûP¬t™iÚ[CPUPARTITION].nodedi¡[ii]!=
MYINFINITY
)

1360 *
ıu_Ëv–
 = 
g¿ph
.
deviûP¬t™iÚ
[
CPUPARTITION
].
nodedi¡
[
ii
];

1361 ià(*
ıu_Ëv–_mš
 > 
g¿ph
.
deviûP¬t™iÚ
[
CPUPARTITION
].
nodedi¡
[
ii
])

1362 *
ıu_Ëv–_mš
 = 
g¿ph
.
deviûP¬t™iÚ
[
CPUPARTITION
].
nodedi¡
[
ii
];

1364 #ifdeà
_OPENMP


1366 #´agm¨
omp
 
£ùiÚ


1369 
ii
 = 0 ; i˜< 
g¿ph
.
Âodes
 ; ii++){

1370 ià(*
gpu_Ëv–
 < 
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].
nodedi¡
[
ii
] && g¿ph.deviûP¬t™iÚ[GPUPARTITION].nodedi¡[ii]!=
MYINFINITY
)

1371 *
gpu_Ëv–
 = 
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].
nodedi¡
[
ii
];

1372 ià(*
gpu_Ëv–_mš
 > 
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].
nodedi¡
[
ii
])

1373 *
gpu_Ëv–_mš
 = 
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].
nodedi¡
[
ii
];

1375 #ifdeà
_OPENMP


1379 
	`´štf
("\ÀCPU_Ëv–_max:%ld CPU_Lev–_mš:%ld GPU_Ëv–_max:%ld GPU_Ëv–_mš %ld\n",*
ıu_Ëv–
,*
ıu_Ëv–_mš
,*
gpu_Ëv–
,*
gpu_Ëv–_mš
);

1380 
	`±h»ad_ü—‹
(&
th»ad1
,
NULL
,
gpu_backw¬d
,&(
d©a_gpu
));

1381 
	`ıu_backw¬d
(&
P
);

1382 
	`±h»ad_još
(
th»ad1
,
NULL
);

1384 #ifdeà
_OPENMP


1385 #´agm¨
omp
 
·¿Î–
 
	`scheduË
()

1387 
i
=0 ; i < 
g¿ph
.
Âodes
 ; i++){

1388 
·¹
 = 
g¿ph
.
·¹™iÚ
.·¹[
i
];

1389 
d–
 = 
g¿ph
.
deviûP¬t™iÚ
[
·¹
].
noded–
[
i
];

1390 
BC
[
i
] +ğ
d–
;

1392 
Fš®’dtime
 = 
	`¹şock
();

1393 
tÙ®_bck_time
 +ğ
Fš®’dtime
-
bckph_¡¬‰ime
;

1394 
	`´štf
("I‹¿tiÚ RuÁimğ%.3làms\n", 1000*(
Fš®’dtime
-
fwdph_¡¬‰ime
));

1435 }
	`ÿtch
(...){

1436 
P
.
ıu_fwd_kÆ_time
 = P.
ıu_F_I
 + P.
ıu_F_R
;

1437 
d©a_gpu
.
gpu_fwd_kÆ_time
 = d©a_gpu.
gpu_F_I
 + d©a_gpu.
gpu_F_R
;

1438 
F_R
 = 
P
.
ıu_F_R
 + 
d©a_gpu
.
gpu_F_R
;

1439 
	`´štf
("\n***FORWARD PHASE RuÁimğ %.3làm ***:-\Àıu F_I„uÁimğ%.3làms", 1000*
tÙ®_fwd_time
,1000*(
P
.
ıu_F_I
));

1440 
	`´štf
("\Àgpu F_I„uÁimğ%.3làms", 1000*(
d©a_gpu
.
gpu_F_I
));

1441 
	`´štf
("\Àıu F_R„uÁimğ%.3làms", 1000*(
P
.
ıu_F_R
));

1442 
	`´štf
("\Àgpu F_R„uÁimğ%.3làms", 1000*(
d©a_gpu
.
gpu_F_R
));

1443 
	`´štf
("\ÀMAX F_R„uÁimğ%.3làms", 1000*(
F_R
));

1444 
	`´štf
("\ÀıuÙ® fÜw¬d„uÁimğ%.3làms", 1000*(
P
.
ıu_fwd_kÆ_time
));

1445 
	`´štf
("\ÀgpuÙ® fÜw¬d„uÁimğ%.3làms", 1000*(
d©a_gpu
.
gpu_fwd_kÆ_time
));

1446 
ıu_ut_fwd
 = (
P
.
ıu_fwd_kÆ_time
/
tÙ®_fwd_time
)*100;

1447 
gpu_ut_fwd
 = (
d©a_gpu
.
gpu_fwd_kÆ_time
/
tÙ®_fwd_time
)*100;

1448 
	`´štf
("\nCPU Ut=%.3làGPU Ut=%.3lf", 
ıu_ut_fwd
,
gpu_ut_fwd
);

1449 
	`´štf
("\n***I‹¿tiv¡•„uÁimğ%.3làms***", 1000*(
tÙ®I‹¿tiveTime
));

1450 
	`´štf
("\n***BACKWARD PHASE RuÁimğ %.3làm ***:-\Àıu TÙ® backw¬d„uÁimğ%.3làm ; k”ÃÈtimğ%.3làms",
P
.
ıu_tÙ_bck_time
*1000,1000*
tÙ®_bck_time
,1000*(P.
ıu_bck_kÆ_time
));

1451 
	`´štf
("\Àgpu TÙ® backw¬d„uÁimğ%.3làm ; k”ÃÈtimğ%.3làms", 
d©a_gpu
.
gpu_tÙ_bck_time
*1000,1000*(d©a_gpu.
gpu_bck_kÆ_time
));

1452 
ıu_ut_bck
 = (
P
.
ıu_bck_kÆ_time
/
tÙ®_bck_time
)*100;

1453 
gpu_ut_bck
 = (
d©a_gpu
.
gpu_bck_kÆ_time
/
tÙ®_bck_time
)*100;

1454 
	`´štf
("\nCPU Ut=%.3làGPU Ut=%.3lf",
ıu_ut_bck
,
gpu_ut_bck
);

1455 
Fš®’dtime
 = 
	`¹şock
();

1456 
	`´štf
("\n***TÙ® Fš®„uÁimğ%.3làms***\n", 1000*(
Fš®’dtime
 - 
Fš®¡¬‰ime
));

1459 
P
.
ıu_fwd_kÆ_time
 = P.
ıu_F_I
 + P.
ıu_F_R
;

1460 
d©a_gpu
.
gpu_fwd_kÆ_time
 = d©a_gpu.
gpu_F_I
 + d©a_gpu.
gpu_F_R
;

1461 
F_R
 = 
P
.
ıu_F_R
 + 
d©a_gpu
.
gpu_F_R
;

1462 
	`´štf
("\n***FORWARD PHASE RuÁimğ %.3làm ***:-\Àıu F_I„uÁimğ%.3làms", 1000*
tÙ®_fwd_time
,1000*(
P
.
ıu_F_I
));

1463 
	`´štf
("\Àgpu F_I„uÁimğ%.3làms", 1000*(
d©a_gpu
.
gpu_F_I
));

1464 
	`´štf
("\Àıu F_R„uÁimğ%.3làms", 1000*(
P
.
ıu_F_R
));

1465 
	`´štf
("\Àgpu F_R„uÁimğ%.3làms", 1000*(
d©a_gpu
.
gpu_F_R
));

1466 
	`´štf
("\ÀMAX F_R„uÁimğ%.3làms", 1000*(
F_R
));

1467 
	`´štf
("\ÀıuÙ® fÜw¬d„uÁimğ%.3làms", 1000*(
P
.
ıu_fwd_kÆ_time
));

1468 
	`´štf
("\ÀgpuÙ® fÜw¬d„uÁimğ%.3làms", 1000*(
d©a_gpu
.
gpu_fwd_kÆ_time
));

1469 
ıu_ut_fwd
 = (
P
.
ıu_fwd_kÆ_time
/
tÙ®_fwd_time
)*100;

1470 
gpu_ut_fwd
 = (
d©a_gpu
.
gpu_fwd_kÆ_time
/
tÙ®_fwd_time
)*100;

1471 
	`´štf
("\nCPU Ut=%.3làGPU Ut=%.3lf", 
ıu_ut_fwd
,
gpu_ut_fwd
);

1472 
	`´štf
("\n***I‹¿tiv¡•„uÁimğ%.3làms***", 1000*(
tÙ®I‹¿tiveTime
));

1473 
	`´štf
("\n***BACKWARD PHASE RuÁimğ %.3làm ***:-\Àıu TÙ® backw¬d„uÁimğ%.3làm ; k”ÃÈtimğ%.3làms",1000*
tÙ®_bck_time
,
P
.
ıu_tÙ_bck_time
*1000,1000*(P.
ıu_bck_kÆ_time
));

1474 
	`´štf
("\Àgpu TÙ® backw¬d„uÁimğ%.3làm ; k”ÃÈtimğ%.3làms", 
d©a_gpu
.
gpu_tÙ_bck_time
*1000,1000*(d©a_gpu.
gpu_bck_kÆ_time
));

1475 
	`´štf
("\ncudaMemıy Timğ%.3làms***", 1000*(
d©a_gpu
.
gpu_memıy
));

1476 
ıu_ut_bck
 = (
P
.
ıu_bck_kÆ_time
/
tÙ®_bck_time
)*100;

1477 
gpu_ut_bck
 = (
d©a_gpu
.
gpu_bck_kÆ_time
/
tÙ®_bck_time
)*100;

1478 
	`´štf
("\nCPU Ut=%.3làGPU Ut=%.3lf",
ıu_ut_bck
,
gpu_ut_bck
);

1479 
Fš®’dtime
 = 
	`¹şock
();

1480 
	`´štf
("\n***TÙ® Fš®„uÁimğ%.3làms***\n", 1000*(
Fš®’dtime
 - 
Fš®¡¬‰ime
));

1483 
	`cudaF»e
(
edge¤c
);

1484 
	`cudaF»e
(
edged¡
);

1486 
	`cudaF»e
(
edgesigma
);

1487 
	`cudaF»e
(
nodedi¡
);

1488 
	`cudaF»e
(
nodesigma
);

1489 
	`cudaF»e
(
noded–
);

1492 
	`cudaF»e
(
p¤c
);

1493 
	`cudaF»e
(
noutgošg
);

1494 
	`cudaF»e
(
Ã¼
);

1495 
	`cudaF»e
(
bÜd”
);

1496 
	`cudaF»e
(
bÜd”Di¡
);

1497 
	`cudaF»e
(
bÜd”Sigma
);

1498 
	`cudaF»e
(
bÜd”D–
);

1499 
	`cudaF»e
(
gpu_wa™
);

1511 
	`ä“
(
bÜd”VeùÜ_ıu1
);

1512 
	`ä“
(
bÜd”VeùÜ_gpu1
);

1513 
	`ä“
(
bÜd”VeùÜ_ıu2
);

1514 
	`ä“
(
bÜd”VeùÜ_gpu2
);

1515 
	`ä“
(
bÜd”Sigma_ıu
);

1516 
	`ä“
(
bÜd”Sigma_gpu
);

1517 if(
¬gc
 > 2)

1518 
	`ä“
(
v”nodedi¡
);

1519 
i
 = 0;˜< 
g¿ph
.
Âodes
 ; i++)

1520 
	`omp_de¡roy_lock
(&
wr™–ock
[
i
]);

1521 
	`ä“
(
wr™–ock
);

1522 
	`ä“
(
ıu_Ëv–
);

1524 
	`ä“
(
gpu_Ëv–
);

1526 
	`ä“
(
ıu_Ëv–_mš
);

1527 
	`ä“
(
gpu_Ëv–_mš
);

1528 
	`ä“
(
BC
);

1531 
	}
}

	@bfs_ddV3.cu

30 
	~<¡dio.h
>

31 
	~<cuda.h
>

32 
	~<time.h
>

33 
	~<f¡»am
>

34 
	~<¡ršg
>

35 
	~<veùÜ
>

36 
	~<io¡»am
>

37 
	~<¡ršg.h
>

38 
	~<sys/time.h
>

40 
usšg
 
Çme¥aû
 
	g¡d
;

42 
	~"commÚ.h
"

46 
	~"SŒuùs.h
"

47 
	~"wÜkli¡7.h
"

49 
	~"cudaK”Ãls.h
"

53 
	~"myuts.h
"

54 
	~<omp.h
>

63 
	#VERIFY


	)

66 
	#SWAP
(
a
,
b
è{ 
tmp
 =‡;‡ = b; b =mp; }

	)

69 
	ghÃ¼
;

70 
	$ªªya_code_func
(*
p¤c
,*
noutgošg
,*
d_p¤c
,*
d_noutgošg
,*
d_edges¤c
,*
d_edgesd¡
,
hnodes
,
hedges
,*
hdi¡
,*
nodesigma
,*
edgesigma
,
sourû_couÁ
,*
sourûs
,
cudaDeviûPrİ
 *
dp
,
boŞ
 
BM_COMP
,*
Ã¼
){

72 
NSM
;

73 
KBLOCKSIZE
;

74 
FACTOR
;

75 
şock_t
 
¡¬‰ime
, 
’dtime
;

76 
ruÁime
;

77 
™r
=0;

79 
štz”o
 = 0;

80 
timev®
 
befÜe
,
aá”
,
befÜeo
,
aá”o
;

81 
æßtz”o
 = 0;

90 
NSM
 = 
dp
->
muÉiProûssÜCouÁ
;

91 
KBLOCKSIZE
 = 
dp
->
maxTh»adsDim
[0];

96 
WÜkli¡
 
šwl
,
outwl
,*
šwÍŒ
, *
outwÍŒ
, *
tmp
;

97 
šwl
.
	`š™
();

98 
outwl
.
	`š™
();

99 
FACTOR
=((
hedges
+ (
KBLOCKSIZE
 * 
NSM
)-1)/(KBLOCKSIZE * NSM));

100 
nblocks
=
FACTOR
*
NSM
;

124 
wlsz
 = 0;

125 
šwl
.
	`’su»S·û
(13421760);

126 
outwl
.
	`’su»S·û
(13421760);

141 
s
=0; < 
sourû_couÁ
 ;s++)

143 
nout
=
noutgošg
[
sourûs
[
s
]];

144 *
k
 = (*è
	`m®loc
 (
nout
 *());

146 
i
=0;i<
nout
;i++){

147 
k
[
i
]=
p¤c
[
sourûs
[
s
]]+i;

150 
šwl
.
	`pushRªgeHo¡
(
k
,
nout
);

151 
	`ä“
(
k
);

161 
šwÍŒ
 = &
šwl
;

162 
outwÍŒ
 = &
outwl
;

176 
™r
++;

179 
	`cudaMem£t
(
Ã¼
,0,());

180 
k”Ãl_ddV3
<<<(
NSM
),
KBLOCKSIZE
/2>>>(
hdi¡
,
nodesigma
,
edgesigma
,
BM_COMP
,
d_edges¤c
,
d_edgesd¡
,
d_p¤c
,
d_noutgošg
,*
šwÍŒ
,*
outwÍŒ
,
Ã¼
);

181 
	`cudaMemıy
(&
hÃ¼
, 
Ã¼
, (hÃ¼), 
cudaMemıyDeviûToHo¡
);

182 
wlsz
 = 
outwÍŒ
->
	`g‘Size
();

186 ià(
hÃ¼
 == 0) {

187 
	`SWAP
(
šwÍŒ
, 
outwÍŒ
);

188 
outwÍŒ
->
nov”æows
 = 
šwÍŒ
->noverflows;

190 ià(++
outwÍŒ
->
nov”æows
 =ğ
MAXOVERFLOWS
) {

192 
ÿp
 = 
šwÍŒ
->
	`g‘C­ac™y
();

194 
šwÍŒ
->
	`’su»S·û
(2 * 
ÿp
);

196 
outwÍŒ
->
	`’su»S·û
(2 * 
ÿp
);

197 
šwÍŒ
->
	`­³ndHo¡
(
outwÍŒ
);

198 
outwÍŒ
->
nov”æows
 = 0;

205 
outwÍŒ
->
	`ş—rHo¡
();

206 }
wlsz
);

260 
	`cudaF»e
(
outwl
.
™ems
);

261 
	`cudaF»e
(
šwl
.
™ems
);

262 
	`cudaF»e
(
šwl
.
¡¬t
);

263 
	`cudaF»e
(
šwl
.
’d
);

264 
	`cudaF»e
(
šwl
.
ÿ·c™y
);

265 
	`cudaF»e
(
outwl
.
¡¬t
);

266 
	`cudaF»e
(
outwl
.
’d
);

267 
	`cudaF»e
(
outwl
.
ÿ·c™y
);

269 
	}
}

	@bfs_worklistc.cu

1 
	#BFS_VARIANT
 "wÜkli¡c"

	)

5 
	#AVGDEGREE
 2.5

	)

6 
	#WORKPERTHREAD
 1

	)

8 
	gNVERTICES
;

10 
	~<cub/cub.cuh
>

11 
	~"wÜkli¡c.h
"

12 
	~"gb¬.cuh
"

13 
	~"cuda_Ïunch_cÚfig.hµ
"

14 
	~"cut_sub£t.h
"

15 
	~"commÚ.h
"

16 
	~"myuts.h
"

17 
	~"SŒuùs.h
"

21 cÚ¡ 
	gBLKSIZE
 = 256;

22 cÚ¡ 
	gIN_CORE
 = 1;

25 
	g‹xtu»
 <, 1, 
	gcudaR—dModeEËm’tTy³
> 
	grow_off£ts
;

37 
__deviû__


38 
fÜu
 
	$´oûs£dge2
(
fÜu
 *
di¡
, 
hnodes
,*
nodesigma
,*
edgesigma
,*
¤c¤c
,*
edgesd¡
,
™”©iÚ
, 
edge
, &
d¡
) {

41 
d¡
 = 
edgesd¡
[
edge
];

42 
¤c
 = 
¤c¤c
[
edge
];

43 
di¡_¤c
,
di¡_d¡
;

45 ià(
d¡
 >ğ
hnodes
)  0;

47 
fÜu
 
wt
 = 1;

51 
di¡_¤c
 = 
di¡
[
¤c
];

53 
di¡_d¡
 = 
di¡
[
d¡
];

54 if((
di¡_¤c
 + 
wt
 ) < 
di¡_d¡
)

61 
	`©omicMš
(&
di¡
[
d¡
], 
di¡_¤c
+
wt
);

62 
edgesigma
[
edge
]=
cub
::
Th»adLßd
<cub::
LOAD_CG
>(
nodesigma
 + 
¤c
);

64 
	`©omicExch
(&
nodesigma
[
d¡
],
edgesigma
[
edge
]);

70 if((
di¡_¤c
 + 
wt
 ) =ğ
di¡
[
d¡
]){

71 
	`©omicSub
(&
nodesigma
[
d¡
],
edgesigma
[
edge
]);

72 
edgesigma
[
edge
]=
cub
::
Th»adLßd
<cub::
LOAD_CG
>(
nodesigma
 + 
¤c
);

73 
	`©omicAdd
(&
nodesigma
[
d¡
],
edgesigma
[
edge
]);

77 
edgesigma
[
edge
] = 0;

80 
	}
}

208 
__deviû__


209 
	$´oûs¢ode2
(
fÜu
 *
di¡
, 
hnodes
,*
nodesigma
,*
edgesigma
,*
¤c¤c
,*
edgesd¡
,*
noutgošg
 , 
WÜkli¡
 &
šwl
, WÜkli¡ &
outwl
, 
™”©iÚ
)

213 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

214 
Â
;

216 
cub
::
	tBlockSÿn
<, 
	tBLKSIZE
> BlockScan;

218 cÚ¡ 
SCRATCHSIZE
 = 
BLKSIZE
;

219 
__sh¬ed__
 
BlockSÿn
::
TempStÜage
 
‹mp_¡Üage
;

220 
__sh¬ed__
 
g©h”_off£ts
[
SCRATCHSIZE
];

222 
g©h”_off£ts
[
th»adIdx
.
x
] = 0;

224 
tÙ®_šputs
 = (*
šwl
.
dšdex
 + 
gridDim
.
x
 * 
blockDim
.x - 1)/(gridDim.x * blockDim.x);

226 
tÙ®_šputs
-- > 0)

228 
ÃighbÜsize
 = 0;

229 
ÃighbÜoff£t
 = 0;

230 
sü©ch_off£t
 = 0;

231 
tÙ®_edges
 = 0;

233 if(
šwl
.
	`pİ_id
(
id
, 
Â
))

235 if(
Â
 != -1)

237 
ÃighbÜsize
 = 
noutgošg
[
Â
];

238 
ÃighbÜoff£t
 = 
	`‹x1Dãtch
(
row_off£ts
, 
Â
);

243 
	`BlockSÿn
(
‹mp_¡Üage
).
	`ExşusiveSum
(
ÃighbÜsize
, 
sü©ch_off£t
, 
tÙ®_edges
);

245 
dÚe
 = 0;

246 
ÃighbÜsdÚe
 = 0;

252 
tÙ®_edges
 > 0)

254 
	`__synùh»ads
();

256 
i
;

257 
i
 = 0; 
ÃighbÜsdÚe
 + i < 
ÃighbÜsize
 && (
sü©ch_off£t
 + i - 
dÚe
è< 
SCRATCHSIZE
; i++)

259 
g©h”_off£ts
[
sü©ch_off£t
 + 
i
 - 
dÚe
] = 
ÃighbÜoff£t
 + 
ÃighbÜsdÚe
 + i;

262 
ÃighbÜsdÚe
 +ğ
i
;

263 
sü©ch_off£t
 +ğ
i
;

265 
	`__synùh»ads
();

267 
nút
 = 0;

268 
to_push
 = 0;

270 if(
th»adIdx
.
x
 < 
tÙ®_edges
)

272 if(
	`´oûs£dge2
(
di¡
, 
hnodes
, 
nodesigma
,
edgesigma
,
¤c¤c
,
edgesd¡
,
™”©iÚ
, 
g©h”_off£ts
[
th»adIdx
.
x
], 
to_push
))

275 
nút
 = 1;

280 
outwl
.
push_1™em
<
BlockSÿn
>(
nút
, (è
to_push
, 
BLKSIZE
);

282 
tÙ®_edges
 -ğ
BLKSIZE
;

283 
dÚe
 +ğ
BLKSIZE
;

286 
id
 +ğ
blockDim
.
x
 * 
gridDim
.x;

290 
	}
}

325 
__deviû__


326 
	$d»Ïx
(
fÜu
 *
di¡
, 
hnodes
, *
nodesigma
,*
edgesigma
,*
¤c¤c
, *
edgesd¡
,*
noutgošg
,*
g”ºo
, 
WÜkli¡
 &
šwl
, WÜkli¡& 
outwl
, 
™”©iÚ
) {

341 if(
	`´oûs¢ode2
(
di¡
, 
hnodes
,
nodesigma
,
edgesigma
,
¤c¤c
, 
edgesd¡
,
noutgošg
,
šwl
, 
outwl
, 
™”©iÚ
))

342 *
g”ºo
 = 1;

344 
	}
}

345 
__deviû__


346 
	$š™Ÿlize
(
fÜu
 *
di¡
, 
hnodes
, *
sourûs
,
couÁ
,
WÜkli¡
 &
šwl
, WÜkli¡ &
outwl
) {

348 
id
 = 0;

349 
™em
, 
ii
;

350 
id
 < 
couÁ
)

356 
™em
 = 
sourûs
[
id
];

357 
šwl
.
	`push
(
™em
);

360 ++
id
;

363 
	}
}

365 
__glob®__
 
	$d»Ïx3
(
fÜu
 *
di¡
, 
hnodes
,*
d_sourûs
,
sourû_couÁ
,*
nodesigma
,*
edgesigma
,*
¤c¤c
, *
edgesd¡
,*
noutgošg
,*
g”ºo
, 
WÜkli¡
 
šwl
, WÜkli¡ 
outwl
, 
™”©iÚ
)

367 if(
™”©iÚ
 == 0)

368 
	`š™Ÿlize
(
di¡
, 
hnodes
,
d_sourûs
,
sourû_couÁ
,
šwl
, 
outwl
);

370 
	`d»Ïx
(
di¡
, 
hnodes
,
nodesigma
,
edgesigma
,
¤c¤c
, 
edgesd¡
,
noutgošg
,
g”ºo
, 
šwl
, 
outwl
, 
™”©iÚ
);

371 
	}
}

373 
__glob®__
 
	$d»Ïx2
(
fÜu
 *
di¡
, 
hnodes
,*
d_sourûs
,
sourû_couÁ
,*
nodesigma
,*
edgesigma
,*
¤c¤c
, *
edgesd¡
,*
noutgošg
,*
g”ºo
, 
WÜkli¡
 
šwl
, WÜkli¡ 
outwl
, 
™”©iÚ
, 
Glob®B¬r›r
 
gb
)

375 if(
™”©iÚ
 == 0)

376 
	`š™Ÿlize
(
di¡
, 
hnodes
,
d_sourûs
,
sourû_couÁ
,
šwl
, 
outwl
);

379 
WÜkli¡
 *
š
;

380 
WÜkli¡
 *
out
;

381 
WÜkli¡
 *
tmp
;

383 
š
 = &
šwl
; 
out
 = &
outwl
;

385 *
š
->
dšdex
 > 0)

387 
	`d»Ïx
(
di¡
, 
hnodes
,
nodesigma
,
edgesigma
,
¤c¤c
, 
edgesd¡
,
noutgošg
,
g”ºo
, *
š
, *
out
, 
™”©iÚ
);

390 
gb
.
	`Sync
();

392 
tmp
 = 
š
;

393 
š
 = 
out
;

394 
out
 = 
tmp
;

396 *
out
->
dšdex
 = 0;

398 
™”©iÚ
++;

401 
	}
}

402 
__glob®__
 
	$´št_¬¿y
(*
a
, 
n
)

404 
id
 = 
th»adIdx
.
x
 + 
blockDim
.x * 
blockIdx
.x;

405 if(
id
 < 
n
)

406 
	`´štf
("%d %d\n", 
id
, 
a
[id]);

407 
	}
}

416 
	$lÚe¡¬_gpu
(*
p¤c
,*
noutgošg
,*
d_p¤c
,*
d_noutgošg
,*
d_edges¤c
,*
d_edgesd¡
,
hnodes
,
hedges
,*
di¡
,*
nodesigma
,*
edgesigma
,
sourû_couÁ
,*
sourûs
,
cudaDeviûPrİ
 *
deviûPrİ
,
boŞ
 
BM_COMP
,*
Ã¼
)

419 
fÜu
 
fÜuz”o
 = 0;

420 
NBLOCKS
, 
FACTOR
 = 128;

422 
™”©iÚ
 = 0;

424 *
d_sourûs
,
ii
;

426 
¡¬‰ime
, 
’dtime
;

427 
ruÁime
;

431 
NBLOCKS
 = 
deviûPrİ
->
muÉiProûssÜCouÁ
;

433 
NVERTICES
 = 
hnodes
;

435 
FACTOR
 = (
NVERTICES
 + 
MAXBLOCKSIZE
 * 
NBLOCKS
 - 1) / (MAXBLOCKSIZE * NBLOCKS);

444 ià(
	`cudaM®loc
((**)&
d_sourûs
, 
sourû_couÁ
 * ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating d_sources failed");

445 
	`cudaMemıy
(
d_sourûs
,
sourûs
,
sourû_couÁ
 * (),
cudaMemıyHo¡ToDeviû
);

453 
WÜkli¡
 
	`wl1
(
hedges
 * 2), 
	`wl2
(hedges * 2);

454 
WÜkli¡
 *
šwl
 = &
wl1
, *
outwl
 = &
wl2
;

455 
n™ems
 = 1;

458 
	`cudaBšdTextu»
(0, 
row_off£ts
, 
d_p¤c
, (
hnodes
 + 1) * ());

469 if(
IN_CORE
) {

470 
Glob®B¬r›rLiãtime
 
gb
;

471 cÚ¡ 
size_t
 
d»Ïx2_max_blocks
 = 
	`maximum_»sid’cy
(
d»Ïx2
, 
BLKSIZE
, 0);

472 
gb
.
	`S‘up
(
deviûPrİ
->
muÉiProûssÜCouÁ
 * 
d»Ïx2_max_blocks
);

488 
d»Ïx2
 <<<1, 1>>> (
di¡
, 
hnodes
,
d_sourûs
,
sourû_couÁ
,
nodesigma
,
edgesigma
,
d_edges¤c
,
d_edgesd¡
,
d_noutgošg
, 
Ã¼
, *
šwl
, *
outwl
, 0, 
gb
);

489 
d»Ïx2
 <<<(
deviûPrİ
->
muÉiProûssÜCouÁ
 * 
d»Ïx2_max_blocks
), 
BLKSIZE
>>> (
di¡
, 
hnodes
,
d_sourûs
,
sourû_couÁ
,
nodesigma
,
edgesigma
,
d_edges¤c
,
d_edgesd¡
,
d_noutgošg
, 
Ã¼
, *
šwl
, *
outwl
, 1, 
gb
);

496 
d»Ïx3
<<<1, 1>>>(
di¡
, 
hnodes
,
d_sourûs
,
sourû_couÁ
,
nodesigma
,
edgesigma
,
d_edges¤c
, 
d_edgesd¡
,
d_noutgošg
 , 
Ã¼
, *
šwl
, *
outwl
, 0);

497 
n™ems
 = 
šwl
->
	`n™ems
();

499 
n™ems
 > 0) {

500 ++
™”©iÚ
;

501 
nblocks
 = (
n™ems
 + 
BLKSIZE
 - 1) / BLKSIZE;

507 
d»Ïx3
<<<
nblocks
, 
BLKSIZE
>>>(
di¡
, 
hnodes
,
d_sourûs
,
sourû_couÁ
,
nodesigma
,
edgesigma
,
d_edges¤c
, 
d_edgesd¡
,
d_noutgošg
 , 
Ã¼
, *
šwl
, *
outwl
, 
™”©iÚ
);

509 
n™ems
 = 
outwl
->
	`n™ems
();

513 
WÜkli¡
 *
tmp
 = 
šwl
;

514 
šwl
 = 
outwl
;

515 
outwl
 = 
tmp
;

517 
outwl
->
	`»£t
();

528 
	`ä“
(
wl1
.
wl
);

529 
	`cudaF»e
(
wl1
.
dwl
);

530 
	`cudaF»e
(
wl1
.
dnsize
);

531 
	`cudaF»e
(
wl1
.
dšdex
);

532 
	`ä“
(
wl2
.
wl
);

533 
	`cudaF»e
(
wl2
.
dwl
);

534 
	`cudaF»e
(
wl2
.
dnsize
);

535 
	`cudaF»e
(
wl2
.
dšdex
);

536 
	`cudaF»e
(
d_sourûs
);

537 
	`cudaUnbšdTextu»
(
row_off£ts
);

539 
	}
}

	@common.h

1 #iâdeà
COMMON_H


2 
	#COMMON_H


	)

4 
	~<¡dio.h
>

5 
	~<cuda.h
>

6 
	~<time.h
>

7 
	~<f¡»am
>

8 
	~<¡ršg
>

9 
	~<io¡»am
>

10 
	~<lim™s
>

11 
	~<¡ršg.h
>

12 
	~<veùÜ
>

13 
	~<uni¡d.h
>

14 
	~<ÿs£¹
>

15 
	~<š‰y³s.h
>

16 
	~<uni¡d.h
>

17 
	~<¡dio.h
>

18 
	~<time.h
>

19 
	~<sys/time.h
>

20 
	~<¡dlib.h
>

21 
	~<¡d¬g.h
>

22 
	~<sys/mmª.h
>

23 
	~<sys/¡©.h
>

24 
	~<sys/ty³s.h
>

25 
	~<fú.h
>

26 
	~<uni¡d.h
>

27 
	~<ÿs£¹
>

28 
	~<š‰y³s.h
>

29 
	~<±h»ad.h
>

30 
	~<omp.h
>

31 
	~<”ºo.h
>

32 
usšg
 
Çme¥aû
 
	g¡d
;

34 
	#hªdË_”rÜ_’
(
’
, 
msg
) \

35 dØ{ 
”ºo
 = 
’
; 
	`³¼Ü
(
msg
); 
	`ex™
(
EXIT_FAILURE
); } 0)

	)

37 
	#MAXNBLOCKS
 (4*
NBLOCKS
)

	)

38 
	#BLOCKSIZE
 256

	)

39 
	#MAXBLOCKSIZE
 1024

	)

40 
	#MAXSHARED
 (48*1024)

	)

41 
	#MAXSHAREDUINT
 (
MAXSHARED
 / 4)

	)

42 
	#SHAREDPERTHREAD
 (
MAXSHAREDUINT
 / 
MAXBLOCKSIZE
)

	)

45 
	tfÜu
;

46 
	tdÜf
;

48 
šlše
 
	$¹şock
()

50 
timezÚe
 
Tzp
;

51 
timev®
 
Tp
;

52 
¡©
;

53 
¡©
 = 
	`g‘timeofday
 (&
Tp
, &
Tzp
);

54 ià(
¡©
 !ğ0è
	`´štf
("Error„eturn from gettimeofday: %d",stat);

55 (
Tp
.
tv_£c
 + Tp.
tv_u£c
*1.0e-6);

56 
	}
}

91 
	$CudaTe¡
(*
msg
)

93 
cudaE¼Ü_t
 
e
;

95 
	`cudaTh»adSynchrÚize
();

96 ià(
cudaSucûss
 !ğ(
e
 = 
	`cudaG‘La¡E¼Ü
())) {

97 
	`årštf
(
¡d”r
, "%s: %d\n", 
msg
, 
e
);

98 
	`årštf
(
¡d”r
, "%s\n", 
	`cudaG‘E¼ÜSŒšg
(
e
));

99 
	`ex™
(-1);

103 
	}
}

106 
šlše
 
	$CÚv”tSMV”2CÜes
(
majÜ
, 
mšÜ
)

110 
SM
;

111 
CÜes
;

112 } 
	tsSMtoCÜes
;

114 
sSMtoCÜes
 
nGpuArchCÜesP”SM
[] =

125 
šdex
 = 0;

126 
nGpuArchCÜesP”SM
[
šdex
].
SM
 != -1) {

127 ià(
nGpuArchCÜesP”SM
[
šdex
].
SM
 =ğ((
majÜ
 << 4è+ 
mšÜ
) ) {

128  
nGpuArchCÜesP”SM
[
šdex
].
CÜes
;

130 
šdex
++;

132 
	`´štf
("M­SMtoCÜe SM %d.%d i undefšed (¶—£ upd©tØthÏ‹¡ SDK)!\n", 
majÜ
, 
mšÜ
);

134 
	}
}

	@cpu_ddV3.cu

1 
	~<¡dio.h
>

2 
	~<omp.h
>

3 
	~"wÜkli¡_ıu.h
"

5 
	#SWAP
(
a
,
b
è{ 
tmp
 =‡;‡ = b; b =mp; }

	)

6 
	gıu_Ã¼
;

8 
	$ıu_ddV3
(*
di¡
,*
nodesigma
,*
edgesigma
,
boŞ
 
BM_COMP
,*
edges¤c
,*
edgesd¡
, *
p¤c
,*
noutgošg
,
WÜkli¡_ıu
 &
šwl
, WÜkli¡_ıu &
outwl
,*
g”ºo
,
omp_lock_t
 * 
lock
)

11 
tid
=
	`omp_g‘_th»ad_num
();

12 
¡¬t
 =*
šwl
.start;

13 
’d
=*
šwl
.end;

17 
¤c
,
d¡
,
wt
,
®t
,
Şddi¡
;

21 
wÜk
;

23 (
¡¬t
+
tid
)<
’d
){

25 
wÜk
=
šwl
.
™ems
[
¡¬t
+
tid
];

26 
¤c
=
edges¤c
[
wÜk
];

27 
d¡
=
edgesd¡
[
wÜk
];

28 
wt
=1;

31 
®t
=
di¡
[
¤c
]+
wt
;

32 
Şddi¡
=
di¡
[
d¡
];

33 
	`omp_£t_lock
(&(
lock
[
d¡
]));

34 if(
di¡
[
d¡
]>
®t
){

36 
di¡
[
d¡
] = 
®t
;

38 
	`omp_un£t_lock
(&(
lock
[
d¡
]));

53 
šdex
=
p¤c
[
d¡
];

54 
nout
=
noutgošg
[
d¡
];

55 ià(
outwl
.
	`pushRªgeEdges
(
šdex
,
nout
)) {

58 
di¡
[
d¡
] = 
Şddi¡
;

59 *
g”ºo
=1;

65 if(
di¡
[
d¡
]==
®t
 && !
BM_COMP
){

66 
	`omp_un£t_lock
(&(
lock
[
d¡
]));

67 #´agm¨
omp
 
©omic
 
upd©e


68 
nodesigma
[
d¡
] -ğ
edgesigma
[
wÜk
];

69 #´agm¨
omp
 
©omic
 
»ad


70 
edgesigma
[
wÜk
] = 
nodesigma
[
¤c
];

71 #´agm¨
omp
 
©omic
 
upd©e


72 
nodesigma
[
d¡
] +ğ
edgesigma
[
wÜk
];

74 
	`omp_un£t_lock
(&(
lock
[
d¡
]));

75 if(!
BM_COMP
){

76 #´agm¨
omp
 
©omic
 
upd©e


77 
nodesigma
[
d¡
] -ğ
edgesigma
[
wÜk
];

78 
edgesigma
[
wÜk
] = 0;

82 
tid
 +ğ
	`omp_g‘_num_th»ads
();

86 
	}
}

88 "C" 
	$wÜkli¡_ıu
(*
p¤c
,*
noutgošg
,*
edges¤c
,*
edgesd¡
,
hnodes
,
hedges
,*
hdi¡
,*
nodesigma
,*
edgesigma
,
sourû_couÁ
,*
sourûs
,
omp_lock_t
 *
wr™–ock
,
boŞ
 
BM_COMP
,
num_th»ads
){

90 
™r
 = 0;

91 
WÜkli¡_ıu
 
šwl
,
outwl
,*
šwÍŒ
, *
outwÍŒ
, *
tmp
;

92 
šwl
.
	`š™
();

93 
outwl
.
	`š™
();

96 
wlsz
 = 0;

97 
šwl
.
	`’su»S·û
(13421760);

98 
outwl
.
	`’su»S·û
(13421760);

102 
h¡¬t
, 
h’d
;

108 
s
=0; < 
sourû_couÁ
 ;s++)

110 
nout
=
noutgošg
[
sourûs
[
s
]];

111 *
k
 = (*è
	`m®loc
 (
nout
 *());

113 
i
=0;i<
nout
;i++){

114 
k
[
i
]=
p¤c
[
sourûs
[
s
]]+i;

117 
šwl
.
	`pushRªgeHo¡
(
k
,
nout
);

118 
	`ä“
(
k
);

120 *
Ã¼
 = (*è
	`m®loc
 (());

125 
šwÍŒ
 = &
šwl
;

126 
outwÍŒ
 = &
outwl
;

133 
™r
++;

135 *
Ã¼
 = 0;

136 #´agm¨
omp
 
·¿Î–
 (
nÚe
è
	`sh¬ed
(
hdi¡
,
nodesigma
,
edgesigma
,
BM_COMP
,
edges¤c
,
edgesd¡
,
p¤c
,
noutgošg
,
šwÍŒ
,
outwÍŒ
,
Ã¼
,
wr™–ock
è
	`num_th»ads
(
num_th»ads
)

138 
	`ıu_ddV3
(
hdi¡
,
nodesigma
,
edgesigma
,
BM_COMP
,
edges¤c
,
edgesd¡
,
p¤c
,
noutgošg
,*
šwÍŒ
,*
outwÍŒ
,
Ã¼
,
wr™–ock
);

142 
ıu_Ã¼
 = *
Ã¼
;

143 
wlsz
 = 
outwÍŒ
->
	`g‘Size
();

147 ià(
ıu_Ã¼
 == 0) {

148 
	`SWAP
(
šwÍŒ
, 
outwÍŒ
);

149 
outwÍŒ
->
nov”æows
 = 
šwÍŒ
->noverflows;

151 ià(++
outwÍŒ
->
nov”æows
 =ğ
MAXOVERFLOWS
) {

153 
ÿp
 = 
šwÍŒ
->
	`g‘C­ac™y
();

155 
šwÍŒ
->
	`’su»S·û
(2 * 
ÿp
);

157 
outwÍŒ
->
	`’su»S·û
(2 * 
ÿp
);

158 
šwÍŒ
->
	`­³ndHo¡
(
outwÍŒ
);

159 
outwÍŒ
->
nov”æows
 = 0;

166 
outwÍŒ
->
	`ş—rHo¡
();

167 }
wlsz
);

168 
	`ä“
(
outwl
.
™ems
);

169 
	`ä“
(
šwl
.
™ems
);

170 
	`ä“
(
šwl
.
¡¬t
);

171 
	`ä“
(
šwl
.
’d
);

172 
	`ä“
(
šwl
.
ÿ·c™y
);

173 
	`ä“
(
outwl
.
¡¬t
);

174 
	`ä“
(
outwl
.
’d
);

175 
	`ä“
(
outwl
.
ÿ·c™y
);

176 
	`ä“
(
Ã¼
);

177 
	}
}

	@cpu_nodebased.cu

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

3 
	~<as£¹.h
>

4 
	~<m©h.h
>

5 
	~<¡ršg.h
>

7 
	~<omp.h
>

10 
	~"SŒuùs.h
"

13 
	~"EMS_x86_64.h
"

14 
	~<sys/time.h
>

15 
	~"uts.h
"

16 
	#DIAGNOSTIC
 1

	)

17 
	#EXPECTED_GRAPH_DIAMETER
 10000

	)

19 
	#CACHELOG
 7

	)

20 
	#NOSHARE
(
x
è((x)<<
CACHELOG
)

	)

22 
	tvid_t
;

23 
	teid_t
;

25 
	$b‘w“Âess_ûÁ¿l™y_·¿Î–
(
hnodes
,
hedges
,*
row±rs
,*
cŞumnšdexes
, *
edges¤c
,*
noutgošg
,*
sourûs
,
sourû_couÁ
,*
nodedi¡
, *
nodesigma
, *
edgesigma
,
omp_lock_t
 *
lock
,
num_th»ads
) {

31 
vid_t
* 
__»¡riù__
 
vis™ed_v”tiûs
;

41 * 
__»¡riù__
 
num_vis™ed
;

42 *
__»¡riù__
 
vis™ed_couÁs
;

44 
vis™ed_v”tiûs
 = (
vid_t
 *è
	`ÿÎoc
(2*
hedges
 , (vid_t));

46 
	`as£¹
(
vis™ed_v”tiûs
 !ğ
NULL
);

49 
num_vis™ed
 = (*è
	`ÿÎoc
(
EXPECTED_GRAPH_DIAMETER
,());

50 
vis™ed_couÁs
 = (*è
	`ÿÎoc
(
	`NOSHARE
(
num_th»ads
+1),());

52 
	`as£¹
(
num_vis™ed
 !ğ
NULL
);

53 
	`as£¹
(
vis™ed_couÁs
 !ğ
NULL
);

59 #ifdeà
_OPENMP


60 #´agm¨
omp
 
·¿Î–
 (
nÚe
è
	`sh¬ed
(
vis™ed_v”tiûs
,
num_vis™ed
,
vis™ed_couÁs
,
hnodes
,
hedges
,
row±rs
,
cŞumnšdexes
,
edges¤c
,
noutgošg
,
sourûs
,
sourû_couÁ
,
nodedi¡
,
nodesigma
,
edgesigma
,
lock
,
num_th»ads
)

64 
vid_t
* 
__»¡riù__
 
p_vis
;

65 
vid_t
* 
__»¡riù__
 
p_vis_‹mp
;

66 
p_vis_size
, 
p_vis_couÁ
;

67 
pha£_num
;

70 
i
, 
j
, 
k
;

71 
v
, 
w
;

73 
ušt64_t
 
n
, 
m
;

74 
vid_t
* 
__»¡riù__
 
adj
;

75 
eid_t
* 
__»¡riù__
 
num_edges
;

76 
d_pha£
;

77 
tid
, 
Áh»ads
;

78 
ph_¡¬t
, 
ph_’d
;

79 
sigma_v
,
di¡_v
;

80 
eid_t
 
num_edges_v
;

81 
off£t
;

82 
MAX_NUM_PHASES
;

83 
MAX_NUM_PHASES
 = 
EXPECTED_GRAPH_DIAMETER
;

87 
m¬ked
;

89 #ià
DIAGNOSTIC


90 
–­£d_time_·¹
;

94 
tid
 = 
	`omp_g‘_th»ad_num
();

95 
Áh»ads
 = 
	`omp_g‘_num_th»ads
();

98 #ià
DIAGNOSTIC


99 ià(
tid
 == 0) {

100 
–­£d_time_·¹
 = 
	`tim”
();

104 
n
 = 
hnodes
;

105 
m
 = 
hedges
;

106 
adj
 = 
cŞumnšdexes
;

107 
num_edges
 = 
row±rs
;

109 #ifdeà
_OPENMP


110 #´agm¨
omp
 
b¬r›r


131 
p_vis_size
 = (2*
m
)/
Áh»ads
;

132 
p_vis
 = (
vid_t
 *è
	`m®loc
(
p_vis_size
*(vid_t));

134 
p_vis_couÁ
 = 0;

137 #ifdeà
_OPENMP


138 #´agm¨
omp
 
b¬r›r


141 #ifdeà
_OPENMP


142 #´agm¨
omp
 

144 
i
=0; i<(2*
m
); i++) {

148 
vis™ed_v”tiûs
[
i
] = 
MYINFINITY
;

158 
pha£_num
 = 0;

160 ià(
tid
 == 0) {

161 
ii
;

162 
ii
 = 0 ; i˜< 
sourû_couÁ
 ; ii++){

163 
vis™ed_v”tiûs
[
ii
] = 
sourûs
[ii];

167 
num_vis™ed
[
pha£_num
] = 0;

168 
num_vis™ed
[
pha£_num
+1] = 
sourû_couÁ
;

169 
vis™ed_couÁs
[
	`NOSHARE
(0)] = 0;

172 
vis™ed_couÁs
[
	`NOSHARE
(
tid
+1)] = 0;

174 
d_pha£
 = 1;

176 #ià
DIAGNOSTIC


177 ià(
tid
 == 0)

178 
–­£d_time_·¹
 = 
	`tim”
();

181 #ifdeà
_OPENMP


182 #´agm¨
omp
 
b¬r›r


185 
num_vis™ed
[
pha£_num
+1] -‚um_visited[phase_num] > 0) {

187 ià(
pha£_num
 >ğ
MAX_NUM_PHASES
 - 1) {

189 ià(
tid
 == 0)

190 
	`´štf
( "Error! Increase EXPECTED_GRAPH_DIAMETER "

195 
ph_¡¬t
 = 
num_vis™ed
[
pha£_num
];

196 
ph_’d
 = 
num_vis™ed
[
pha£_num
+1];

198 
p_vis_couÁ
 = 0;

199 
d_pha£
++;

203 #ifdeà
_OPENMP


204 #´agm¨
omp
 
b¬r›r


205 #´agm¨
omp
 
	`scheduË
(
guided
)

207 
i
 = 
ph_¡¬t
; i < 
ph_’d
; i++) {

208 
v
 = 
vis™ed_v”tiûs
[
i
];

211 
sigma_v
 = 
nodesigma
[
v
];

212 
num_edges_v
 = 
num_edges
[
v
];

214 
j
 = 
num_edges_v
; j < (num_edges_v + 
noutgošg
[
v
]) ; j++) {

217 
w
 = 
adj
[
j
];

221 
	`omp_£t_lock
(&(
lock
[
w
]));

222 ià(
nodedi¡
[
w
] > (nodedi¡[
v
]+1 )) {

226 
nodedi¡
[
w
] =‚odedi¡[
v
] + 1;

227 
	`omp_un£t_lock
(&(
lock
[
w
]));

229 #ifdeà
_OPENMP


230 
edgesigma
[
j
] = 
sigma_v
;

231 ()
	`__sync_ãtch_ªd_add
(&
nodesigma
[
w
], 
sigma_v
);

236 ià(
p_vis_couÁ
 =ğ
p_vis_size
) {

238 
p_vis_‹mp
 = (
vid_t
 *è
	`ÿÎoc
(2*
p_vis_size
,(vid_t));

240 
	`memıy
(
p_vis_‹mp
, 
p_vis
, 
p_vis_size
*(
vid_t
));

241 
	`ä“
(
p_vis
);

242 
p_vis
 = 
p_vis_‹mp
;

243 
p_vis_size
 = 2*p_vis_size;

245 
p_vis
[
p_vis_couÁ
++] = 
w
;

266 }ià(
nodedi¡
[
w
] =ğÒodedi¡[
v
] + 1)) {

267 
	`omp_un£t_lock
(&(
lock
[
w
]));

268 
edgesigma
[
j
] = -edgesigma [j];

269 ()
	`__sync_ãtch_ªd_add
(&
nodesigma
[
w
], 
edgesigma
[
j
]);

270 
edgesigma
[
j
] = 
sigma_v
;

271 ()
	`__sync_ãtch_ªd_add
(&
nodesigma
[
w
], 
sigma_v
);

287 
	`omp_un£t_lock
(&(
lock
[
w
]));

288 
edgesigma
[
j
] = 0;

307 
pha£_num
++;

309 
vis™ed_couÁs
[
	`NOSHARE
(
tid
+1)] = 
p_vis_couÁ
;

311 #ifdeà
_OPENMP


312 #´agm¨
omp
 
b¬r›r


315 ià(
tid
 == 0) {

316 
vis™ed_couÁs
[
	`NOSHARE
(0)] = 
num_vis™ed
[
pha£_num
];

317 
k
=1; k<=
Áh»ads
; k++) {

318 
vis™ed_couÁs
[
	`NOSHARE
(
k
)] += visited_counts[NOSHARE(k-1)];

320 
num_vis™ed
[
pha£_num
+1] = 
vis™ed_couÁs
[
	`NOSHARE
(
Áh»ads
)];

324 #ifdeà
_OPENMP


325 #´agm¨
omp
 
b¬r›r


327 
k
 = 
vis™ed_couÁs
[
	`NOSHARE
(
tid
)]; k < visited_counts[NOSHARE(tid+1)]; k++) {

328 
off£t
 = 
vis™ed_couÁs
[
	`NOSHARE
(
tid
)];

329 
vis™ed_v”tiûs
[
k
] = 
p_vis
[k-
off£t
];

332 #ifdeà
_OPENMP


333 #´agm¨
omp
 
b¬r›r


355 
	`ä“
(
p_vis
);

362 #ifdeà
_OPENMP


363 #´agm¨
omp
 
b¬r›r


367 
	`ä“
(
vis™ed_v”tiûs
);

368 
	`ä“
(
num_vis™ed
);

369 
	`ä“
(
vis™ed_couÁs
);

372 
	}
}

	@cudaKernels.h

10 
__glob®__


11 
	$k”Ãl_ddV3
(*
di¡
,*
nodesigma
,*
edgesigma
,
boŞ
 
BM_COMP
,*
edges¤c
,*
edgesd¡
, *
p¤c
,*
noutgošg
,
WÜkli¡
 
šwl
, WÜkli¡ 
outwl
,*
g”ºo
)

14 
tid
=
blockDim
.
x
*
blockIdx
.x+
th»adIdx
.x;

15 
¡¬t
 =*
šwl
.start;

16 
’d
=*
šwl
.end;

20 
¤c
,
d¡
,
wt
,
®t
,
Şddi¡
;

24 
wÜk
;

26 (
¡¬t
+
tid
)<
’d
){

28 
wÜk
=
šwl
.
™ems
[
¡¬t
+
tid
];

29 
¤c
=
edges¤c
[
wÜk
];

30 
d¡
=
edgesd¡
[
wÜk
];

31 
wt
=1;

34 
®t
=
di¡
[
¤c
]+
wt
;

35 
Şddi¡
=
di¡
[
d¡
];

36 if(
Şddi¡
>
®t
){

37 
	`©omicMš
(&
di¡
[
d¡
], 
®t
);

45 
šdex
=
p¤c
[
d¡
];

47 
nout
=
noutgošg
[
d¡
];

49 ià(
outwl
.
	`pushRªgeEdges
(
šdex
,
nout
)) {

51 
di¡
[
d¡
] = 
Şddi¡
;

52 *
g”ºo
=1;

59 if(
di¡
[
d¡
]==
®t
 && !
BM_COMP
){

60 
	`©omicSub
(&
nodesigma
[
d¡
],
edgesigma
[
wÜk
]);

61 
	`©omicExch
(&
edgesigma
[
wÜk
],
nodesigma
[
¤c
]);

62 
	`©omicAdd
(&
nodesigma
[
d¡
],
edgesigma
[
wÜk
]);

64 if(!
BM_COMP
){

65 
	`©omicSub
(&
nodesigma
[
d¡
],
edgesigma
[
wÜk
]);

66 
edgesigma
[
wÜk
] = 0;

69 
tid
 +ğ
gridDim
.
x
*
blockDim
.x;

73 
	}
}

	@cutil_subset.h

1 #´agm¨
Úû


3 
	#CUDA_SAFE_CALL_NO_SYNC
Ğ
ÿÎ
) { \

4 
cudaE¼Ü
 
”r
 = 
ÿÎ
; \

5 ifĞ
cudaSucûss
 !ğ
”r
) { \

6 
	`årštf
(
¡d”r
, "Cudaƒrror in file '%s' in†ine %i : %s.\n", \

7 
__FILE__
, 
__LINE__
, 
	`cudaG‘E¼ÜSŒšg
Ğ
”r
) ); \

8 
	`ex™
(
EXIT_FAILURE
); \

9 } }

	)

11 
	#CUDA_SAFE_CALL
Ğ
ÿÎ
è
	`CUDA_SAFE_CALL_NO_SYNC
(call); \

12 

	)

13 
	#CUDA_SAFE_THREAD_SYNC
( ) { \

14 
cudaE¼Ü
 
”r
 = 
	`CUT_DEVICE_SYNCHRONIZE
(); \

15 iàĞ
cudaSucûss
 !ğ
”r
) { \

16 
	`årštf
(
¡d”r
, "Cudaƒrror in file '%s' in†ine %i : %s.\n", \

17 
__FILE__
, 
__LINE__
, 
	`cudaG‘E¼ÜSŒšg
Ğ
”r
) ); \

18 } }

	)

21 
__deviû__
 
ušt
 
	$g‘_smid
() {

22 
ušt
 
»t
;

23 
	`asm
("mov.u32 %0, %smid;" : "ô"(
»t
) );

24  
»t
;

25 
	}
}

	@gbar.cuh

33 #´agm¨
Úû


35 
	~<cub/cub.cuh
>

36 
	~"cut_sub£t.h
"

42 şas 
	cGlob®B¬r›r


44 
	mpublic
:

46 
	tSyncFÏg
;

48 
	m´Ùeùed
 :

52 
SyncFÏg
* 
d_sync
;

57 
__deviû__
 
__fÜûšlše__
 
SyncFÏg
 
	$LßdCG
(
SyncFÏg
* 
d_±r
) const

59 
SyncFÏg
 
»tv®
;

60 
»tv®
 = 
cub
::
Th»adLßd
<cub::
LOAD_CG
>(
d_±r
);

61  
»tv®
;

64 
public
:

69 
	$Glob®B¬r›r
(è: 
	$d_sync
(
NULL
è{
	}
}

75 
__deviû__
 
__fÜûšlše__
 
	$Sync
() const

77 vŞ©
SyncFÏg
 *
d_vŞ_sync
 = 
d_sync
;

81 
	`__th»adãnû
();

82 
	`__synùh»ads
();

84 ià(
blockIdx
.
x
 == 0) {

87 ià(
th»adIdx
.
x
 == 0) {

88 
d_vŞ_sync
[
blockIdx
.
x
] = 1;

91 
	`__synùh»ads
();

94 
³”_block
 = 
th»adIdx
.
x
;…“r_block < 
gridDim
.x;…“r_block +ğ
blockDim
.x) {

95 
	`LßdCG
(
d_sync
 + 
³”_block
) == 0) {

96 
	`__th»adãnû_block
();

100 
	`__synùh»ads
();

103 
³”_block
 = 
th»adIdx
.
x
;…“r_block < 
gridDim
.x;…“r_block +ğ
blockDim
.x) {

104 
d_vŞ_sync
[
³”_block
] = 0;

109 ià(
th»adIdx
.
x
 == 0) {

111 
d_vŞ_sync
[
blockIdx
.
x
] = 1;

114 
	`LßdCG
(
d_sync
 + 
blockIdx
.
x
) == 1) {

115 
	`__th»adãnû_block
();

119 
	`__synùh»ads
();

121 
	}
}

131 şas 
	cGlob®B¬r›rLiãtime
 : 
public
 
Glob®B¬r›r


133 
´Ùeùed
:

136 
size_t
 
sync_by‹s
;

138 
	mpublic
:

143 
	$Glob®B¬r›rLiãtime
(è: 
	`Glob®B¬r›r
(), 
	$sync_by‹s
(0) {}

149 
cudaE¼Ü_t
 
	$Ho¡Re£t
()

151 
cudaE¼Ü_t
 
»tv®
 = 
cudaSucûss
;

152 ià(
d_sync
) {

153 
	`CUDA_SAFE_CALL
(
	`cudaF»e
(
d_sync
));

154 
d_sync
 = 
NULL
;

156 
sync_by‹s
 = 0;

157  
»tv®
;

158 
	}
}

164 
	gvœtu®
 ~
	$Glob®B¬r›rLiãtime
()

166 
	`Ho¡Re£t
();

168 
	}
}

175 
cudaE¼Ü_t
 
	$S‘up
(
sw“p_grid_size
)

177 
cudaE¼Ü_t
 
»tv®
 = 
cudaSucûss
;

179 
size_t
 
Ãw_sync_by‹s
 = 
sw“p_grid_size
 * (
SyncFÏg
);

180 ià(
Ãw_sync_by‹s
 > 
sync_by‹s
) {

182 ià(
d_sync
) {

183 
	`CUDA_SAFE_CALL
(
	`cudaF»e
(
d_sync
));

184 
»tv®
 = 
cudaSucûss
;

187 
sync_by‹s
 = 
Ãw_sync_by‹s
;

189 
	`CUDA_SAFE_CALL
(
	`cudaM®loc
((**è&
d_sync
, 
sync_by‹s
));

190 
»tv®
 = 
cudaSucûss
;

193 
	`CUDA_SAFE_CALL
(
	`cudaMem£t
(
d_sync
, 0, 
sw“p_grid_size
 * (
SyncFÏg
)));

198  
»tv®
;

199 
	}
}

	@gcc_cuda_compat.h

1 #undeà
_GLIBCXX_ATOMIC_BUILTINS


2 #undeà
_GLIBCXX_USE_INT128


	@graph28.h

1 #iâdeà
LSG_GRAPH


2 
	#LSG_GRAPH


	)

4 
	~"m‘is.h
"

6 
	#DISTANCETHRESHOLD
 150

	)

7 
	#THRESHOLDDEGREE
 256

	)

9 
	~"SŒuùs.h
"

10 
CudaTe¡
(*
msg
);

13 
__deviû__
 
	gG¿ph
::
	$g‘OutDeg»e
(
¤c
) {

14 ià(
¤c
 < 
Âodes
) {

16  
noutgošg
[
¤c
 - 
	`g‘S¹NodeFromNode
(src)];

22 
	}
}

24 
__deviû__
 
	gG¿ph
::
	$g‘De¡š©iÚ
(
¤c
, 
Áhedge
) {

26 ià(
¤c
 < 
Âodes
 && 
Áhedge
 < 
	`g‘OutDeg»e
(src)) {

27 
edge
 = 
	`g‘Fœ¡Edge
(
¤c
è+ 
Áhedge
;

28 ià(
edge
 < 
Ãdges
) {

30 
¡¬Šode
 = 
	`g‘S¹NodeFromNode
(
¤c
);

31 
¡¬‹dge
 = 
	`g‘Fœ¡Edge
(
¡¬Šode
);

35  
edges¤cd¡
[
edge
 - 
¡¬‹dge
];

38  
Âodes
;

40 ià(
¤c
 < 
Âodes
) {

45  
Âodes
;

46 
	}
}

47 
__deviû__
 
fÜu
 
	gG¿ph
::
	$g‘Weight
(
¤c
, 
Áhedge
) {

49 ià(
¤c
 < 
Âodes
 && 
Áhedge
 < 
	`g‘OutDeg»e
(src)) {

50 
edge
 = 
	`g‘Fœ¡Edge
(
¤c
è+ 
Áhedge
;

51 ià(
edge
 < 
Ãdges
) {

53 
¡¬Šode
 = 
	`g‘S¹NodeFromNode
(
¤c
);

54 
¡¬‹dge
 = 
	`g‘Fœ¡Edge
(
¡¬Šode
);

56  
edges¤cwt
[
edge
 - 
¡¬‹dge
];

59  
MYINFINITY
;

61 ià(
¤c
 < 
Âodes
) {

66  
MYINFINITY
;

67 
	}
}

69 
__deviû__
 
	gG¿ph
::
	$g‘Fœ¡Edge
(
¤c
) {

71 ià(
¤c
 < 
Âodes
) {

72 
¤úout
 = 
	`g‘OutDeg»e
(
¤c
);

76 ià(
¤úout
 > 0 && 
¤c¤c
[
¤c
 - 
	`g‘S¹NodeFromNode
(¤c)] < 
Ãdges
) {

77  
¤c¤c
[
¤c
 - 
	`g‘S¹NodeFromNode
(src)];

84 
	}
}

85 
__deviû__
 
	gG¿ph
::
	$g‘Fœ¡EdgeRªdom
(
¤c
) {

87 ià(
¤c
 < 
Âodes
) {

88 
low
 = 0, 
high
 = 
Ãdge¤esid’t
 - 1, 
mid
 = 0;

89 
myŒy
 = 0; mytry < 5; ++mytry) {

90 
mid
 = (
low
 + 
high
) / 2;

91 ià(
¤c¤c
[
mid
] =ğ
¤c
) ;

92 ià(
¤c¤c
[
mid
] > 
¤c
è{ 
high
 = mid; }

93 { 
low
 = 
mid
; }

95  
™
 * 
Ãdge¤esid’t
 + 
mid
;

99 
	}
}

100 
	gG¿ph
::
	$g‘Fœ¡EdgeBS—rch
(
¤c
) {

101 ià(
¤c
 < 
Âodes
) {

102 
low
 = 0, 
high
 = 
Ãdge¤esid’t
 - 1, 
mid
 = 0;

103 
myŒy
 = 0; myŒy < 
Ãdge¤esid’t
; ++mytry) {

104 
mid
 = (
low
 + 
high
) / 2;

105 ià(
¤c¤c
[
mid
] =ğ
¤c
) ;

106 ià(
¤c¤c
[
mid
] > 
¤c
è{ 
high
 = mid; }

107 { 
low
 = 
mid
; }

108 ià(
mid
 =ğ
low
) ;

110 ià(
¤c¤c
[
mid
] =ğ
¤c
)

111  
™
 * 
Ãdge¤esid’t
 + 
mid
;

115 
	}
}

116 
__deviû__
 
	gG¿ph
::
	$g‘MšEdge
(
¤c
) {

117 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

118 ià(
¤c
 < 
Âodes
) {

119 
¤úout
 = 
	`g‘OutDeg»e
(
¤c
);

120 ià(
¤úout
 > 0) {

121 
mšedge
 = 0;

122 
fÜu
 
mšwt
 = 
	`g‘Weight
(
¤c
, 0);

123 
ii
 = 1; i˜< 
¤úout
; ++ii) {

124 
fÜu
 
wt
 = 
	`g‘Weight
(
¤c
, 
ii
);

125 ià(
wt
 < 
mšwt
) {

126 
mšedge
 = 
ii
;

127 
mšwt
 = 
wt
;

130  
mšedge
;

132 
	`´štf
("E¼Ü: %s(%d):h»ad %d,ƒdg%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 0, 
¤úout
);

135 
	`´štf
("E¼Ü: %s(%d):h»ad %d,‚od%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
¤c
, 
Âodes
);

137 
	}
}

138 
__deviû__
 
__ho¡__
 
	gG¿ph
::
	$g‘Edge
(
edge
, &
¤c
, &
d¡
, 
fÜu
 &
wt
) {

139 ià(
edge
 < 
Ãdges
) {

140 
¤c
 = 
¤c¤c
[
edge
 % 
Ãdge¤esid’t
];

141 
d¡
 = 
edges¤cd¡
[
edge
 % 
Ãdge¤esid’t
];

142 
wt
 = 
edges¤cwt
[
edge
 % 
Ãdge¤esid’t
];

146 
	`´štf
("E¼Ü: %s(%d):ƒdg%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
edge
, 
Ãdges
);

148 
	}
}

149 
__deviû__
 
dÜf
 
	gG¿ph
::
	$g‘Insum
(
dÜf
 *
šsum
, 
Â
) {

150 ià(
Â
 < 
Âodes
) {

151  
šsum
[
Â
 - 
	`g‘S¹NodeFromNode
(nn)];

153 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

154 
	`´štf
("E¼Ü: %s(%d):h»ad %d,‚od%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
Â
, 
Âodes
);

156 
	}
}

157 
__deviû__
 
dÜf
 
	gG¿ph
::
	$g‘PR
(
dÜf
 *
´
, 
Â
) {

158 ià(
Â
 < 
Âodes
) {

159  
´
[
Â
 - 
	`g‘S¹NodeFromNode
(nn)];

161 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

162 
	`´štf
("E¼Ü: %s(%d):h»ad %d,‚od%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
Â
, 
Âodes
);

164 
	}
}

165 
__deviû__
 
	gG¿ph
::
	$£tPR
(
dÜf
 *
´
, 
Â
, dÜà
¼
) {

166 ià(
Â
 < 
Âodes
) {

168 
´
[
Â
 - 
	`g‘S¹NodeFromNode
Òn)] = 
¼
;

171 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

172 
	`´štf
("E¼Ü: %s(%d):h»ad %d,‚od%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
Â
, 
Âodes
);

173 
	}
}

174 
__deviû__
 
fÜu
 
	gG¿ph
::
	$g‘Di¡ªû
(
fÜu
 *
di¡
, 
Â
) {

175 ià(
Â
 < 
Âodes
) {

176  
di¡
[
Â
 - 
	`g‘S¹NodeFromNode
(nn)];

178 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

179 
	`´štf
("E¼Ü: %s(%d):h»ad %d,‚od%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
Â
, 
Âodes
);

181 
	}
}

182 
__deviû__
 
fÜu
 
	gG¿ph
::
	$g‘De¡š©iÚDi¡ªû
(
fÜu
 *
d¡di¡
, 
¤c
, 
Áhedge
) {

183 
edge
 = 
	`g‘Fœ¡Edge
(
¤c
è+ 
Áhedge
;

184 ià(
edge
 < 
Ãdges
) {

185 
¡¬Šode
 = 
	`g‘S¹NodeFromNode
(
¤c
);

186 
»sid’‹dge
 = 
edge
 - 
	`g‘Fœ¡Edge
(
¡¬Šode
);

188 ià(
»sid’‹dge
 < 
Ãdge¤esid’t
)

189  
d¡di¡
[
»sid’‹dge
];

191 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

192 
	`´štf
("E¼Ü: %s(%d):h»ad %d,ƒdg%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
edge
, 
Âodes
);

194 
	}
}

195 
__deviû__
 
fÜu
 
	gG¿ph
::
	$g‘De¡š©iÚDi¡ªû
(
fÜu
 *
d¡di¡
, 
edge
) {

196 ià(
edge
 < 
Ãdges
) {

198 
»sid’‹dge
 = 
edge
 % 
Ãdge¤esid’t
;

199  
d¡di¡
[
»sid’‹dge
];

201 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

202 
	`´štf
("E¼Ü: %s(%d):h»ad %d,ƒdg%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
edge
, 
Ãdges
);

204 
	}
}

205 
__deviû__
 
	gG¿ph
::
	$£tDe¡š©iÚDi¡ªû
(
fÜu
 *
d¡di¡
, 
“
, fÜu 
®tdi¡
) {

206 ià(
“
 < 
Ãdges
) {

207 
»sid’‹dge
 = 
“
 % 
Ãdge¤esid’t
;

208 
d¡di¡
[
»sid’‹dge
] = 
®tdi¡
;

211 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

212 
	`´štf
("E¼Ü: %s(%d):h»ad %d,ƒdg%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
“
, 
Ãdges
);

213 
	}
}

214 
__deviû__
 
	gG¿ph
::
	$addSigma
(
“
, *
d¡sigma
, 
¤csigma
) {

215 ià(
“
 < 
Ãdges
) {

216 
»sid’‹dge
 = 
“
 % 
Ãdge¤esid’t
;

217  
	`©omicAdd
(&
d¡sigma
[
»sid’‹dge
], 
¤csigma
);

219 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

220 
	`´štf
("E¼Ü: %s(%d):h»ad %d,ƒdg%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
“
, 
Ãdges
);

222 
	}
}

223 
__deviû__
 
	gG¿ph
::
	$g‘Sigma
(*
sigma
, 
Â
) {

224 ià(
Â
 < 
Âodes
) {

225  
sigma
[
Â
 - 
	`g‘S¹NodeFromNode
(nn)];

227 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

228 
	`´štf
("E¼Ü: %s(%d):h»ad %d,‚od%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
Â
, 
Âodes
);

230 
	}
}

231 
__deviû__
 
dÜf
 
	gG¿ph
::
	$g‘De¡š©iÚD–
(
dÜf
 *
d¡d–
, 
edge
) {

232 ià(
edge
 < 
Ãdges
) {

233 
»sid’‹dge
 = 
edge
 % 
Ãdge¤esid’t
;

234  
d¡d–
[
»sid’‹dge
];

236 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

237 
	`´štf
("E¼Ü: %s(%d):h»ad %d,ƒdg%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
edge
, 
Ãdges
);

239 
	}
}

240 
__deviû__
 
	gG¿ph
::
	$g‘De¡š©iÚSigma
(*
d¡sigma
, 
edge
) {

241 ià(
edge
 < 
Ãdges
) {

242 
»sid’‹dge
 = 
edge
 % 
Ãdge¤esid’t
;

243  
d¡sigma
[
»sid’‹dge
];

245 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

246 
	`´štf
("E¼Ü: %s(%d):h»ad %d,ƒdg%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
edge
, 
Ãdges
);

248 
	}
}

249 
__deviû__
 
dÜf
 
	gG¿ph
::
	$addD–
(
dÜf
 *
d–
, 
Â
, dÜà
v®
) {

250 ià(
Â
 < 
Âodes
) {

251  
	`©omicAdd
((*)&
d–
[
Â
 - 
	`g‘S¹NodeFromNode
Òn)], ()
v®
);

253 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

254 
	`´štf
("E¼Ü: %s(%d):h»ad %d,‚od%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
Â
, 
Âodes
);

256 
	}
}

257 
__deviû__
 
dÜf
 
	gG¿ph
::
	$addBC
(
dÜf
 *
bc
, 
Â
, dÜà
v®
) {

258 ià(
Â
 < 
Âodes
) {

259  
	`©omicAdd
((*)&
bc
[
Â
 - 
	`g‘S¹NodeFromNode
Òn)], ()
v®
);

261 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

262 
	`´štf
("E¼Ü: %s(%d):h»ad %d,‚od%d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
Â
, 
Âodes
);

264 
	}
}

265 
__deviû__
 
	gG¿ph
::
	$´štResid’tNode
(
ii
) {

266 
nout
 = 0;

267 
	`´štf
("%d(%d): ", 
ii
, 
nout
);

268 
“
 = 0;ƒ< 
nout
; ++ee) {

269 
d¡
 = 
	`g‘De¡š©iÚ
(
ii
, 
“
);

270 
fÜu
 
wt
 = 
	`g‘Weight
(
ii
, 
“
);

271 
	`´štf
("(%d %d)", 
d¡
, 
wt
);

273 
	`´štf
("\n");

275 
	}
}

276 
__deviû__
 
	gG¿ph
::
	$´štResid’t
(
™
, 
ÅršŠodes
 ) {

277 
Årš‹d
 = 0;

278 
¡¬Šode
 = 
	`g‘S¹Node
(
™
);

279 
Âode¡obecİ›d
 = (
¡¬Šode
 + 
Âode¤esid’t
 < 
Âodes
 ?‚nodesresident :‚nodes - startnode);

281 
	`´štf
("%10d(%d), s¹node=%d\n", 
Âode¤esid’t
, 
Âode¡obecİ›d
, 
¡¬Šode
);

282 
xx
 = 0, 
ii
 = 
¡¬Šode
; xx < 
Âode¡obecİ›d
; ++ii, ++xx) {

283 
	`´štResid’tNode
(
ii
);

284 ià(++
Årš‹d
 =ğ
ÅršŠodes
) ;

290 
	}
}

292 
__ho¡__
 
__deviû__
 
	gG¿ph
::
	$´št1x1
() {

294 
§vedÂode¤esid’t
 = 
Âode¤esid’t
;

295 
§vedÃdge¤esid’t
 = 
Ãdge¤esid’t
;

296 
Âode¤esid’t
 = 
Âodes
;

297 
Ãdge¤esid’t
 = 
Ãdges
;

299 
Ï¡¤c
 = 
Âodes
;

300 
“
 = 0;ƒ< 
Ãdges
; ++ee) {

301 ià(
Ï¡¤c
 !ğ
¤c¤c
[
“
]) {

302 
	`´štf
("\n%d(%d): ", 
¤c¤c
[
“
], 
noutgošg
[srcsrc[ee]]);

303 
Ï¡¤c
 = 
¤c¤c
[
“
];

305 
	`´štf
("(%d %dè", 
edges¤cd¡
[
“
], 
edges¤cwt
[ee]);

309 
Âode¤esid’t
 = 
§vedÂode¤esid’t
;

310 
Ãdge¤esid’t
 = 
§vedÃdge¤esid’t
;

311 
	}
}

313 
	gG¿ph
::
	$š™
(
³rcg¿ph
) {

314 
noutgošg
 = 
NULL
;

315 
¤c¤c
 = 
edges¤cd¡
 = 
NULL
;

316 
edges¤cwt
 = 
NULL
;

318 
Âodes
 = 
Ãdges
 = 0;

319 
Âode¤esid’t
 = 
Ãdge¤esid’t
 = 
³rcg¿ph
;

320 
™
 = 0;

321 
memÜy
 = 
NÙAÎoÿ‹d
;

323 
maxOutDeg»e
 = 
NULL
;

324 
dŸm‘”
 = 0;

325 
foundSts
 = 
çl£
;

328 
	}
}

330 
	gG¿ph
::
	$fÜmM‘isP¬t™iÚs
(
G¿ph
 &
äom
, 
P¬t™iÚ
* 
·¹™iÚ
){

331 
idx_t
 
İtiÚs
[
METIS_NOPTIONS
];

332 
idx_t
 
ncÚ
;

333 
idx_t
 *
xadj
, *
adjncy
;

334 *
deg»e
, *
nodeoff£t
;

335 
ii
, 
i
;

336 
edgešdex
, 
¤c
, 
d¡
, 
¤cšdex
, 
d¡šdex
;

338 
ncÚ
 = 1;

339 
	`METIS_S‘DeçuÉO±iÚs
(
İtiÚs
);

340 
İtiÚs
[
METIS_OPTION_PTYPE
] = 
METIS_PTYPE_RB
;

349 
xadj
 = (
idx_t
*)
	`m®loc
((idx_t)*(
Âodes
+1));

350 
deg»e
 = (*)
	`m®loc
(()*(
Âodes
+1));

351 
ii
=0; ii<
Âodes
; ii++è
deg»e
[ii] = 0;

352 
edgešdex
=0;ƒdgešdex<
Ãdges
;ƒdgeindex++){

353 
¤c
 = 
äom
.
¤c¤c
[
edgešdex
];

354 
d¡
 = 
äom
.
edges¤cd¡
[
edgešdex
];

355 
deg»e
[
¤c
]++;

356 
deg»e
[
d¡
]++;

358 
ii
=0; ii<
Âodes
+1; ii++){

359 if(
ii
==0è
xadj
[ii] = 0;

360 
xadj
[
ii
] = 
deg»e
[ii-1]+xadj[ii-1];

364 
adjncy
 = (
idx_t
*)
	`m®loc
((idx_t)*(2*
Ãdges
));

365 
nodeoff£t
 = (*)
	`m®loc
(()*
Âodes
);

366 
ii
=0; ii<
Âodes
; ii++è
nodeoff£t
[ii] = 0;

367 
edgešdex
=0;ƒdgešdex<
Ãdges
;ƒdgeindex++){

368 
¤c
 = 
äom
.
¤c¤c
[
edgešdex
];

369 
d¡
 = 
äom
.
edges¤cd¡
[
edgešdex
];

370 
¤cšdex
 = 
xadj
[
¤c
]+
nodeoff£t
[src];

371 
nodeoff£t
[
¤c
]++;

372 
adjncy
[
¤cšdex
] = 
d¡
;

373 
d¡šdex
 = 
xadj
[
d¡
]+
nodeoff£t
[dst];

374 
nodeoff£t
[
d¡
]++;

375 
adjncy
[
d¡šdex
] = 
¤c
;

391 
	`METIS_P¬tG¿phKway
((
idx_t
*)(&
Âodes
),

392 &
ncÚ
, 
xadj
, 
adjncy
, 
NULL
, NULL, NULL,

393 &(
·¹™iÚ
->
Å¬ts
), 
NULL
, NULL, 
İtiÚs
,

394 (
idx_t
*)(&(
·¹™iÚ
->
edgecut
)), (idx_t*í¬t™iÚ->
·¹
);

407 
	`ä“
(
xadj
);

408 
	`ä“
(
deg»e
);

409 
	`ä“
(
adjncy
);

410 
	`ä“
(
nodeoff£t
);

411 
	`flBÜd”AndCouÁ
(
äom
,
·¹™iÚ
);

413 
	}
}

419 
	gG¿ph
::
	$fÜmDeviûP¬t™iÚs
(
G¿ph
 &
äom
){

420 
edgešdex
;

421 
·¹™iÚIndex
;

422 
·¹™iÚEdgeIndex
;

423 * 
tm³dgešdex
;

424 
¤c
, 
d¡
;

425 
wt
;

426 
¤ı¬t™iÚ
, 
d¡·¹™iÚ
;

428 
deviûP¬t™iÚ
 = (
DeviûP¬t™iÚ
 *)
	`m®loc
((DeviûP¬t™iÚè* 
·¹™iÚ
.
Å¬ts
);

429 
tm³dgešdex
 = (*è
	`m®loc
((è* 
·¹™iÚ
.
Å¬ts
);

431 
maxEdgeCouÁ
 = 0;

432 
maxNodeCouÁ
 = 0;

433 
·¹™iÚIndex
=0 ;…¬t™iÚIndex < 
·¹™iÚ
.
Å¬ts
 ;…artitionIndex++){

434 
tm³dgešdex
[
·¹™iÚIndex
] = 0;

436 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
numEdges
 = 
·¹™iÚ
.
edgeCouÁ
[·¹™iÚIndex] + (·¹™iÚ.
edgecut
);

437 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
numNodes
 = 
·¹™iÚ
.
nodeCouÁ
[·¹™iÚIndex] +…¬t™iÚ.
bÜd”CouÁ
[1-partitionIndex];

438 if(
deviûP¬t™iÚ
[
·¹™iÚIndex
].
numEdges
 > 
maxEdgeCouÁ
){

439 
maxEdgeCouÁ
 = 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
numEdges
;

441 if(
deviûP¬t™iÚ
[
·¹™iÚIndex
].
numNodes
 > 
maxNodeCouÁ
){

442 
maxNodeCouÁ
 = 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
numNodes
;

444 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edge¤c
 = (*)
	`m®loc
((deviûP¬t™iÚ[·¹™iÚIndex].
numEdges
) * ());

445 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edged¡
 = (*)
	`m®loc
((deviûP¬t™iÚ[·¹™iÚIndex].
numEdges
) * ());

446 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edgewt
 = (*)
	`m®loc
((deviûP¬t™iÚ[·¹™iÚIndex].
numEdges
) * ());

447 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
nodedi¡
 = (*)
	`m®loc
((
äom
.
Âodes
) * ());

448 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
nodesigma
 = (*)
	`m®loc
((
äom
.
Âodes
) * ());

449 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
noded–
 = (*)
	`m®loc
((
äom
.
Âodes
) * ());

450 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
p¤c
 = (*)
	`ÿÎoc
((
äom
.
Âodes
+1), ());

451 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
p¤c
[
Âodes
] = deviûP¬t™iÚ[·¹™iÚIndex].
numEdges
;

452 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
noutgošg
 = (*)
	`ÿÎoc
((
äom
.
Âodes
+1), ());

454 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edgesigma
 = (*)
	`m®loc
((deviûP¬t™iÚ[·¹™iÚIndex].
numEdges
) * ());

466 
edgešdex
 = 0 ;ƒdgešdex < 
Ãdges
 ;ƒdgeindex++){

467 
¤c
 = 
äom
.
¤c¤c
[
edgešdex
];

468 
d¡
 = 
äom
.
edges¤cd¡
[
edgešdex
];

469 
wt
 = 
äom
.
edges¤cwt
[
edgešdex
];

471 
¤ı¬t™iÚ
 = 
·¹™iÚ
.
·¹
[
¤c
];

472 
d¡·¹™iÚ
 = 
·¹™iÚ
.
·¹
[
d¡
];

474 if(
¤ı¬t™iÚ
 =ğ
d¡·¹™iÚ
){

475 
·¹™iÚIndex
 = 
¤ı¬t™iÚ
;

476 
·¹™iÚEdgeIndex
 = 
tm³dgešdex
[
·¹™iÚIndex
];

477 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edge¤c
[
·¹™iÚEdgeIndex
] = 
¤c
;

478 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edged¡
[
·¹™iÚEdgeIndex
] = 
d¡
;

479 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edgewt
[
·¹™iÚEdgeIndex
] = 
wt
;

480 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edgesigma
[
·¹™iÚEdgeIndex
] = 0;

483 if(
deviûP¬t™iÚ
[
·¹™iÚIndex
].
noutgošg
[
¤c
]==0)deviûP¬t™iÚ[·¹™iÚIndex].
p¤c
[¤c]=
·¹™iÚEdgeIndex
;

484 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
noutgošg
[
¤c
]++;

485 
tm³dgešdex
[
·¹™iÚIndex
]++;

489 
·¹™iÚIndex
 = 
¤ı¬t™iÚ
;

490 
·¹™iÚEdgeIndex
 = 
tm³dgešdex
[
·¹™iÚIndex
];

491 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edge¤c
[
·¹™iÚEdgeIndex
] = 
¤c
;

492 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edged¡
[
·¹™iÚEdgeIndex
] = 
d¡
;

493 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edgewt
[
·¹™iÚEdgeIndex
] = 
wt
;

495 if(
deviûP¬t™iÚ
[
·¹™iÚIndex
].
noutgošg
[
¤c
]==0)deviûP¬t™iÚ[·¹™iÚIndex].
p¤c
[¤c]=
·¹™iÚEdgeIndex
;

496 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
noutgošg
[
¤c
]++;

497 
tm³dgešdex
[
·¹™iÚIndex
]++;

499 
·¹™iÚIndex
 = 
d¡·¹™iÚ
;

500 
·¹™iÚEdgeIndex
 = 
tm³dgešdex
[
·¹™iÚIndex
];

501 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edge¤c
[
·¹™iÚEdgeIndex
] = 
¤c
;

502 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edged¡
[
·¹™iÚEdgeIndex
] = 
d¡
;

503 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edgewt
[
·¹™iÚEdgeIndex
] = 
wt
;

506 if(
deviûP¬t™iÚ
[
·¹™iÚIndex
].
noutgošg
[
¤c
]==0)deviûP¬t™iÚ[·¹™iÚIndex].
p¤c
[¤c]=
·¹™iÚEdgeIndex
;

507 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
noutgošg
[
¤c
]++;

508 
tm³dgešdex
[
·¹™iÚIndex
]++;

512 
·¹™iÚIndex
=0 ;…¬t™iÚIndex < 
·¹™iÚ
.
Å¬ts
 ;…artitionIndex++){

513 
deviûP¬t™iÚ
[
·¹™iÚIndex
].
noutgošg
[
äom
.
Âodes
] = devicePartition[partitionIndex].noutgoing[from.nnodes-1];

515 
	`ä“
(
tm³dgešdex
);

516 
	}
}

517 
	gG¿ph
::
	$»moveDeviûP¬t™iÚs
(
G¿ph
 &
äom
){

518 
·¹™iÚIndex
=0 ;…¬t™iÚIndex < 
·¹™iÚ
.
Å¬ts
 ;…artitionIndex++){

519 
	`ä“
(
äom
.
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edge¤c
);

520 
	`ä“
(
äom
.
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edged¡
);

521 
	`ä“
(
äom
.
deviûP¬t™iÚ
[
·¹™iÚIndex
].
nodedi¡
);

522 
	`ä“
(
äom
.
deviûP¬t™iÚ
[
·¹™iÚIndex
].
nodesigma
);

523 
	`ä“
(
äom
.
deviûP¬t™iÚ
[
·¹™iÚIndex
].
noded–
);

525 
	`ä“
(
äom
.
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edgesigma
);

526 
	`ä“
(
äom
.
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edgewt
);

527 
	`ä“
(
äom
.
deviûP¬t™iÚ
[
·¹™iÚIndex
].
noutgošg
);

528 
	`ä“
(
äom
.
deviûP¬t™iÚ
[
·¹™iÚIndex
].
p¤c
);

531 
	`ä“
(
äom
.
deviûP¬t™iÚ
);

532 
	}
}

534 
	gG¿ph
::
	$flBÜd”AndCouÁ
(
G¿ph
 &
äom
, 
P¬t™iÚ
 * 
·¹™iÚ
){

535 
edgešdex
, 
bÜd”šdex
;

536 
·¹™iÚNumb”
;

537 
¤c
, 
d¡
, 
ii
;

538 
i
;

540 
i
=0 ; i < 
·¹™iÚ
->
Å¬ts
; i++){

541 
·¹™iÚ
->
bÜd”CouÁ
[
i
] = 0;

542 
·¹™iÚ
->
nodeCouÁ
[
i
] = 0;

543 
·¹™iÚ
->
edgeCouÁ
[
i
] = 0;

548 
ii
=0; ii<
Âodes
; ii++)

549 
·¹™iÚ
->
bÜd”
[
ii
] = 0;

551 
edgešdex
=0;ƒdgešdex<
Ãdges
;ƒdgeindex++){

552 
¤c
 = 
äom
.
¤c¤c
[
edgešdex
];

553 
d¡
 = 
äom
.
edges¤cd¡
[
edgešdex
];

554 if(
·¹™iÚ
->
·¹
[
¤c
] !ğ·¹™iÚ->·¹[
d¡
]){

555 
·¹™iÚ
->
bÜd”
[
¤c
]++;

556 
·¹™iÚ
->
bÜd”
[
d¡
]++;

559 
·¹™iÚNumb”
 = 
·¹™iÚ
->
·¹
[
¤c
];

560 
·¹™iÚ
->
edgeCouÁ
[
·¹™iÚNumb”
]++;

565 
i
=0; i<
·¹™iÚ
->
Å¬ts
; i++)

566 
·¹™iÚ
->
bÜd”CouÁ
[
i
] = 0;

567 
ii
=0; ii<
Âodes
; ii++){

568 
·¹™iÚNumb”
 = 
·¹™iÚ
->
·¹
[
ii
];

569 if(
·¹™iÚ
->
bÜd”
[
ii
] != 0){

570 
bÜd”šdex
 = 
·¹™iÚ
->
bÜd”CouÁ
[
·¹™iÚNumb”
];

571 
·¹™iÚ
->
bÜd”Nodes
[
·¹™iÚNumb”
][
bÜd”šdex
] = 
ii
;

572 
·¹™iÚ
->
bÜd”CouÁ
[
·¹™iÚNumb”
]++;

575 
·¹™iÚ
->
nodeCouÁ
[
·¹™iÚNumb”
]++;

578 
i
=0; i<
·¹™iÚ
->
Å¬ts
; i++){

579 
·¹™iÚNumb”
 = 
i
;

580 
·¹™iÚ
->
nodeCouÁ
[
·¹™iÚNumb”
] +ğ·¹™iÚ->
bÜd”CouÁ
[partitionNumber];

583 
	`´štf
("Partition Counts:\n");

584 
i
=0; i<
·¹™iÚ
->
Å¬ts
; i++){

585 
	`´štf
("TÙ®‚odes: %d BÜd”‚odes: %d Edges: %d\n", 
·¹™iÚ
->
nodeCouÁ
[
i
],…¬t™iÚ->
bÜd”CouÁ
[i],…¬t™iÚ->
edgeCouÁ
[i]);

587 
	`´štf
("Eedgcut: %u\n", 
·¹™iÚ
->
edgecut
);

588 
	`´štf
("\n");

590 
	}
}

593 
	gG¿ph
::
	$š™From
(
G¿ph
 &
äom
) {

595 
Âodes
 = 
äom
.nnodes;

596 
Ãdges
 = 
äom
.nedges;

598 
·¹™iÚ
.
·¹
 = (*)
	`m®loc
(()*(
äom
.
Âodes
));

599 
·¹™iÚ
.
Å¬ts
 = 2;

601 
·¹™iÚ
.
bÜd”
 = (*)
	`m®loc
(()*
Âodes
);

602 
·¹™iÚ
.
bÜd”CouÁ
 = (*)
	`m®loc
(()* (·¹™iÚ.
Å¬ts
) );

603 
·¹™iÚ
.
bÜd”Nodes
 = (**)
	`m®loc
((*)* (·¹™iÚ.
Å¬ts
) );

604 
·¹™iÚ
.
nodeCouÁ
 = (*)
	`m®loc
(()* (·¹™iÚ.
Å¬ts
) );

605 
·¹™iÚ
.
edgeCouÁ
 = (*)
	`m®loc
(()* (·¹™iÚ.
Å¬ts
) );

606 
i
=0; i<
·¹™iÚ
.
Å¬ts
; i++)

607 
·¹™iÚ
.
bÜd”Nodes
[
i
] = (*)
	`m®loc
(()*
Âodes
/2);

611 
	}
}

613 
	gG¿ph
::
	$®locOnHo¡
() {

614 
edges¤cd¡
 = (*)
	`m®loc
((
Ãdges
) * ());

615 
edges¤cwt
 = (
fÜu
 *)
	`m®loc
((
Ãdges
) * (foru));

616 
noutgošg
 = (*)
	`ÿÎoc
(
Âodes
, ());

617 
p¤c
 = (*)
	`ÿÎoc
((
Âodes
+1), ());

618 
p¤c
[
Âodes
] = 
Ãdges
;

619 
¤c¤c
 = (*)
	`m®loc
((
Ãdges
+1) * ());

621 
maxOutDeg»e
 = (*)
	`m®loc
(());

622 *
maxOutDeg»e
 = 0;

624 
memÜy
 = 
AÎoÿ‹dOnHo¡
;

626 
	}
}

627 
	gG¿ph
::
	$®locOnDeviû
() {

628 ià(
	`cudaM®loc
((**)&
edges¤cd¡
, (
Ãdges
è* ()è!ğ
cudaSucûss
)

629 
	`CudaTe¡
("allocatingƒdgessrcdst failed");

630 ià(
	`cudaM®loc
((**)&
edges¤cwt
, (
Ãdge¤esid’t
è* (
fÜu
)è!ğ
cudaSucûss
)

631 
	`CudaTe¡
("allocatingƒdgessrcwt failed");

632 ià(
	`cudaM®loc
((**)&
noutgošg
, 
Âode¤esid’t
 * ()è!ğ
cudaSucûss
)

633 
	`CudaTe¡
("allocating‚outgoing failed");

634 ià(
	`cudaM®loc
((**)&
¤c¤c
, (
Ãdge¤esid’t
è* ()è!ğ
cudaSucûss
)

635 
	`CudaTe¡
("allocating srcsrc failed");

639 
	}
}

640 
	gG¿ph
::
	$d—ÎocOnHo¡
() {

641 
	`ä“
(
noutgošg
);

642 
	`ä“
(
¤c¤c
);

643 
	`ä“
(
edges¤cd¡
);

644 
	`ä“
(
edges¤cwt
);

645 
	`ä“
(
p¤c
);

646 
	`ä“
(
maxOutDeg»e
);

648 
	}
}

649 
	gG¿ph
::
	$d—ÎocOnDeviû
() {

650 
	`cudaF»e
(
noutgošg
);

651 
	`cudaF»e
(
¤c¤c
);

652 
	`cudaF»e
(
edges¤cd¡
);

653 
	`cudaF»e
(
edges¤cwt
);

655 
	`cudaF»e
(
maxOutDeg»e
);

657 
	}
}

658 
	gG¿ph
::
	$d—Îoc
() {

659 
memÜy
) {

660 
AÎoÿ‹dOnHo¡
:

661 
	`´štf
("dealloc on host.\n");

662 
	`d—ÎocOnHo¡
();

664 
AÎoÿ‹dOnDeviû
:

665 
	`´štf
("dealloc on device.\n");

666 
	`d—ÎocOnDeviû
();

670 
	}
}

671 
	gG¿ph
::
	$d—Îoc_·¹
() {

672 
	`ä“
(
·¹™iÚ
.
bÜd”
);

673 
	`ä“
(
·¹™iÚ
.
bÜd”CouÁ
);

674 
	`ä“
(
·¹™iÚ
.
nodeCouÁ
);

675 
	`ä“
(
·¹™iÚ
.
edgeCouÁ
);

676 
i
=0; i<
·¹™iÚ
.
Å¬ts
; i++){

677 
	`ä“
(
·¹™iÚ
.
bÜd”Nodes
[
i
]);

681 
	`ä“
(
·¹™iÚ
.
bÜd”Nodes
);

682 
·¹™iÚIndex
=0 ;…¬t™iÚIndex < 
·¹™iÚ
.
Å¬ts
 ;…artitionIndex++){

683 
	`ä“
(
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edge¤c
);

684 
	`ä“
(
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edged¡
);

685 
	`ä“
(
deviûP¬t™iÚ
[
·¹™iÚIndex
].
nodedi¡
);

686 
	`ä“
(
deviûP¬t™iÚ
[
·¹™iÚIndex
].
nodesigma
);

687 
	`ä“
(
deviûP¬t™iÚ
[
·¹™iÚIndex
].
noded–
);

689 
	`ä“
(
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edgesigma
);

690 
	`ä“
(
deviûP¬t™iÚ
[
·¹™iÚIndex
].
edgewt
);

691 
	`ä“
(
deviûP¬t™iÚ
[
·¹™iÚIndex
].
noutgošg
);

692 
	`ä“
(
deviûP¬t™iÚ
[
·¹™iÚIndex
].
p¤c
);

696 
	`ä“
(
deviûP¬t™iÚ
);

697 
	`ä“
(
·¹™iÚ
.
·¹
);

698 
	}
}

700 
	gG¿ph
::
	$G¿ph
(
³rcg¿ph
 ) {

701 
	`š™
(
³rcg¿ph
);

702 
	}
}

703 
	gG¿ph
::~
	$G¿ph
() {

705 
	`d—Îoc_·¹
();

707 
	}
}

709 
	gG¿ph
::
	$´og»ssPršt
(
maxii
, 
ii
) {

710 cÚ¡ 
n¡•s
 = 5;

711 
š—ch¡•
 = (
maxii
 / 
n¡•s
);

714  ià(
ii
 % 
š—ch¡•
 == 0) {

715 
	`´štf
("\t%3d%%\r", 
ii
*100/
maxii
 + 1);

716 
	`fæush
(
¡dout
);

718 
	}
}

719 
	gG¿ph
::
	$»adFromEdges
(
fe
[]) {

720 
¡d
::
if¡»am
 
cfe
;

721 
cfe
.
	`İ’
(
fe
);

722 
¡d
::
¡ršg
 
¡r
;

725 
¡r_‹mp
[30];

726 
ba£
,
pšs
;

727 
	`g‘lše
(
cfe
, 
¡r
);

728 
	`ssÿnf
(
¡r
.
	`c_¡r
(), "%d %u %u %u", &
ba£
,&
Âodes
,&
Ãdges
,&
pšs
);

729 
	`´štf
("\nNum oànode %u\n",
Âodes
);

732 
	`´štf
("Num oàedge %u\n",
Ãdges
);

734 
	`®locOnHo¡
();

735 
ii
 = 0; i˜< 
Âodes
; ++ii) {

736 
¤c¤c
[
ii
] = ii;

738 
´evnode
 = 0;

739 
‹mp¤úode
;

740 
ncu¼outgošg
 = 0;

741 
maxdeg»e
 = 0;

742 
ii
 = 0; i˜< 
Ãdges
; ++ii) {

743 
	`g‘lše
(
cfe
, 
¡r
);

744 
	`ssÿnf
(
¡r
.
	`c_¡r
(), "%d %d %d", &
¤c¤c
[
ii
], &
edges¤cd¡
[ii], &
edges¤cwt
[ii]);

749 
‹mp¤úode
 = 
¤c¤c
[
ii
];

750 ià(
´evnode
 =ğ
‹mp¤úode
) {

751 ià(
ii
 == 0) {

752 
p¤c
[
‹mp¤úode
] = 
ii
 + 1;

754 ++
ncu¼outgošg
;

756 
p¤c
[
‹mp¤úode
] = 
ii
 + 1;

757 ià(
ncu¼outgošg
) {

758 
noutgošg
[
´evnode
] = 
ncu¼outgošg
;

759 
maxdeg»e
 = (
noutgošg
[
´evnode
] > maxdegree ?‚outgoing[prevnode] : maxdegree);

761 
´evnode
 = 
‹mp¤úode
;

762 
ncu¼outgošg
 = 1;

765 
	`´og»ssPršt
(
Ãdges
, 
ii
);

767 
noutgošg
[
´evnode
] = 
ncu¼outgošg
;

768 
maxdeg»e
 = (
noutgošg
[
´evnode
] > maxdegree ?‚outgoing[prevnode] : maxdegree);

769 *
maxOutDeg»e
 = 
maxdeg»e
;

770 
cout
<<"Max Deg»i "<<
maxdeg»e
<<
’dl
;

771 
cfe
.
	`şo£
();

772  
maxdeg»e
;

773 
	}
}

776 
	gG¿ph
::
	$»adFromGR
(
fe
[], 
boŞ
 
weigh‹d
) {

777 
¡d
::
if¡»am
 
cfe
;

778 
cfe
.
	`İ’
(
fe
);

781 
ma¡”FD
 = 
	`İ’
(
fe
, 
O_RDONLY
);

782 ià(
ma¡”FD
 == -1) {

783 
	`´štf
("FeG¿ph::¡ruùu»FromFe: uÇbËØİ’ %s.\n", 
fe
);

787 
¡©
 
buf
;

788 
f
 = 
	`f¡©
(
ma¡”FD
, &
buf
);

789 ià(
f
 == -1) {

790 
	`´štf
("FeG¿ph::¡ruùu»FromFe: uÇbËØ¡© %s.\n", 
fe
);

791 
	`abÜt
();

793 
size_t
 
ma¡”L’gth
 = 
buf
.
¡_size
;

795 
_MAP_BASE
 = 
MAP_PRIVATE
;

800 * 
m
 = 
	`mm­
(0, 
ma¡”L’gth
, 
PROT_READ
, 
_MAP_BASE
, 
ma¡”FD
, 0);

801 ià(
m
 =ğ
MAP_FAILED
) {

802 
m
 = 0;

803 
	`´štf
("FileGraph::structureFromFile: mmap failed.\n");

804 
	`abÜt
();

808 
ušt64_t
* 
åŒ
 = (ušt64_t*)
m
;

809 
	`__©Œibu‹__
((
unu£d
)è
ušt64_t
 
v”siÚ
 = 
	`Ë64toh
(*
åŒ
++);

810 
	`as£¹
(
v”siÚ
 == 1);

811 
ušt64_t
 
sizeEdgeTy
 = 
	`Ë64toh
(*
åŒ
++);

812 
ušt64_t
 
numNodes
 = 
	`Ë64toh
(*
åŒ
++);

813 
ušt64_t
 
numEdges
 = 
	`Ë64toh
(*
åŒ
++);

814 
ušt64_t
 *
outIdx
 = 
åŒ
;

815 
åŒ
 +ğ
numNodes
;

816 
ušt32_t
 *
åŒ32
 = (ušt32_t*)
åŒ
;

817 
ušt32_t
 *
outs
 = 
åŒ32
;

818 
åŒ32
 +ğ
numEdges
;

819 ià(
numEdges
 % 2è
åŒ32
 += 1;

820 *
edgeD©a
 = (*)
åŒ32
;

823 
Âodes
 = 
numNodes
;

824 
Ãdges
 = 
numEdges
;

826 
	`´štf
("Âodes=%d,‚edges=%d.\n", 
Âodes
, 
Ãdges
);

827 
	`®locOnHo¡
();

829 
maxdeg»e
 = 0, 
maxdeg»’ode
 = 0;

830 
¤c
, 
d¡
;

831 
ii
 = 0, 
edgešdex
 = 0; i˜< 
Âodes
; ++ii) {

832 
¤c
 = 
ii
;

834 ià(
ii
 > 0) {

835 
p¤c
[
ii
] = 
	`Ë64toh
(
outIdx
[ii - 1])+ 1;

836 
noutgošg
[
ii
] = 
	`Ë64toh
(
outIdx
[ii]) -†e64toh(outIdx[ii - 1]);

837 ià(
noutgošg
[
ii
] > 
maxdeg»e
) {

838 
maxdeg»e
 = 
noutgošg
[
ii
];

839 
maxdeg»’ode
 = 
ii
;

842 
p¤c
[0] = 1;

843 
noutgošg
[0] = 
	`Ë64toh
(
outIdx
[0]);

844 
maxdeg»e
 = (
noutgošg
[
ii
] > maxdegree ?‚outgoing[ii] : maxdegree);

847 
jj
 = 0; jj < 
noutgošg
[
ii
]; ++jj, ++
edgešdex
) {

848 
d¡
 = 
	`Ë32toh
(
outs
[
edgešdex
]);

850 ià(
d¡
 >ğ
Âodes
è
	`´štf
("\tšv®idƒdgäom %dØ%d‡ˆšdex %d(%d).\n", 
ii
, d¡, 
jj
, 
edgešdex
);

851 
¤c¤c
[
edgešdex
] = 
¤c
;

852 
edges¤cd¡
[
edgešdex
] = 
d¡
;

853 
edges¤cwt
[
edgešdex
] = (
weigh‹d
 ? 
edgeD©a
[edgeindex] : 1);

856 
	`´og»ssPršt
(
Ãdges
, 
edgešdex
);

858 
	`´štf
("\n");

859 *
maxOutDeg»e
 = 
maxdeg»e
;

860 
	`´štf
("%s(%d): maxdeg»e(%dè% THRESHOLDDEGREE(%d), maxdeg»’odğ%d.\n", 
__FILE__
, 
__LINE__
, 
maxdeg»e
, (maxdeg»> 
THRESHOLDDEGREE
 ? ">" : "<="), THRESHOLDDEGREE, 
maxdeg»’ode
);

861 
cfe
.
	`şo£
();

868 
	}
}

869 
	gG¿ph
::
	$»ad
(
fe
[], 
boŞ
 
weigh‹d
 ) {

870 ià(
	`¡r¡r
(
fe
, ".edges")) {

871  
	`»adFromEdges
(
fe
);

872 } ià(
	`¡r¡r
(
fe
, ".gr")) {

873  
	`»adFromGR
(
fe
, 
weigh‹d
);

876 
	}
}

877 
	gG¿ph
::
	$´štOÃEdge
(
“
) {

878 
	`´štf
("%d: %d -> %d\twt=%d.\n", 
“
, 
¤c¤c
[“], 
edges¤cd¡
[“], 
edges¤cwt
[ee]);

879 
	}
}

880 
	gG¿ph
::
	$´štEdges
(
¡¬‹e
, 
Ãe
) {

881 
“
 = 0;ƒ< 
Ãe
; ++ee) {

882 
	`´štOÃEdge
(
¡¬‹e
 + 
“
);

884 
	}
}

885 
	gG¿ph
::
	$´štEdgesOf
(
Â
) {

886 
¡¬‹dge
 = 
	`g‘Fœ¡EdgeBS—rch
(
Â
);

887 
	`´štf
("Edge oà%d = %d.\n", 
Â
, 
noutgošg
[nn]);

888 
	`´štEdges
(
¡¬‹dge
, 
noutgošg
[
Â
]);

889 
	}
}

890 
	gG¿ph
::
	$´štDeg»es
(
¡¬Šn
, 
Ân
) {

891 
node
 = 0;‚od< 
Ân
; ++node) {

892 
	`´štf
("noutgošg[%d] = %d.\n", 
¡¬Šn
 + 
node
, 
noutgošg
[startnn +‚ode]);

894 
	}
}

896 
__deviû__
 
	gG¿ph
::
	$compu‹Sts
() {

897 
	`compu‹InOut
();

898 
	`compu‹DŸm‘”
();

899 
	}
}

900 
__deviû__
 
boŞ
 
	gG¿ph
::
	$compu‹Lev–s
() {

901 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

902 
boŞ
 
chªged
 = 
çl£
;

904 ià(
id
 < 
Âodes
) {

920  
chªged
;

921 
	}
}

923 
	#MAX
(
a
, 
b
è× < 
Âodes
 &&‡ > b ?‡ : b)

	)

925 
__deviû__
 
	gG¿ph
::
	$fšdMaxLev–
() {

926 
maxËv–
 = 0;

930  
maxËv–
;

931 
	}
}

932 
__deviû__
 
	gG¿ph
::
	$compu‹DŸm‘”
() {

933 
dŸm‘”
 = 
	`fšdMaxLev–
();

934 
	}
}

935 
__deviû__
 
	gG¿ph
::
	$compu‹InOut
() {

936 
ii
 = 0; i˜< 
Âodes
; ++ii) {

938 
noutii
 = 
	`g‘OutDeg»e
(
ii
);

939 ià(
noutii
 > *
maxOutDeg»e
) {

940 *
maxOutDeg»e
 = 
noutii
;

943 
	}
}

945 
__deviû__
 
	gG¿ph
::
	$´štSts1x1
() {

946 
´efix
[] = "\t";

948 
	`compu‹Sts
();

950 
	`´štf
("%¢node  = %d.\n", 
´efix
, 
Âodes
);

951 
	`´štf
("%¢edge  = %d.\n", 
´efix
, 
Ãdges
);

952 
	`´štf
("%§vg, max outdeg»ğ%.2f, %d.\n", 
´efix
, 
Ãdges
*1.0 / 
Âodes
, *
maxOutDeg»e
);

953 
	`´štf
("%sdŸm‘” = %d.\n", 
´efix
, 
dŸm‘”
);

955 
	}
}

956 
	gG¿ph
::
	$®locLev–s
() {

958 
	}
}

959 
G¿ph
::
	$ä“Lev–s
() {

962 
	}
}

963 
__deviû__
 
G¿ph
::
	$š™Lev–s
() {

966 
	}
}

970 
__glob®__
 
	$d´št¡©s
(
G¿ph
 
g¿ph
) {

971 
g¿ph
.
	`´štSts1x1
();

972 
	}
}

973 
__glob®__
 
	$dcompu‹Ëv–s
(
G¿ph
 
g¿ph
, 
boŞ
 *
chªged
) {

974 ià(
g¿ph
.
	`compu‹Lev–s
()) {

975 *
chªged
 = 
Œue
;

977 
	}
}

978 
__glob®__
 
	$dš™Ëv–s
(
G¿ph
 
g¿ph
) {

979 
g¿ph
.
	`š™Lev–s
();

980 
	}
}

981 
__glob®__
 
	$d´št1x1
(
G¿ph
 
g¿ph
) {

982 
g¿ph
.
	`´št1x1
();

983 
	}
}

984 
__glob®__
 
	$d´štResid’t
(
G¿ph
 
g¿ph
, 
™
, 
ÅršŠodes
) {

985 
g¿ph
.
	`´štResid’t
(
™
, 
ÅršŠodes
);

986 
	}
}

987 
	gG¿ph
::
	$´štResid’tDeviû
(
™
, 
ÅršŠodes
 ) {

988 
d´štResid’t
<<<1,1>>>(*
this
, 
™
, 
ÅršŠodes
);

989 
	`CudaTe¡
("dprintResident failed");

990 
	}
}

991 
	gG¿ph
::
	$´št
() {

992 ià(
memÜy
 =ğ
AÎoÿ‹dOnDeviû
) {

993 
d´št1x1
<<<1,1>>>(*
this
);

994 
	`CudaTe¡
("print1x1 failed");

995 } ià(
memÜy
 =ğ
AÎoÿ‹dOnHo¡
) {

996 
	`´štf
("memory‡llocated on host. hgraph.print‚ot implemented.\n");

998 
	`´štf
("\t%s(%d): g¿ph‚Ù y‘‡Îoÿ‹d.\n", 
__FILE__
, 
__LINE__
);

1000 
	}
}

1001 
	gG¿ph
::
	$´štSts
() {

1002 
	`®locLev–s
();

1003 
dš™Ëv–s
<<<(
Âodes
+
MAXBLOCKSIZE
-1)/MAXBLOCKSIZE, MAXBLOCKSIZE>>>(*
this
);

1004 
	`CudaTe¡
("dinitlevels failed");

1008 
boŞ
 *
chªged
;

1009 ià(
	`cudaM®loc
((**)&
chªged
, (
boŞ
)è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating changed failed");

1011 
	`´štf
("\tnot computing†evels, diameter will be zero.\n");

1025 
	`cudaF»e
(
chªged
);

1027 
d´št¡©s
<<<1, 1>>>(*
this
);

1028 
	`CudaTe¡
("dprintstats failed");

1030 
	`ä“Lev–s
();

1032 
	}
}

1179 
	gG¿ph
::
	$fšdS”ŸlBFS
(
¤c
) {

1180 
fÜu
 
max_bfs
;

1181 
fÜu
 *
loÿldi¡
 = (fÜu *è
	`ÿÎoc
(
Âodes
, (foru));

1182 
i
 = 0; i < 
Âodes
; i++)

1183 
loÿldi¡
[
i
] = 
MYINFINITY
;

1185 
loÿldi¡
[
¤c
] = 0;

1186 
i
 = 0; i < 
Âodes
; i++) {

1187 
æag
 = 1;

1188 
v”
 = 0; v” < 
Âodes
; ver++) {

1189 
fÜu
 
tdi¡
 = 
loÿldi¡
[
v”
];

1190 
ed
 = 
p¤c
[
v”
];ƒd < (p¤c[v”] + 
noutgošg
[ver]);ƒd++) {

1191 
	`´štf
("\Å¤øv®u%u\n",
p¤c
[
v”
]);

1192 
fÜu
 
wt
 = 1;

1193 ià(
tdi¡
 + 
wt
 < 
loÿldi¡
[
¤c¤c
[
ed
]]) {

1194 
æag
 = 0;

1195 
loÿldi¡
[
¤c¤c
[
ed
]] = 
tdi¡
 + 
wt
;

1199 ià(
æag
)

1202 
	`´štf
("\nCODE REACHING HERE\n");

1204 
max_bfs
 = 0;

1205 
v”
 = 0; v” < 
Âodes
; ver++) {

1206 ià(
loÿldi¡
[
v”
] < 
MYINFINITY
) {

1207 ià(
loÿldi¡
[
v”
] > 
max_bfs
) {

1208 
max_bfs
 = 
loÿldi¡
[
v”
];

1212 
of¡»am
 
İ
;

1213 
İ
.
	`İ’
("EdgeOP.txt");

1214 
İ
.
	`´ecisiÚ
(0);

1215 
i
 = 0; i < 
Âodes
; i++)

1216 
İ
 << 
loÿldi¡
[
i
] << 
’dl
;

1217 
İ
.
	`şo£
();

1218 
	`ä“
(
loÿldi¡
);

1219 
	}
}

1222 
__deviû__
 
__ho¡__


1223 
	gG¿ph
::
	$g‘S¹NodeFromNode
(
Â
) {

1224  
	`g‘S¹Node
(
™
);

1225 
	}
}

1226 
__deviû__
 
__ho¡__


1227 
	gG¿ph
::
	$g‘S¹Node
(
™
) {

1228 
“
 = 
	`g‘S¹Edge
(
™
);

1229  
¤c¤c
[
“
 % 
Ãdge¤esid’t
];

1230 
	}
}

1231 
__deviû__
 
__ho¡__


1232 
	gG¿ph
::
	$g‘EndNode
(
™
) {

1233 
“
 = 
	`g‘EndEdge
(
™
);

1234  
¤c¤c
[(
“
 - 1è% 
Ãdge¤esid’t
] + 1;

1235 
	}
}

1236 
	gG¿ph
::
	$g‘I‹¿tiÚFromNode
(
Â
) {

1237  
Â
 / 
Ãdges¦idšg
;

1238 
	}
}

1239 
__ho¡__
 
__deviû__
 
	gG¿ph
::
	$g‘I‹¿tiÚFromEdge
(
“
) {

1240  
“
 / 
Ãdges¦idšg
;

1241 
	}
}

1242 
__ho¡__
 
__deviû__


1243 
	gG¿ph
::
	$g‘S¹Edge
(
™
) {

1244  
™
 * 
Ãdges¦idšg
;

1245 
	}
}

1246 
__ho¡__
 
__deviû__


1247 
	gG¿ph
::
	$g‘EndEdge
(
™
) {

1248 
“
 = 
	`g‘S¹Edge
(
™
 + 1);

1249  (
“
 < 
Ãdges
 ?ƒe :‚edges);

1250 
	}
}

	@kernelconfig.h

1 #iâdeà
LSG_KERNELCONFIG


2 
	#LSG_KERNELCONFIG


	)

4 
	~"SŒuùs.h
"

6 
	gK”ÃlCÚfig
::
	$K”ÃlCÚfig
(
ldeviû
 ) {

7 
deviû
 = 
ldeviû
;

8 
	`š™
();

9 
	}
}

10 
	gK”ÃlCÚfig
::
	$š™
() {

11 
deviûCouÁ
 = 0;

12 ià(
cudaSucûss
 !ğ
	`cudaG‘DeviûCouÁ
(&
deviûCouÁ
)) {

13 
	`CudaTe¡
("cudaGetDeviceCount failed");

15 ià(
deviûCouÁ
 == 0) {

16 
	`årštf
(
¡d”r
, "No CUDA capable devices found.");

20 
	`cudaG‘DeviûPrİ”t›s
(&
dp
, 
deviû
);

21 
	`årštf
(
¡dout
, "Found %d deviûs, usšg deviû %d (%s), compu‹ c­ab™y %d.%d, cÜe %d*%d.\n", 
deviûCouÁ
, 
deviû
, 
dp
.
Çme
, dp.
majÜ
, dp.
mšÜ
, 
	`g‘Numb”OfSMs
(), 
	`CÚv”tSMV”2CÜes
(dp.major, dp.minor));

22 
´obËmsize
 = 0;

23 
nblocks
 = 0;

24 
	`£tMaxTh»adsP”Block
();

25 
	}
}

26 
	gK”ÃlCÚfig
::
	$g‘MaxTh»adsP”Block
() {

27  
dp
.
maxTh»adsDim
[0];

28 
	}
}

29 
	gK”ÃlCÚfig
::
	$g‘MaxBlocks
() {

30  
dp
.
maxGridSize
[0];

31 
	}
}

32 
	gK”ÃlCÚfig
::
	$g‘MaxSh¬edMemÜyP”Block
() {

33  
dp
.
sh¬edMemP”Block
;

34 
	}
}

35 
	gK”ÃlCÚfig
::
	$g‘Numb”OfSMs
() {

36  
dp
.
muÉiProûssÜCouÁ
;

37 
	}
}

39 
	gK”ÃlCÚfig
::
	$£tProbËmSize
(
size
) {

40 
´obËmsize
 = 
size
;

41  
	`ÿlcuÏ‹
();

42 
	}
}

43 
	gK”ÃlCÚfig
::
	$g‘ProbËmSize
() {

44  
´obËmsize
;

45 
	}
}

46 
	gK”ÃlCÚfig
::
	$g‘Numb”OfBlocks
() {

47  
nblocks
;

48 
	}
}

49 
	gK”ÃlCÚfig
::
	$g‘Numb”OfBlockTh»ads
() {

50  
blocksize
;

51 
	}
}

52 
	gK”ÃlCÚfig
::
	$g‘Numb”OfTÙ®Th»ads
() {

53  
nblocks
 * 
blocksize
;

54 
	}
}

55 
	gK”ÃlCÚfig
::
	$ÿlcuÏ‹
() {

56 ià(
blocksize
 == 0) {

57 
	`årštf
(
¡d”r
, "blocksize = 0.\n");

60 
nblocks
 = (
´obËmsize
 + 
blocksize
 - 1) / blocksize;

62 
	}
}

63 
	gK”ÃlCÚfig
::
	$£tNumb”OfBlocks
(
Êblocks
) {

64  (
nblocks
 = 
Êblocks
);

65 
	}
}

66 
	gK”ÃlCÚfig
::
	$£tNumb”OfBlocksP”SM
(
Êblocks
) {

67  (
nblocks
 = 
Êblocks
 * 
	`g‘Numb”OfSMs
());

68 
	}
}

69 
	gK”ÃlCÚfig
::
	$£tNumb”OfBlockTh»ads
(
lblocksize
) {

70  (
blocksize
 = 
lblocksize
);

71 
	}
}

72 
	gK”ÃlCÚfig
::
	$£tMaxTh»adsP”Block
() {

73  
	`£tNumb”OfBlockTh»ads
(
	`g‘MaxTh»adsP”Block
());

74 
	}
}

75 
boŞ
 
	gK”ÃlCÚfig
::
	$cov”sProbËm
(
size
 ) {

76 ià(
size
 == 0) {

77 
size
 = 
´obËmsize
;

79  (
size
 <ğ
nblocks
 * 
blocksize
);

80 
	}
}

	@list.h

1 #iâdeà
LSG_LIST


2 
	#LSG_LIST


	)

4 
	sLi¡
 {

5 
__deviû__
 
Li¡
(
size
);

6 
__deviû__
 
š™
(*
mem
, 
size
, 
ÿp
);

7 
__deviû__
 
push
(
™em
);

8 
__deviû__
 *
toA¼ay
();

9 
__deviû__
 
ş—r
();

10 
__deviû__
 
size
();

11 
__deviû__
 
uniq
(*
m¬k
, 
max–em’t
);

13 *
	m¬¿y
;

14 
	mn™ems
;

15 
	mÿ·c™y
;

16 } 
	tLi¡
;

18 
__deviû__
 
	gLi¡
::
	$Li¡
(
size
) {

19 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

20 
ÿ·c™y
 = 0;

21 
¬¿y
 = 
NULL
;

22 
n™ems
 = 0;

24 ià(
size
) {

25 
¬¿y
 = (*)
	`m®loc
(
size
 * ());

26 ià(
¬¿y
 =ğ
NULL
) {

27 
	`´štf
("%s(%d):h»ad %d: E¼Ü: m®loøoà%d unsigÃd„‘uºed‚ØmemÜy.\n", 
__FILE__
, 
__LINE__
, 
id
, 
size
);

29 
ÿ·c™y
 = 
size
;

32 
	}
}

33 
__deviû__
 
	gLi¡
::
	$š™
(*
mem
, 
size
, 
ÿp
) {

34 
¬¿y
 = 
mem
;

35 
n™ems
 = 
size
;

36 
ÿ·c™y
 = 
ÿp
;

37 
	}
}

38 
__deviû__
 
	gLi¡
::
	$push
(
™em
) {

39 ià(
¬¿y
 && 
n™ems
 < 
ÿ·c™y
) {

40 
¬¿y
[
n™ems
++] = 
™em
;

42 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

43 
	`´štf
("%s(%d):h»ad %d: E¼Ü: bufã¸ov”æow, c­ac™y=%d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
ÿ·c™y
);

45 
	}
}

46 
__deviû__
 *
	gLi¡
::
	$toA¼ay
() {

47  
¬¿y
;

48 
	}
}

49 
__deviû__
 
	gLi¡
::
	$ş—r
() {

50 ià(
¬¿y
è
	`ä“
(array);

51 
n™ems
 = 0;

52 
ÿ·c™y
 = 0;

53 
	}
}

54 
__deviû__
 
	gLi¡
::
	$size
() {

55  
n™ems
;

56 
	}
}

57 
__deviû__
 
	gLi¡
::
	$uniq
(*
m¬k
, 
max–em’t
) {

58 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

59 
mysize
 = 
	`size
();

60 ià(
mysize
 == 0) ;

62 *
Ãw¬¿y
 = (*)
	`m®loc
(
mysize
 * ());

63 ià(
Ãw¬¿y
 =ğ
NULL
) {

64 
	`´štf
("%s(%d):h»ad %d: E¼Ü: m®loøoà%d unsigÃd„‘uºed‚ØmemÜy.\n", 
__FILE__
, 
__LINE__
, 
id
, 
mysize
);

67 *
š£¹±r
 = 
Ãw¬¿y
;

69 
ii
 = 0; i˜< 
mysize
; ++ii) {

70 
–em’t
 = 
¬¿y
[
ii
];

71 ià(
–em’t
 < 
max–em’t
 && 
m¬k
[–em’t] =ğ
id
) {

72 *
š£¹±r
++ = 
–em’t
;

75 
	`ş—r
();

76 
	`š™
(
Ãw¬¿y
, 
š£¹±r
 -‚ew¬¿y, 
mysize
);

77 
	}
}

	@myutils.h

1 #iâdeà
_MYUTILS_H


2 
	#_MYUTILS_H


	)

3 #´agm¨
Úû


90 "C" 
lÚe¡¬_gpu
(*,*,*,*,*
edges¤c
,*
edgesd¡
,
hnodes
,
hedges
,*
hdi¡
,*
nodesigma
,*
edgesigma
,
couÁ
,*
sourûs
,
cudaDeviûPrİ
 *,
boŞ
 
BM_COMP
,*
Ã¼
);

91 "C" 
ªªya_code_func
(*,*,*,*,*
edges¤c
,*
edgesd¡
,
hnodes
,
hedges
,*
hdi¡
,*
nodesigma
,*
edgesigma
,
couÁ
,*
sourûs
,
cudaDeviûPrİ
 *,
boŞ
 
BM_COMP
,*
Ã¼
);

92 
b‘w“Âess_ûÁ¿l™y_·¿Î–
(
hnodes
,
hedges
,*
row±rs
,*
cŞumnšdexes
, *
edges¤c
,*
noutgošg
,*
sourûs
,
sourû_couÁ
,*
nodedi¡
, *
nodesigma
, *
edgesigma
,
omp_lock_t
 *,
num_th»ads
);

93 "C" 
wÜkli¡_ıu
(*
p¤c
,*
noutgošg
,*
edges¤c
,*
edgesd¡
,
hnodes
,
hedges
,*
hdi¡
,*
nodesigma
,*
edgesigma
,
sourû_couÁ
,*
sourûs
,
omp_lock_t
 *,
boŞ
,);

	@myutils2.h

1 "C" 
ıu_backw¬d
(
v¬to_ıu_·¹
 *
v¬
);

2 "C" *
gpu_backw¬d
(*
v¬
);

	@partition_metis.cu

1 
	~"commÚ.h
"

2 
	~"SŒuùs.h
"

3 
	~"scheduËr19.h
"

4 
	~"g¿ph28.h
"

5 
	~"k”ÃlcÚfig.h
"

6 
	~"li¡.h
"

7 
	~<cub/cub.cuh
>

8 
	~"myuts.h
"

9 
	~"myuts2.h
"

10 
	gıu_¿tiÙime
,
	ggpu_¿tiÙime
;

11 
	$š™nodesigmadi¡
(
sourû
, 
nodes
, * 
nodesigma
, * 
nodedi¡
){

12 
ii
;

13 
ii
 = 0; i˜< 
nodes
; ii++) {

14 
nodesigma
[
ii
] = 0;

15 
nodedi¡
[
ii
] = 
MYINFINITY
;

17 
nodesigma
[
sourû
] = 1;

18 
nodedi¡
[
sourû
] = 0;

19 
	}
}

20 
	$š™nodesigmadi¡_muÉisourû
(
G¿ph
 *
g¿ph
,*
v®ues
, *
sigma_v®ues
,
nodes
, * 
nodesigma
, * 
nodedi¡
,*
sourûs
,
sourû_couÁ
,*
p¤c
,*
noutgošg
,*
edged¡
,*
bÜd”
){

21 
ii
,
j
;

30  
ii
 = 0; i˜< 
sourû_couÁ
; ii++) {

31 
v
 = 
sourûs
[
ii
],
w
;

32 
num_edges_v
 = 
p¤c
[
v
];

33 
j
 = 
num_edges_v
; j < (num_edges_v + 
noutgošg
[
v
]) ; j++) {

34 
w
 = 
edged¡
[
j
];

35 if(
bÜd”
[
w
]==0);

36 
nodedi¡
[
w
]=
MYINFINITY
;

37 
nodesigma
[
w
]=0;

40 
ii
=0 ; i˜< 
sourû_couÁ
 ; ii++)

42 
nodedi¡
[
sourûs
[
ii
]] = 
v®ues
[ii];

43 
nodesigma
[
sourûs
[
ii
]] = 
sigma_v®ues
[ii];

46 
	}
}

47 
	$š™nodesigmadi¡_muÉisourû_omp
(
G¿ph
 *
g¿ph
,*
v®ues
,*
sigma_v®ues
,
nodes
, * 
nodesigma
, * 
nodedi¡
,*
sourûs
,
sourû_couÁ
,
num_th»ads
,*
p¤c
,*
noutgošg
,*
edged¡
,*
bÜd”
){

48 
ii
,
j
;

58 #´agm¨
omp
 
·¿Î–
 
	`scheduË
(è
	`´iv©e
(
ii
,
j
è
	`num_th»ads
(
num_th»ads
)

59  
ii
 = 0; i˜< 
sourû_couÁ
; ii++) {

60 
v
 = 
sourûs
[
ii
],
w
;

61 
num_edges_v
 = 
p¤c
[
v
];

62 
j
 = 
num_edges_v
; j < (num_edges_v + 
noutgošg
[
v
]) ; j++) {

63 
w
 = 
edged¡
[
j
];

64 if(
bÜd”
[
w
]==0);

65 
nodedi¡
[
w
]=
MYINFINITY
;

66 
nodesigma
[
w
]=0;

70 
ii
=0 ; i˜< 
sourû_couÁ
 ; ii++)

72 
nodedi¡
[
sourûs
[
ii
]] = 
v®ues
[ii];

73 
nodesigma
[
sourûs
[
ii
]] = 
sigma_v®ues
[ii];

75 
	}
}

76 
	$š™nodesigmadi¡_muÉisourû_sšgË»Ïx
(
G¿ph
 *
g¿ph
,*
v®ues
, *
sigma_v®ues
,
nodes
, * 
nodesigma
, * 
nodedi¡
,*
sourûs
,
sourû_couÁ
){

77 
ii
,
j
;

86 
ii
=0 ; i˜< 
sourû_couÁ
 ; ii++)

88 
nodedi¡
[
sourûs
[
ii
]] = 
v®ues
[ii];

89 
nodesigma
[
sourûs
[
ii
]] = 
sigma_v®ues
[ii];

92 
	}
}

93 
	$š™nodesigmadi¡_muÉisourû_omp_sšgË»Ïx
(
G¿ph
 *
g¿ph
,*
v®ues
,*
sigma_v®ues
,
nodes
, * 
nodesigma
, * 
nodedi¡
,*
sourûs
,
sourû_couÁ
,
num_th»ads
){

94 
ii
,
j
;

105 
ii
=0 ; i˜< 
sourû_couÁ
 ; ii++)

107 
nodedi¡
[
sourûs
[
ii
]] = 
v®ues
[ii];

108 
nodesigma
[
sourûs
[
ii
]] = 
sigma_v®ues
[ii];

110 
	}
}

113 
	$š™nodesigmadi¡_omp
(
sourû
, 
nodes
, * 
nodesigma
, * 
nodedi¡
,
num_th»ads
){

114 
ii
;

115 #´agm¨
omp
 
·¿Î–
 
	`´iv©e
(
ii
è
	`scheduË
(
guided
è
	`num_th»ads
(
num_th»ads
)

116 
ii
 = 0; i˜< 
nodes
; ii++) {

117 
nodesigma
[
ii
] = 0;

118 
nodedi¡
[
ii
] = 
MYINFINITY
;

120 
nodesigma
[
sourû
] = 1;

121 
nodedi¡
[
sourû
] = 0;

122 
	}
}

123 
	$gpu_compÚ’t
 (*
p¤c
,*
noutgošg
,*
d_p¤c
,*
d_noutgošg
,*
edgesd¡¤c
,*
edges¤cd¡
,
hedges
,
hnodes
,*
hdi¡
,*
nodesigma
,*
edgesigma
,
sourû_couÁ
,*
sourûs
,
cudaDeviûPrİ
 *
dp
,
boŞ
 
BM_COMP
,*
Ã¼
)

125 
	`lÚe¡¬_gpu
(
p¤c
,
noutgošg
,
d_p¤c
,
d_noutgošg
,
edgesd¡¤c
,
edges¤cd¡
,
hedges
,
hnodes
,
hdi¡
,
nodesigma
,
edgesigma
,
sourû_couÁ
,
sourûs
,
dp
,
BM_COMP
,
Ã¼
);

126 
	}
}

127 
	$ıu_compÚ’t
 (*
p¤c
,*
noutgošg
,*
edgesd¡¤c
,*
edges¤cd¡
,
hnodes
,
hedges
,*
hdi¡
,*
nodesigma
,*
edgesigma
,
sourû_couÁ
,*
sourûs
,
omp_lock_t
 *
lock
,
boŞ
 
BM_COMP
, 
num_th»ads
)

129 
	`b‘w“Âess_ûÁ¿l™y_·¿Î–
(
hnodes
,
hedges
,
p¤c
,
edges¤cd¡
,
edgesd¡¤c
,
noutgošg
,
sourûs
,
sourû_couÁ
,
hdi¡
,
nodesigma
,
edgesigma
,
lock
,
num_th»ads
);

131 
	}
}

132 *
	$ıu_BFS
(*
P
){

133 
v¬to_ıu_·¹
 *
v¬
 = (v¬to_ıu_·¹ *)
P
;

134 
G¿ph
 *
g¿ph
 = 
v¬
->graph;

135 
numEdges_¤c
,
numNodes_¤c
,
sourû
 = 
v¬
->sourû,
bÜd”Index
,
ii
;

136 
num_th»ads
 = 
v¬
->num_threads;

137 
¡¬‰ime
, 
’dtime
;

138 
G¿ph
::
DeviûP¬t™iÚ
 *
¤ı¬t
 = 
v¬
->
·¹™iÚ
;

139 
G¿ph
::
P¬t™iÚ
 *
bÜd”Info
 = 
v¬
->borderInfo;

140 
numEdges_¤c
 = 
¤ı¬t
->
numEdges
;

141 
numNodes_¤c
 = 
¤ı¬t
->
numNodes
;

142 
bÜd”CouÁ
 = 
bÜd”Info
->bÜd”CouÁ[
CPUPARTITION
];

144 
	`š™nodesigmadi¡_omp
 (
sourû
,
g¿ph
->
Âodes
, 
¤ı¬t
->
nodesigma
, srı¬t->
nodedi¡
,
num_th»ads
);

145 
¡¬‰ime
 = 
	`¹şock
();

146 
	`ıu_compÚ’t
 (
¤ı¬t
->
p¤c
,¤ı¬t->
noutgošg
,¤ı¬t->
edge¤c
,¤ı¬t->
edged¡
,
g¿ph
->
Âodes
,
numEdges_¤c
,¤ı¬t->
nodedi¡
,¤ı¬t->
nodesigma
,¤ı¬t->
edgesigma
,1,&
sourû
,
v¬
->
lock
,
çl£
,
num_th»ads
);

147 
’dtime
 = 
	`¹şock
 ();

148 
	`´štf
("FÜ CPU BFS„uÁimğ%.3làms\n", 1000*(
’dtime
 -
¡¬‰ime
));

149 
ıu_¿tiÙime
 +ğ
’dtime
-
¡¬‰ime
;

150 
	}
}

152 *
	$gpu_BFS
(*
v¬
){

153 
¡¬‰ime
, 
’dtime
;

154 
v¬to_gpu_·¹
 *
P
 = (v¬to_gpu_·¹ *)
v¬
;

155 
bÜd”Index
,
bÜd”Index2
;

156 
G¿ph
 *
g¿ph
 = 
P
->graph;

157 
numEdges
,
numNodes
,
sourû
 = 
P
->sourû,
ii
;

158 
G¿ph
::
DeviûP¬t™iÚ
 *
gpu·¹
 = 
P
->gpupart;

159 
G¿ph
::
P¬t™iÚ
 *
bÜd”Info
 = 
P
->borderInfo;

160 
numEdges
 = 
gpu·¹
->numEdges;

161 
numNodes
 = 
gpu·¹
->numNodes;

162 
fÜu
 
fÜuz”o
 = 0, 
fÜuÚe
=1;

163 
bÜd”CouÁ
 = 
bÜd”Info
->bÜd”CouÁ[
GPUPARTITION
];

164 
	`cudaMem£t
(
P
->
edgesigma
,0,(
numEdges
) * ());

165 
	`cudaMem£t
(
P
->
nodesigma
,0,(
g¿ph
->
Âodes
)*());

166 
	`cudaMem£t
(
P
->
nodedi¡
,
MYINFINITY
,(
g¿ph
->
Âodes
)*());

167 
	`cudaMemıy
(&(
P
->
nodedi¡
[
sourû
]), &
fÜuz”o
, (fÜuz”o), 
cudaMemıyHo¡ToDeviû
);

168 
	`cudaMemıy
(&(
P
->
nodesigma
[
sourû
]), &
fÜuÚe
, (fÜuÚe), 
cudaMemıyHo¡ToDeviû
);

169 
¡¬‰ime
 = 
	`¹şock
();

170 
	`gpu_compÚ’t
 (
gpu·¹
->
p¤c
,gpu·¹->
noutgošg
,
P
->p¤c,P->noutgošg,P->
edge¤c
,P->
edged¡
,
numEdges
,
g¿ph
->
Âodes
,P->
nodedi¡
,P->
nodesigma
,P->
edgesigma
,1,&
sourû
,&(P->
kcÚf
->
dp
),
çl£
,P->
Ã¼
);

171 
	`cudaDeviûSynchrÚize
 ();

172 
’dtime
 = 
	`¹şock
 ();

173 
	`´štf
("FÜ GPU BFS„uÁimğ%.3làms\n", 1000*(
’dtime
 -
¡¬‰ime
));

174 
gpu_¿tiÙime
 +ğ
’dtime
-
¡¬‰ime
;

175 
	}
}

177 
	$maš
(
¬gc
, *
¬gv
[]){

178 ià(
¬gc
 < 2) {

179 
	`´štf
("U§ge: % <g¿ph>\n", 
¬gv
[0]);

180 
	`ex™
(1);

182 *
šputfe
 = 
¬gv
[1];

183 
weigh‹d
 = 0,
numEdges
,
numNodes
;

184 *
nodesigma
, *
edge¤c
, *
edged¡
, *
nodedi¡
, *
edgewt
,*
p¤c
,*
noutgošg
,*
edgesigma
,*
bÜd”
,*
Ã¼
;

185 
num_th»ads
=16;

186 
G¿ph
 
g¿ph
;

187 
	`cudaDeviûRe£t
();

188 
K”ÃlCÚfig
 
	`kcÚf
(1);

189 
cudaSŒ—m_t
 
sÚe
, 
¡wo
,
¡h»e
,
sfour
;

190 
v¬to_ıu_·¹
 
P
;

191 
v¬to_gpu_·¹
 
d©a_gpu
;

192 
±h»ad_t
 
th»ad1
;

193 
¡¬‰ime
, 
’dtime
,
Fš®¡¬‰ime
,
Fš®’dtime
,
tmp¡time
,
tm³ndtime
,
fwdph_¡¬‰ime
,
tÙ®I‹¿tiveTime
,
tÙ®_fwd_time
=0,
F_R
,
tÙ®_bck_time
=0,
bckph_¡¬‰ime
;

194 
	`cudaSŒ—mC»©e
(&
sÚe
);

195 
	`cudaSŒ—mC»©e
(&
¡wo
);

196 
	`cudaSŒ—mC»©e
(&
¡h»e
);

197 
	`cudaSŒ—mC»©e
(&
sfour
);

198 if(
	`omp_g‘_num_´ocs
() <= 4)

199 
num_th»ads
 = 
	`omp_g‘_num_´ocs
();

202 
	`´štf
("NØoàCPU %d\n",
	`omp_g‘_num_´ocs
());

203 
num_th»ads
-=0;

204 
num_th»ads
=16;

207 
¡d
::
of¡»am
 
cfe
;

208 
cfe
.
	`İ’
("ratio.txt");

210 
	`omp_£t_num_th»ads
(
num_th»ads
);

211 
g¿ph
.
	`»ad
(
šputfe
, 
weigh‹d
);

212 
g¿ph
.
	`š™From
(graph);

214 
g¿ph
.
	`fÜmM‘isP¬t™iÚs
(g¿ph, &g¿ph.
·¹™iÚ
);

215 
g¿ph
.
	`fÜmDeviûP¬t™iÚs
(graph);

217 
	`¤ªd
 (
	`time
(
NULL
));

218 
t¡¬‰ime
 = 
	`¹şock
();

219 
g¿ph
.
num_th»ads
 =‚um_threads;

220 
	`´štf
("max‚odcouÁ: %d\n", 
g¿ph
.
maxNodeCouÁ
);

221 
	`´štf
("maxƒdgcouÁ: %d\n", 
g¿ph
.
maxEdgeCouÁ
);

222 ià(
	`cudaM®loc
((**)&
edge¤c
, (
g¿ph
.
maxEdgeCouÁ
è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocatingƒdgesrc failed");

223 ià(
	`cudaM®loc
((**)&
edged¡
, (
g¿ph
.
maxEdgeCouÁ
è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocatingƒdgedst failed");

225 ià(
	`cudaM®loc
((**)&
edgesigma
, (
g¿ph
.
maxEdgeCouÁ
è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocatingƒdgesigma failed");

226 ià(
	`cudaM®loc
((**)&
nodedi¡
, (
g¿ph
.
Âodes
è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚odedist failed");

227 ià(
	`cudaM®loc
((**)&
nodesigma
, (
g¿ph
.
Âodes
è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚odesigma failed");

230 ià(
	`cudaM®loc
((**)&
p¤c
, (
g¿ph
.
Âodes
+1è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚odedist failed");

231 ià(
	`cudaM®loc
((**)&
noutgošg
, (
g¿ph
.
Âodes
+1è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚odedist failed");

232 ià(
	`cudaM®loc
((**)&
bÜd”
, (
g¿ph
.
Âodes
è* ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚odedist failed");

233 ià(
	`cudaM®loc
((**)&
Ã¼
, ()è!ğ
cudaSucûss
è
	`CudaTe¡
("allocating‚err failed");

234 
kcÚf
.
	`£tMaxTh»adsP”Block
();

237 ià(!
kcÚf
.
	`cov”sProbËm
()) {

238 
	`´štf
("Thnumb” oàth»ads(%dèdÛ nÙ cov”h´obËm(%d),‚umb” oà™em ³¸th»ad=%d.\n", 
kcÚf
.
	`g‘Numb”OfBlockTh»ads
()*kcÚf.
	`g‘Numb”OfBlocks
(), kcÚf.
	`g‘ProbËmSize
(), kconf.getProblemSize() / (kconf.getNumberOfBlockThreads()*kconf.getNumberOfBlocks()));

241 
	`CUDACOPY
(
edge¤c
, 
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].edge¤c, (
numEdges
è* (), 
cudaMemıyHo¡ToDeviû
,
sÚe
);

242 
	`CUDACOPY
(
edged¡
, 
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].edged¡, (
numEdges
è* (), 
cudaMemıyHo¡ToDeviû
,
¡wo
);

244 
	`CUDACOPY
(
p¤c
, 
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].p¤c, (g¿ph.
Âodes
+1è* (), 
cudaMemıyHo¡ToDeviû
,
sÚe
);

245 
	`CUDACOPY
(
noutgošg
, 
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].noutgošg, (g¿ph.
Âodes
+1è* (), 
cudaMemıyHo¡ToDeviû
,
¡wo
);

246 
	`CUDACOPY
(
bÜd”
, 
g¿ph
.
·¹™iÚ
.bÜd”, (g¿ph.
Âodes
è* (), 
cudaMemıyHo¡ToDeviû
,
¡wo
);

247 
	`cudaSŒ—mSynchrÚize
(
sÚe
);

248 
	`cudaSŒ—mSynchrÚize
(
¡wo
);

249 
	`cudaSŒ—mSynchrÚize
(
¡h»e
);

250 
omp_lock_t
 *
wr™–ock
=(omp_lock_ˆ*)
	`m®loc
(
g¿ph
.
Âodes
*(omp_lock_t));

253 
P
.
·¹™iÚ
 = &(
g¿ph
.
deviûP¬t™iÚ
[
CPUPARTITION
]);

254 
P
.
num_th»ads
 =‚um_threads;

255 
P
.
g¿ph
 = &graph;

256 
P
.
bÜd”Info
 = &(
g¿ph
.
·¹™iÚ
);

257 
P
.
sšgË_»Ïx
 = 
çl£
;

258 
P
.
lock
 = 
wr™–ock
;

259 
P
.
ıu_F_I
=P.
ıu_F_R
=P.
ıu_bck_kÆ_time
=P.
ıu_fwd_kÆ_time
=P.
ıu_tÙ_bck_time
=0;

261 
d©a_gpu
.
gpu·¹
 = &(
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
]);

262 
d©a_gpu
.
g¿ph
 = &graph;

263 
d©a_gpu
.
bÜd”Info
 = &(
g¿ph
.
·¹™iÚ
);

264 
d©a_gpu
.
nodesigma
 =‚odesigma;

265 
d©a_gpu
.
edge¤c
 =ƒdgesrc;

266 
d©a_gpu
.
edged¡
 =ƒdgedst;

267 
d©a_gpu
.
nodedi¡
 =‚odedist;

268 
d©a_gpu
.
edgewt
 =ƒdgewt;

269 
d©a_gpu
.
edgesigma
 =ƒdgesigma;

270 
d©a_gpu
.
kcÚf
 = &kconf;

271 
d©a_gpu
.
sšgË_»Ïx
 = 
çl£
;

272 
d©a_gpu
.
p¤c
 =…src;

273 
d©a_gpu
.
noutgošg
 =‚outgoing;

274 
d©a_gpu
.
bÜd”
 = border;

275 
d©a_gpu
.
Ã¼
 =‚err;

276 
d©a_gpu
.
num_th»ads
 =‚um_threads;

277 
d©a_gpu
.
lock
 = 
wr™–ock
;

279 
ii
=0;ii<5;ii++){

282 
	`cudaMem£t
(
edgesigma
,0,((
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].
numEdges
) * ()));

283 
	`cudaMem£t
(
nodesigma
,0,((
g¿ph
.
Âodes
) * ()));

284 
	`cudaMem£t
(
nodedi¡
,
MYINFINITY
,((
g¿ph
.
Âodes
) * ()));

286 
	`mem£t
(
g¿ph
.
deviûP¬t™iÚ
[
CPUPARTITION
].
edgesigma
,0,((g¿ph.deviûP¬t™iÚ[CPUPARTITION].
numEdges
) * ()));

287 
	`mem£t
(
g¿ph
.
deviûP¬t™iÚ
[
CPUPARTITION
].
nodesigma
,0,((g¿ph.
Âodes
) * ()));

288 
	`mem£t
(
g¿ph
.
deviûP¬t™iÚ
[
CPUPARTITION
].
nodedi¡
,
MYINFINITY
,((g¿ph.
Âodes
) * ()));

289 
	`mem£t
(
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].
edgesigma
,0,((g¿ph.deviûP¬t™iÚ[GPUPARTITION].
numEdges
) * ()));

290 
	`mem£t
(
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].
nodesigma
,0,((g¿ph.
Âodes
) * ()));

291 
	`mem£t
(
g¿ph
.
deviûP¬t™iÚ
[
GPUPARTITION
].
nodedi¡
,
MYINFINITY
,((g¿ph.
Âodes
) * ()));

293 
d©a_gpu
.
sourû
 = 
	`¿nd
(è% 
g¿ph
.
Âodes
;

294 if(
g¿ph
.
·¹™iÚ
.
·¹
[
d©a_gpu
.
sourû
]==
GPUPARTITION
) ;

296 
	`±h»ad_ü—‹
(&
th»ad1
,
NULL
,
gpu_BFS
,&(
d©a_gpu
));

298 
P
.
sourû
 = 
	`¿nd
(è% 
g¿ph
.
Âodes
;

299 if(
g¿ph
.
·¹™iÚ
.
·¹
[
P
.
sourû
]==
CPUPARTITION
) ;

301 
	`ıu_BFS
(&
P
);

302 
	`±h»ad_još
(
th»ad1
,
NULL
);

306 if(
gpu_¿tiÙime
/(
ıu_¿tiÙime
+gpu_ratiotime) > 0.10){

307 
cfe
<<
gpu_¿tiÙime
/(
ıu_¿tiÙime
+gpu_¿tiÙime)<<" "<<ıu_¿tiÙime/(ıu_¿tiÙime+gpu_¿tiÙime)<<
’dl
;

308 
cout
<<"R©iØfÜ cpu‡nd gpu‡» "<<
gpu_¿tiÙime
/(
ıu_¿tiÙime
+gpu_¿tiÙime)<<" "<<ıu_¿tiÙime/(ıu_¿tiÙime+gpu_¿tiÙime)<<
¡d
::
’dl
;

311 
cout
<<"Ratio for cpu‡nd gpu‡re "<<10<<" "<<90;

312 
cfe
<<10<<" "<<90;

319 
cfe
.
	`şo£
();

321 
Çme
[80]="";

322 
	`¡rÿt
(
Çme
,"./partition_patoh.exe ");

323 
	`¡rÿt
(
Çme
,
šputfe
);

324 
	`sy¡em
(
Çme
);

326 
‹ndtime
 = 
	`¹şock
();

327 
	`´štf
("R©iÚ c®cuÏtiÚimğ%.3làms\n",(
‹ndtime
-
t¡¬‰ime
)*1000);

338 
	}
}

	@partition_patoh.cu

1 
	~"·toh.h
"

2 
	~<¡dlib.h
>

3 
	~<io¡»am
>

4 
	~<¡dio.h
>

5 
	~<f¡»am
>

6 
	~<sys/time.h
>

7 
	~<time.h
>

8 
	~<uni¡d.h
>

9 
	$·toh_·¹™iÚ
(*
f’ame
,*
·¹weights
,*
rg‘weights
)

11 
PaToH_P¬am‘”s
 
¬gs
;

12 
_c
, 
_n
, 
_ncÚ¡
, *
cwghts
, *
nwghts
,

13 *
xpšs
, *
pšs
, *
·¹vec
,
cut
;

16 
timev®
 
tv
;

17 
time_t
 
cu¹ime
, 
´evtime
;

18 
	`g‘timeofday
(&
tv
, 
NULL
);

19 
´evtime
 = 
tv
.
tv_£c
+Ñv.
tv_u£c
*1.0e-6);

21 
	`PaToH_R—d_Hy³rg¿ph
(
f’ame
, &
_c
, &
_n
, &
_ncÚ¡
, &
cwghts
,

22 &
nwghts
, &
xpšs
, &
pšs
);

25 
´evtime
 = 
tv
.
tv_u£c
;

26 
	`´štf
("Hypergraph %10s -- #Cells=%6d #Nets=%6d #Pins=%8d #Const=%2d\n",

27 
f’ame
, 
_c
, 
_n
, 
xpšs
[_n], 
_ncÚ¡
);

30 
¬gs
.
MemMul_Pšs
=4;

32 
	`PaToH_In™Ÿlize_P¬am‘”s
(&
¬gs
, 
PATOH_CUTPART
,

33 
PATOH_SUGPARAM_SPEED
);

35 
¬gs
.
_k
 = 2;

36 
·¹vec
 = (*è
	`m®loc
(
_c
*());

37 
	`PaToH_AÎoc
(&
¬gs
, 
_c
, 
_n
, 
_ncÚ¡
, 
cwghts
, 
nwghts
, 
xpšs
, 
pšs
);

38 
	`PaToH_P¬t
(&
¬gs
, 
_c
, 
_n
, 
_ncÚ¡
, 0, 
cwghts
, 
nwghts
,

39 
xpšs
, 
pšs
, 
rg‘weights
, 
·¹vec
, 
·¹weights
, &
cut
);

41 
	`´štf
("%d-way cutsizis: %d\n", 
¬gs
.
_k
, 
cut
);

42 
	`g‘timeofday
(&
tv
, 
NULL
);

43 
cu¹ime
 = 
tv
.
tv_£c
+tv.
tv_u£c
*1.0e-6;

44 
	`´štf
("P©ohime: %.3làm£ø\n",(
cu¹ime
-
´evtime
)*1000);

45 
¡d
::
of¡»am
 
outfe
;

46 
outfe
.
	`İ’
("partitioninfo.txt");

47 
outfe
<<
cut
<<
¡d
::
’dl
;

48 
ii
=0;ii<
_c
;ii++)

49 
outfe
<<
·¹vec
[
ii
]<<
¡d
::
’dl
;

50 
outfe
.
	`şo£
();

52 
	`ä“
(
cwghts
); f»e(
nwghts
);

53 
	`ä“
(
xpšs
); f»e(
pšs
);

56 
	`ä“
(
·¹vec
);

57 
	`PaToH_F»e
();

59 
	}
}

61 
	$maš
(
¬gc
, *
¬gv
[]){

62 if(
¬gc
 < 1)

64 
	`´štf
("U§ge: % <g¿ph>\n", 
¬gv
[0]);

65 
	`ex™
(1);

67 *
·¹weights
 = (*)
	`m®loc
(2*());

68 *
rg‘weights
 = (*)
	`m®loc
(2*());

69 *
f’ame
 = 
¬gv
[1];

70 
¡d
::
if¡»am
 
	`cfe
("ratio.txt");

71 
cfe
>>
rg‘weights
[0]>>targetweights[1];

72 
	`·toh_·¹™iÚ
(
f’ame
,
·¹weights
,
rg‘weights
);

73 
	`ä“
(
·¹weights
);

74 
	`ä“
(
rg‘weights
);

76 
	}
}

	@patoh.h

17 #iâdeà
_PATOH_V3_LIB_H_


18 
	#_PATOH_V3_LIB_H_


	)

20 #ifdeà
__ılu¥lus


28 
	#PATOH_CONPART
 1

	)

30 
	#PATOH_CUTPART
 2

	)

33 
	#PATOH_SUGPARAM_DEFAULT
 0

	)

34 
	#PATOH_SUGPARAM_SPEED
 1

	)

35 
	#PATOH_SUGPARAM_QUALITY
 2

	)

38 
	#PATOH_BALANCE_STRICT
 0

	)

39 
	#PATOH_BALANCE_ADAPTIVE
 1

	)

40 
	#PATOH_BALANCE_RELAXED
 2

	)

44 
	#PATOH_VO_CONT
 0

	)

45 
	#PATOH_VO_RAND
 1

	)

46 
	#PATOH_VO_SCD
 2

	)

47 
	#PATOH_VO_SMAXNS
 3

	)

48 
	#PATOH_VO_SMINNS
 4

	)

49 
	#PATOH_VO_SMINNSSUM
 5

	)

50 
	#PATOH_VO_SWEEP
 6

	)

55 
	#PATOH_CRS_HCM
 1

	)

56 
	#PATOH_CRS_PHCM
 2

	)

57 
	#PATOH_CRS_MANDIS
 3

	)

58 
	#PATOH_CRS_AVGDIS
 4

	)

59 
	#PATOH_CRS_CANBERA
 5

	)

60 
	#PATOH_CRS_ABS
 6

	)

61 
	#PATOH_CRS_GCM
 7

	)

62 
	#PATOH_CRS_SHCM
 8

	)

64 
	#PATOH_CRS_HCC
 9

	)

65 
	#PATOH_CRS_HPC
 10

	)

66 
	#PATOH_CRS_ABSHCC
 11

	)

67 
	#PATOH_CRS_ABSHPC
 12

	)

68 
	#PATOH_CRS_CONC
 13

	)

69 
	#PATOH_CRS_GCC
 14

	)

70 
	#PATOH_CRS_SHCC
 15

	)

71 
	#PATOH_CRS_FIRST_NET_MATCH
 (
PATOH_CRS_SHCC
+1)

	)

73 
	#PATOH_CRS_NC
 
PATOH_CRS_FIRST_NET_MATCH


	)

74 
	#PATOH_CRS_MNC
 (
PATOH_CRS_FIRST_NET_MATCH
+1)

	)

80 
	#PATOH_IPA_GHGP
 1

	)

81 
	#PATOH_IPA_AGGMATCH
 2

	)

82 
	#PATOH_IPA_BF
 3

	)

83 
	#PATOH_IPA_BINPACK
 4

	)

84 
	#PATOH_IPA_RANDOM1
 5

	)

85 
	#PATOH_IPA_RANDOM2
 6

	)

86 
	#PATOH_IPA_RANDOM3
 7

	)

87 
	#PATOH_IPA_GHG_MAXPIN
 8

	)

88 
	#PATOH_IPA_GHG_MAXNET
 9

	)

89 
	#PATOH_IPA_GHG_MAXPOSGAIN
 10

	)

90 
	#PATOH_IPA_COMP_GHGP
 11

	)

91 
	#PATOH_IPA_GREEDY_COMP_GHGP
 12

	)

92 
	#PATOH_IPA_ALL
 13

	)

97 
	#PATOH_REFALG_NONE
 0

	)

98 
	#PATOH_REFALG_T_BFM
 1

	)

99 
	#PATOH_REFALG_T_FM
 2

	)

100 
	#PATOH_REFALG_D_BFM
 3

	)

101 
	#PATOH_REFALG_D_FM
 4

	)

102 
	#PATOH_REFALG_BKL
 5

	)

103 
	#PATOH_REFALG_KL
 6

	)

104 
	#PATOH_REFALG_MLG_BFM
 7

	)

105 
	#PATOH_REFALG_MLG_FM
 8

	)

106 
	#PATOH_REFALG_BFMKL
 9

	)

107 
	#PATOH_REFALG_FMKL
 10

	)

111 
	#PATOH_OD_ONLYRESTIME
 -1

	)

112 
	#PATOH_OD_NONE
 0

	)

113 
	#PATOH_OD_LOW
 1

	)

114 
	#PATOH_OD_MEDIUM
 2

	)

115 
	#PATOH_OD_HIGH
 3

	)

126 
cu‰y³
;

127 
_k
;

128 
ouutd‘a
;

129 
£ed
;

130 
doš™³rm
;

133 
bi£c_fixedÃtsiz‘rsh
;

134 
bi£c_Ãtsiz‘rsh
;

135 
bi£c_·¹muÉÃtsiz‘rsh
;

138 
bigVcyşe
,

139 
sm®lVcyşe
,

140 
u£§mem©chšgšVcyşes
;

143 
u£buck‘
;

144 
maxûÎšh—p
;

145 
h—pchk_mul
;

146 
h—pchk_div
;

149 
MemMul_C–lN‘
,

150 
MemMul_Pšs
,

151 
MemMul_G’”®
;

155 
üs_Vis™Ord”
;

156 
üs_®g
;

157 
üs_cßr£Áo
,

158 
üs_cßr£ÁokmuÉ
,

159 
üs_cßr£Å”
;

160 
üs_max®lowedûÎwmuÉ
;

161 
üs_id’aá”
;

162 
üs_id’_Ãtsiz‘rh
;

163 
üs_u£aá”
, 
üs_u£aá”®g
;

167 
nofš¡ªûs
;

170 
š™p_®g
;

171 
š™p_ruÂo
;

172 
š™p_ghg_Œyb®ªû
;

173 
š™p_»çlg
;

176 
»f_®g
;

177 
»f_u£aá”
, 
»f_u£aá”®g
;

178 
»f_·ssút
,

179 
»f_maxÃgmove
;

180 
»f_maxÃgmovemuÉ
;

181 
»f_dyÇmişockút
;

182 
»f_¦ow_uncßr£nšg
;

185 
b®ªû
;

186 
š™_imb®
,

187 
fš®_imb®
,

188 
ç¡_š™b®_muÉ
;

189 
š™_sŞ_disÿrd_muÉ
,

190 
fš®_sŞ_disÿrd_muÉ
;

193 
®Ïrgs
[8192];

194 
šputf’ame
[512];

195 
nooäun
;

196 
wr™•¬tšfo
;

199 } 
	tPaToH_P¬am‘”s
;

201 
PaToH_P¬am‘”s
 *
	tPPaToH_P¬am‘”s
;

207 
PaToH_In™Ÿlize_P¬am‘”s
(
PPaToH_P¬am‘”s
 
·rgs
, 
cu‰y³
,

208 
Sugge¡ByProbËmTy³
);

212 (*
SšgËArgum’tC®lBack
)(
	tPPaToH_P¬am‘”s
 
	t·rgs
, *
	tv¬ŸbË
, *
	tv®ue
, 
	tiv®ue
, 
	tfv®ue
);

214 
PaToH_Proûss_Argum’ts
(
PPaToH_P¬am‘”s
 
·rgs
, 
¡¬rgc
, 
¬gc
, *
¬gv
[], 
SšgËArgum’tC®lBack
 
func
);

218 
PaToH_AÎoc
(
PPaToH_P¬am‘”s
 
·rgs
, 
_c
, 
_n
, 
_ncÚ¡
,

219 *
cwghts
, *
nwghts
, *
xpšs
, *
pšs
);

221 
PaToH_F»e
();

228 
PaToH_P¬t™iÚ
(
PPaToH_P¬am‘”s
 
·rgs
, 
_c
, 
_n
, *
cwghts
,

229 *
nwghts
, *
xpšs
, *
pšs
, *
·¹vec
,

230 *
·¹weights
, *
cut
);

235 
PaToH_P¬t™iÚ_w™h_FixC–ls
(
PPaToH_P¬am‘”s
 
·rgs
, 
_c
, 
_n
,

236 *
cwghts
, *
nwghts
, *
xpšs
,

237 *
pšs
, *
·¹vec
, *
·¹weights
,

238 *
cut
);

243 
PaToH_MuÉiCÚ¡_P¬t™iÚ
(
PPaToH_P¬am‘”s
 
·rgs
, 
_c
, 
_n
,

244 
_ncÚ¡
, *
cwghts
,

245 *
xpšs
, *
pšs
, *
·¹vec
,

246 *
·¹weights
, *
cut
);

261 
PaToH_P¬t
(
PPaToH_P¬am‘”s
 
·rgs
, 
_c
, 
_n
, 
_ncÚ¡
, 
u£FixC–ls
,

262 *
cwghts
, *
nwghts
, *
xpšs
, *
pšs
, *
rg‘weights
,

263 *
·¹vec
, *
·¹weights
, *
cut
);

268 
PaToH_Refše_Bi£c
(
PPaToH_P¬am‘”s
 
·rgs
, 
_c
, 
_n
,

269 *
cwghts
, *
nwghts
, *
xpšs
,

270 *
pšs
, *
·¹vec
, *
·¹weights
,

271 *
cut
);

275 *
PaToH_V”siÚSŒ
();

276 
PaToH_Pršt_P¬am‘”_Abrv
();

278 
PaToH_Pršt_P¬am‘”s
(
PPaToH_P¬am‘”s
 
p
);

280 
PaToH_Check_U£r_P¬am‘”s
(
PPaToH_P¬am‘”s
 
·rgs
, 
v”bo£
);

282 
PaToH_R—d_Hy³rg¿ph
(*
f’ame
, *
_c
, *
_n
, *
_ncÚ¡
,

283 **
cwghts
, **
nwghts
, **
xpšs
, **
pšs
);

284 
PaToH_Wr™e_Hy³rg¿ph
(*
f’ame
, 
numb”šg
, 
_c
, 
_n
, 
_ncÚ¡
,

285 *
cwghts
, *
nwghts
, *
xpšs
, *
pšs
);

287 
PaToH_Check_Hy³rg¿ph
(
_c
, 
_n
, 
_ncÚ¡
,

288 *
cwghts
, *
nwghts
, *
xpšs
, *
pšs
);

290 
PaToH_Compu‹_Cut
(
_k
, 
cu‰y³
, 
_c
, 
_n
, *
nwghts
,

291 *
xpšs
, *
pšs
, *
·¹vec
);

293 
PaToH_Compu‹_P¬t_Weights
(
_k
, 
_c
, 
_ncÚ¡
,

294 *
cwghts
, *
·¹vec
, *
·¹weights
);

295 
PaToH_Compu‹_P¬t_N‘Weights
(
_k
, 
_n
, *
nwghts
,

296 *
xpšs
, *
pšs
,

297 *
·¹vec
, *
·¹šweights
);

300 #ifdeà
__ılu¥lus


	@scheduler19.h

1 #iâdeà
LSG_SCHEDULER


2 
	#LSG_SCHEDULER


	)

4 
	sScheduËr
 {

5 
ScheduËr
();

6 ~
ScheduËr
();

8 
š™
(
Áasks
);

9 
š™D©a
(
d©a
 = 0);

10 
š™Ord”
();

11 
upd©e
(
sk
, 
Ãwd©a
);

12 
Ãxt
();

13 
´ev
();

14 
ËtsOrd”
();

15 
sw­Ord”
(
Úe
, 
two
);

16 
sw­EÇbËd
(
Úe
, 
two
);

17 
´št
();

18 
»Üd”OnUpd©e
();

19 
dÚtReÜd”OnUpd©e
();

20 
»Üd”EÇbËd
();

22 
š™EÇbËd
();

23 
di§bËAÎ
();

24 
’abËAÎ
();

25 
assignEÇbËdAÎ
(
boŞ
 
¡©e
);

26 
di§bË
(
sk
);

27 
’abË
(
sk
);

28 
assignEÇbËd
(
sk
, 
boŞ
 
¡©e
);

29 
boŞ
 
isEÇbËd
(
sk
);

30 
boŞ
 
isDi§bËd
(
sk
);

31 
fšdEÇbËd
();

32 
ÃxtEÇbËd
();

33 
´štEÇbËd
();

35 *
	md©a
, *
	mÜd”
;

36 
	mÁasks
;

37 
	mcu¼’‰ask
, 
	m´eviousupd©ed
;

38 
boŞ
 
	m»Üd”Úupd©e
;

40 
boŞ
 *
	m’abËd
;

41 *
	m’abËdšu£
;

42 
	mÃÇbËd
;

44 
	gScheduËr
::
	$ScheduËr
() {

45 
Áasks
 = 0;

46 
d©a
 = 
Üd”
 = 
NULL
;

47 
’abËd
 = 
NULL
;

48 
’abËdšu£
 = 
NULL
;

49 
cu¼’‰ask
 = 0;

50 
´eviousupd©ed
 = 0;

51 
»Üd”Úupd©e
 = 
çl£
;

52 
ÃÇbËd
 = 0;

53 
	}
}

54 
	gScheduËr
::~
	$ScheduËr
() {

55 
	`ä“
(
d©a
);

56 
	`ä“
(
Üd”
);

57 
	`ä“
(
’abËd
);

58 
	`ä“
(
’abËdšu£
);

59 
	}
}

60 
	gScheduËr
::
	$š™
(
Áasks
) {

61 
d©a
 = (*)
	`m®loc
(
Áasks
 * ());

62 
Üd”
 = (*)
	`m®loc
(
Áasks
 * ());

63 
’abËd
 = (
boŞ
 *)
	`m®loc
(
Áasks
 * (bool));

64 
’abËdšu£
 = (*)
	`m®loc
(
Áasks
 * ());

65 
this
->
Áasks
 =‚tasks;

66 
	`š™D©a
(1);

67 
	`š™Ord”
();

68 
	`š™EÇbËd
();

69 
	`ËtsOrd”
();

70 
	}
}

71 
	gScheduËr
::
	$ËtsOrd”
() {

72 
ii
 = 0; i˜< 
Áasks
 - 1; ++ii) {

73 
jj
 = 
ii
 + 1; jj < 
Áasks
; ++jj) {

74 ià(
d©a
[
Üd”
[
ii
]] < d©a[Üd”[
jj
]]) {

75 
	`sw­Ord”
(
ii
, 
jj
);

79 
cu¼’‰ask
 = 0;

80 
	}
}

81 
	gScheduËr
::
	$š™EÇbËd
() {

82 
	`di§bËAÎ
();

83 
	}
}

84 
	gScheduËr
::
	$di§bËAÎ
() {

85 
	`assignEÇbËdAÎ
(
çl£
);

86 
ÃÇbËd
 = 0;

87 
	}
}

88 
	gScheduËr
::
	$’abËAÎ
() {

89 
	`assignEÇbËdAÎ
(
Œue
);

90 
ÃÇbËd
 = 
Áasks
;

91 
	}
}

92 
	gScheduËr
::
	$assignEÇbËdAÎ
(
boŞ
 
¡©e
) {

93 
ii
 = 0; i˜< 
Áasks
; ++ii) {

94 
	`assignEÇbËd
(
ii
, 
¡©e
);

96 
	}
}

97 
	gScheduËr
::
	$’abË
(
sk
) {

98 ià(
	`isDi§bËd
(
sk
)) {

99 ++
ÃÇbËd
;

100 
	`assignEÇbËd
(
sk
, 
Œue
);

102 
	}
}

103 
	gScheduËr
::
	$di§bË
(
sk
) {

104 ià(
	`isEÇbËd
(
sk
)) {

105 --
ÃÇbËd
;

106 
	`assignEÇbËd
(
sk
, 
çl£
);

108 
	}
}

109 
	gScheduËr
::
	$assignEÇbËd
(
sk
, 
boŞ
 
¡©e
) {

110 
’abËd
[
sk
] = 
¡©e
;

111 
	}
}

112 
boŞ
 
	gScheduËr
::
	$isEÇbËd
(
sk
) {

113  
’abËd
[
sk
];

114 
	}
}

115 
boŞ
 
	gScheduËr
::
	$isDi§bËd
(
sk
) {

116  !
	`isEÇbËd
(
sk
);

117 
	}
}

118 
	gScheduËr
::
	$sw­Ord”
(
Úe
, 
two
) {

119 
tmp
 = 
Üd”
[
Úe
];

120 
Üd”
[
Úe
] = ord”[
two
];

121 
Üd”
[
two
] = 
tmp
;

122 
	}
}

123 
	gScheduËr
::
	$sw­EÇbËd
(
Úe
, 
two
) {

124 
tmp
 = 
’abËdšu£
[
Úe
];

125 
’abËdšu£
[
Úe
] =ƒÇbËdšu£[
two
];

126 
’abËdšu£
[
two
] = 
tmp
;

127 
	}
}

128 
	gScheduËr
::
	$š™D©a
(
Ãwd©a
 ) {

129 
ii
 = 0; i˜< 
Áasks
; ++ii) {

130 
d©a
[
ii
] = 
Ãwd©a
;

132 
	}
}

133 
	gScheduËr
::
	$š™Ord”
() {

134 
ii
 = 0; i˜< 
Áasks
; ++ii) {

135 
Üd”
[
ii
] = ii;

137 
	}
}

138 
	gScheduËr
::
	$upd©e
(
sk
, 
Ãwd©a
) {

139 ià(
sk
 < 
Áasks
) {

140 
d©a
[
sk
] = 
Ãwd©a
;

141 ià(
»Üd”Úupd©e
) {

142 
	`ËtsOrd”
();

144 ià(
Ãwd©a
) {

145 
´eviousupd©ed
 = 
sk
;

149 
	`´štf
("E¼Ü: %s(%d): Task %d ouˆoàbound %d.\n", 
__FILE__
, 
__LINE__
, 
sk
, 
Áasks
);

150 
	}
}

151 
	gScheduËr
::
	$Ãxt
() {

152 
»tv®
 = 
Üd”
[
cu¼’‰ask
++];

153 ià(
cu¼’‰ask
 =ğ
Áasks
) {

154 
	`ËtsOrd”
();

156  
»tv®
;

157 
	}
}

158 
	gScheduËr
::
	$´ev
() {

163  
´eviousupd©ed
;

164 
	}
}

165 
	gScheduËr
::
	$´št
() {

166 
ii
 = 0; i˜< 
Áasks
; ++ii) {

167 
	`´štf
("%3d ", 
Üd”
[
ii
]);

169 
	`´štf
("\n");

170 
ii
 = 0; i˜< 
Áasks
; ++ii) {

171 
	`´štf
("%3d ", 
d©a
[
Üd”
[
ii
]]);

173 
	`´štf
("\n");

174 
	}
}

175 
	gScheduËr
::
	$´štEÇbËd
() {

176 
ii
 = 0; i˜< 
ÃÇbËd
; ++ii) {

177 
	`´štf
("%3d ", 
’abËdšu£
[
ii
]);

179 
	`´štf
("\n");

180 
	}
}

181 
	gScheduËr
::
	$»Üd”OnUpd©e
() {

182 
»Üd”Úupd©e
 = 
Œue
;

183 
	}
}

184 
	gScheduËr
::
	$dÚtReÜd”OnUpd©e
() {

185 
»Üd”Úupd©e
 = 
çl£
;

186 
	}
}

187 
	gScheduËr
::
	$fšdEÇbËd
() {

188 
Ën
 = 0;

189 
ii
 = 0; i˜< 
Áasks
; ++ii) {

190 ià(
	`isEÇbËd
(
ii
)) {

191 
’abËdšu£
[
Ën
++] = 
ii
;

194 
cu¼’‰ask
 = 0;

195 ià(
Ën
 !ğ
ÃÇbËd
) {

196 
	`´štf
("E¼Ü: %s(%d):†’(%dèªd‚’abËd(%dèdÚ'ˆm©ch.\n", 
__FILE__
, 
__LINE__
, 
Ën
, 
ÃÇbËd
);

198  
ÃÇbËd
;

199 
	}
}

200 
	gScheduËr
::
	$ÃxtEÇbËd
() {

201  
’abËdšu£
[
cu¼’‰ask
++];

202 
	}
}

203 
	gScheduËr
::
	$»Üd”EÇbËd
() {

204 
ii
 = 0; i˜< 
ÃÇbËd
 - 1; ++ii) {

205 
jj
 = 
ii
 + 1; jj < 
ÃÇbËd
; ++jj) {

206 ià(
d©a
[
’abËdšu£
[
ii
]] < d©a[’abËdšu£[
jj
]]) {

207 
	`sw­EÇbËd
(
ii
, 
jj
);

212 
	}
}

	@utils.h

1 #iâdeà
_UTILS_H


2 
	#_UTILS_H


	)

4 "C" 
tim”
();

	@worklist7.h

5 
	~<¡dio.h
>

6 
	~<cuda.h
>

7 
	~<time.h
>

8 
	~<f¡»am
>

9 
	~<¡ršg
>

10 
	~<veùÜ
>

11 
	~<io¡»am
>

12 
	~<¡ršg.h
>

14 
	#MINCAPACITY
 65535

	)

15 
	#MAXOVERFLOWS
 1

	)

18 
CudaTe¡
(*
msg
);

20 
	gWÜkli¡
::
	$WÜkli¡
() {

21 
	`š™
();

22 
	}
}

23 
	gWÜkli¡
::
	$š™
() {

24 
	`š™
(0);

25 
	}
}

26 
	gWÜkli¡
::
	$š™
(
š™Ÿlÿ·c™y
) {

27 
¡¬t
 = 
	`®loc
(1);

28 
’d
 = 
	`®loc
(1);

29 
ÿ·c™y
 = 
	`®loc
(1);

30 
	`£tC­ac™y
(
š™Ÿlÿ·c™y
);

31 
	`£tIn™ŸlSize
(0);

33 
™ems
 = 
NULL
;

34 ià(
š™Ÿlÿ·c™y
è
™ems
 = 
	`®loc
(initialcapacity);

35 
nov”æows
 = 0;

36 
	}
}

37 *
	gWÜkli¡
::
	$®loc
(
®locsize
) {

38 *
±r
 = 
NULL
;

39 ià(
	`cudaM®loc
((**)&
±r
, 
®locsize
 * ()è!ğ
cudaSucûss
) {

41 
	`´štf
("%s(%d): AÎoÿtšg %d faed oÀGPU.\n", 
__FILE__
, 
__LINE__
, 
®locsize
);

42  
NULL
;

44  
±r
;

45 
	}
}

46 
	gWÜkli¡
::
	$g‘C­ac™y
() {

47 
hÿ·c™y
;

48 
	`cudaMemıy
(&
hÿ·c™y
, 
ÿ·c™y
, (hÿ·c™y), 
cudaMemıyDeviûToHo¡
);

49  
hÿ·c™y
;

50 
	}
}

51 
	gWÜkli¡
::
	$ÿlcuÏ‹Size
(
h¡¬t
, 
h’d
) {

52 ià(
h’d
 >ğ
h¡¬t
) {

54  
h’d
 - 
h¡¬t
;

57 
hÿ·c™y
 = 
	`g‘C­ac™y
();

59  
h’d
 + (
hÿ·c™y
 - 
h¡¬t
 + 1);

60 
	}
}

61 
	gWÜkli¡
::
	$g‘S¹End
(&
h¡¬t
, &
h’d
) {

62 
	`cudaMemıy
(&
h¡¬t
, 
¡¬t
, (h¡¬t), 
cudaMemıyDeviûToHo¡
);

63 
	`cudaMemıy
(&
h’d
, 
’d
, (h’d), 
cudaMemıyDeviûToHo¡
);

64 
	}
}

65 
	gWÜkli¡
::
	$g‘Size
() {

66 
h¡¬t
, 
h’d
;

67 
	`g‘S¹End
(
h¡¬t
, 
h’d
);

68 ià(
h¡¬t
 !ğ0è{ 
	`´štf
("\tNOTICE on GPU: hstart = %d.\n", hstart); }

69  
	`ÿlcuÏ‹Size
(
h¡¬t
, 
h’d
);

70 
	}
}

71 
	gWÜkli¡
::
	$£tS¹End
(
h¡¬t
, 
h’d
) {

72 
	`cudaMemıy
(
¡¬t
, &
h¡¬t
, (h¡¬t), 
cudaMemıyHo¡ToDeviû
);

73 
	`cudaMemıy
(
’d
, &
h’d
, (h’d), 
cudaMemıyHo¡ToDeviû
);

74 
	}
}

75 
	gWÜkli¡
::
	$£tC­ac™y
(
hÿ·c™y
) {

76 
	`cudaMemıy
(
ÿ·c™y
, &
hÿ·c™y
, (hÿ·c™y), 
cudaMemıyHo¡ToDeviû
);

77 
	}
}

78 
	gWÜkli¡
::
	$£tIn™ŸlSize
(
hsize
) {

79 
	`£tS¹End
(0, 0);

80 
	}
}

81 
	gWÜkli¡
::
	$£tSize
(
hsize
) {

82 
hÿ·c™y
 = 
	`g‘C­ac™y
();

83 ià(
hsize
 > 
hÿ·c™y
) {

84 
	`´štf
("%s(%d): bufã¸ov”æow, s‘tšg size=%d, wh’ c­ac™y=%d.\n", 
__FILE__
, 
__LINE__
, 
hsize
, 
hÿ·c™y
);

87 
h¡¬t
, 
h’d
;

88 
	`g‘S¹End
(
h¡¬t
, 
h’d
);

89 ià(
h¡¬t
 + 
hsize
 < 
hÿ·c™y
) {

90 
h’d
 = 
h¡¬t
 + 
hsize
;

92 
hsize
 -ğ
hÿ·c™y
 - 
h¡¬t
;

93 
h’d
 = 
hsize
;

95 
	`£tS¹End
(
h¡¬t
, 
h’d
);

96 
	}
}

97 
	gWÜkli¡
::
	$cİyOldToNew
(*
Şd™ems
, *
Ãw™ems
, 
Şdsize
, 
Şdÿ·c™y
) {

98 
my¡¬t
, 
my’d
;

99 
	`g‘S¹End
(
my¡¬t
, 
my’d
);

101 ià(
my¡¬t
 < 
my’d
) {

102 
	`cudaMemıy
(
Ãw™ems
, 
Şd™ems
 + 
my¡¬t
, 
Şdsize
 * (), 
cudaMemıyDeviûToDeviû
);

104 
	`cudaMemıy
(
Ãw™ems
, 
Şd™ems
 + 
my¡¬t
, (
Şdÿ·c™y
 - my¡¬tè* (), 
cudaMemıyDeviûToDeviû
);

105 
	`cudaMemıy
(
Ãw™ems
 + (
Şdÿ·c™y
 - 
my¡¬t
), 
Şd™ems
, 
my’d
 * (), 
cudaMemıyDeviûToDeviû
);

107 
	}
}

108 
	gWÜkli¡
::
	$»®loc
(
¥aû
) {

109 
hÿ·c™y
 = 
	`g‘C­ac™y
();

111 
Ãwÿ·c™y
 = (
¥aû
 > 
MINCAPACITY
 ? space : MINCAPACITY);

112 ià(
hÿ·c™y
 == 0) {

114 
	`£tC­ac™y
(
Ãwÿ·c™y
);

115 
™ems
 = 
	`®loc
(
Ãwÿ·c™y
);

116 ià(
™ems
 =ğ
NULL
) {

120 *
™em¤—Îoc
 = 
	`®loc
(
Ãwÿ·c™y
);

121 ià(
™em¤—Îoc
 =ğ
NULL
) {

124 
Şdsize
 = 
	`g‘Size
();

126 
	`cİyOldToNew
(
™ems
, 
™em¤—Îoc
, 
Şdsize
, 
hÿ·c™y
);

127 
	`d—Îoc
();

128 
™ems
 = 
™em¤—Îoc
;

129 
	`£tC­ac™y
(
Ãwÿ·c™y
);

130 
	`£tS¹End
(0, 
Şdsize
);

134 
	}
}

135 
	gWÜkli¡
::
	$ä“Size
() {

136  
	`g‘C­ac™y
(è- 
	`g‘Size
();

137 
	}
}

138 
	gWÜkli¡
::
	$’su»S·û
(
¥aû
) {

140 ià(
	`ä“Size
(è>ğ
¥aû
) {

145 
	`»®loc
(
¥aû
);

148 
	}
}

149 
	gWÜkli¡
::
	$d—Îoc
() {

150 
	`´štf
("\nDeallocating Worklist GPU");

151 
	`cudaF»e
(
™ems
);

155 
	`£tIn™ŸlSize
(0);

157 
	}
}

158 
	gWÜkli¡
::~
	$WÜkli¡
() {

161 
	}
}

162 
__deviû__
 
WÜkli¡
::
	$pushRªge
(*
cİyäom
, 
n™ems
) {

163 ià(
cİyäom
 =ğ
NULL
 || 
n™ems
 == 0)  0;

165 
lÿp
 = *
ÿ·c™y
;

166 
off£t
 = 
	`©omicAdd
(
’d
, 
n™ems
);

167 ià(
off£t
 >ğ
lÿp
) {

168 
	`©omicSub
(
’d
, 
n™ems
);

173 
ii
 = 0; i˜< 
n™ems
; ++ii) {

174 
™ems
[(
off£t
 + 
ii
è% 
lÿp
] = 
cİyäom
[ii];

178 
	}
}

179 
__deviû__
 
	gWÜkli¡
::
	$pushRªgeEdges
(
¡¬tšdex
, 
n™ems
) {

180 ià(
n™ems
 == 0)  0;

182 
lÿp
 = *
ÿ·c™y
;

183 
off£t
 = 
	`©omicAdd
(
’d
, 
n™ems
);

185 ià((
off£t
>=
lÿp
)||((off£t+
n™ems
)>=lcap)) {

186 
	`©omicSub
(
’d
, 
n™ems
);

191 
ii
 = 0; i˜< 
n™ems
; ++ii) {

192 
™ems
[(
off£t
 + 
ii
è% 
lÿp
] = 
¡¬tšdex
+ii;

197 
	}
}

199 
__deviû__
 
	gWÜkli¡
::
	$push
(
wÜk
) {

200  
	`pushRªge
(&
wÜk
, 1);

201 
	}
}

202 
__deviû__
 
	gWÜkli¡
::
	$pİRªge
(*
cİyto
, 
n™ems
) {

203 
cu¼size
 = 
	`couÁ
();

204 ià(
cu¼size
 < 
n™ems
) {

206 
n™ems
 = 
cu¼size
;

211 
off£t
 = 0;

212 
lÿp
 = *
ÿ·c™y
;

213 ià(
n™ems
) {

214 ià(*
¡¬t
 + 
n™ems
 < 
lÿp
) {

215 
off£t
 = 
	`©omicAdd
(
¡¬t
, 
n™ems
);

217 
off£t
 = 
	`©omicExch
(
¡¬t
, *¡¬ˆ+ 
n™ems
 - 
lÿp
);

221 
ii
 = 0; i˜< 
n™ems
; ++ii) {

222 
cİyto
[
ii
] = 
™ems
[(
off£t
 + iiè% 
lÿp
];

224  
n™ems
;

225 
	}
}

226 
__deviû__
 
	gWÜkli¡
::
	$pİ
(&
wÜk
) {

227  
	`pİRªge
(&
wÜk
, 1);

228 
	}
}

229 
	gWÜkli¡
::
	$pushRªgeHo¡
(*
cİyäom
, 
n™ems
) {

231 
	`’su»S·û
(
n™ems
);

232 
hsize
 = 
	`g‘Size
();

237 
	`cudaMemıy
(
™ems
 + 
hsize
 , 
cİyäom
, 
n™ems
 * (), 
cudaMemıyHo¡ToDeviû
);

241 
hsize
 +ğ
n™ems
;

243 
	`£tSize
(
hsize
);

245 
	}
}

246 
	gWÜkli¡
::
	$pushHo¡
(
wÜk
) {

247 
	`pushRªgeHo¡
(&
wÜk
, 1);

248 
	}
}

249 
__deviû__
 
	gWÜkli¡
::
	$ş—r
() {

250 *
’d
 = *
¡¬t
;

251 
	}
}

252 
	gWÜkli¡
::
	$ş—rHo¡
() {

253 
	`£tSize
(0);

254 
	}
}

255 
__deviû__
 
	gWÜkli¡
::
	$myI‹ms
(&
my¡¬t
, &
my’d
) {

256 
nblocks
 = 
gridDim
.
x
;

257 
Áh»ad¥”block
 = 
blockDim
.
x
;

258 
Áh»ads
 = 
nblocks
 * 
Áh»ad¥”block
;

259 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

260 
hsize
 = 
	`couÁ
();

262 ià(
Áh»ads
 > 
hsize
) {

264 ià(
id
 < 
hsize
) {

265 
my¡¬t
 = 
id
;

266 
my’d
 = 
my¡¬t
 + 1;

268 
my¡¬t
 = 
id
;

269 
my’d
 = 
my¡¬t
;

272 
n™em¥”th»ad
 = 
hsize
 / 
Áh»ads
;

273 
n™em¤emaššg
 = 
hsize
 % 
Áh»ads
;

274 
my¡¬t
 = 
id
 * 
n™em¥”th»ad
;

275 
my’d
 = 
my¡¬t
 + 
n™em¥”th»ad
;

277 ià(
id
 < 
n™em¤emaššg
) {

278 
my¡¬t
 +ğ
id
;

279 
my’d
 +ğ
id
 + 1;

281 
my¡¬t
 +ğ
n™em¤emaššg
;

282 
my’d
 +ğ
n™em¤emaššg
;

285 
	}
}

286 
__deviû__
 
	gWÜkli¡
::
	$g‘I‹m
(
©
) {

287 
hsize
 = 
	`couÁ
();

289  
	`g‘I‹mW™hš
(
©
, 
hsize
);

290 
	}
}

291 
__deviû__
 
	gWÜkli¡
::
	$g‘I‹mW™hš
(
©
, 
hsize
) {

292 ià(
©
 < 
hsize
) {

293  
™ems
[
©
];

295 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

296 
	`´štf
("%s(%d):h»ad %d: bufã¸ov”æow,ƒxŒaùšg %d wh’ bufã¸sizi %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
©
, 
hsize
);

298 
	}
}

299 
__deviû__
 
	gWÜkli¡
::
	$couÁ
() {

300 ià(*
’d
 >ğ*
¡¬t
) {

301  *
’d
 - *
¡¬t
;

303  *
’d
 + (*
ÿ·c™y
 - *
¡¬t
 + 1);

305 
	}
}

307 
	#SWAPDEV
(
a
, 
b
è{ 
tmp
 =‡;‡ = b; b =mp; }

	)

309 
__glob®__
 
	$com´ess
(
WÜkli¡
 
wl
, 
wlsize
, 
£Áš–
) {

310 
id
 = 
blockIdx
.
x
 * 
blockDim
.x + 
th»adIdx
.x;

311 
__sh¬ed__
 
shmem
[
MAXSHAREDUINT
];

314 
wl¡¬t
 = 
MAXSHAREDUINT
 * 
blockIdx
.
x
 + 
SHAREDPERTHREAD
 * 
th»adIdx
.x;

315 
sh¡¬t
 = 
SHAREDPERTHREAD
 * 
th»adIdx
.
x
;

317 
ii
 = 0; i˜< 
SHAREDPERTHREAD
; ++ii) {

318 ià(
wl¡¬t
 + 
ii
 < 
wlsize
 && 
sh¡¬t
 + i˜< 
MAXSHAREDUINT
) {

319 
shmem
[
sh¡¬t
 + 
ii
] = 
wl
.
	`g‘I‹mW™hš
(
wl¡¬t
 + ii, 
wlsize
);

322 
	`__synùh»ads
();

326 
s
 = 
blockDim
.
x
 / 2; s; s >>= 1) {

327 ià(
th»adIdx
.
x
 < 
s
) {

328 ià(
shmem
[
th»adIdx
.
x
] > shmem[th»adIdx.x + 
s
]) {

329 
	`SWAPDEV
(
shmem
[
th»adIdx
.
x
], shmem[th»adIdx.x + 
s
]);

332 
	`__synùh»ads
();

334 
	`__synùh»ads
();

338 
Ï¡šdex
 = 0;

339 ià(
id
 == 0) {

340 
ii
 = 1; i˜< 
MAXSHAREDUINT
; ++ii) {

341 ià(
shmem
[
ii
] !ğshmem[
Ï¡šdex
]) {

342 
shmem
[++
Ï¡šdex
] = shmem[
ii
];

344 
shmem
[
ii
] = 
£Áš–
;

348 
	`__synùh»ads
();

351 
ii
 = 0; i˜< 
SHAREDPERTHREAD
; ++ii) {

352 ià(
wl¡¬t
 + 
ii
 < 
wlsize
) {

354 
wl
.
™ems
[
wl¡¬t
 + 
ii
] = 
shmem
[
sh¡¬t
 + ii];

357 
	`__synùh»ads
();

360 ià(
id
 == 0) {

361 *
wl
.
¡¬t
 = 0;

362 *
wl
.
’d
 = 
Ï¡šdex
 + 1;

364 
	}
}

365 
	gWÜkli¡
::
	$com´essHo¡
(
wlsize
, 
£Áš–
) {

366 
nblocks
 = (
wlsize
 + 
MAXBLOCKSIZE
 - 1) / MAXBLOCKSIZE;

367 
com´ess
<<<
nblocks
, 
MAXBLOCKSIZE
>>>(*
this
, 
wlsize
, 
£Áš–
);

368 
	`CudaTe¡
("compress failed");

369 
	}
}

370 
__glob®__
 
	$´štWÜkli¡
(
WÜkli¡
 
wl
) {

371 
¡¬t
, 
’d
;

372 
¡¬t
 = *
wl
.start;

373 
’d
 = *
wl
.end;

374 
	`´štf
("\t");

375 
ii
 = 
¡¬t
; i˜< 
’d
; ++ii) {

376 
	`´štf
("%d,", 
wl
.
	`g‘I‹m
(
ii
));

378 
	`´štf
("\n");

379 
	}
}

380 
	gWÜkli¡
::
	$´štHo¡
() {

381 
´štWÜkli¡
<<<1, 1>>>(*
this
);

382 
	`CudaTe¡
("printWorklist failed");

383 
	}
}

384 
__glob®__
 
	$­³ndWÜkli¡
(
WÜkli¡
 
d¡
, WÜkli¡ 
¤c
, 
d¡size
) {

385 
¡¬t
, 
’d
;

386 
¤c
.
	`myI‹ms
(
¡¬t
, 
’d
);

388 
ii
 = 
¡¬t
; i˜< 
’d
; ++ii) {

389 
d¡
.
™ems
[
d¡size
 + 
ii
] = 
¤c
.items[ii];

391 
	}
}

392 
	gWÜkli¡
::
	$­³ndHo¡
(
WÜkli¡
 *
Ùh”li¡
) {

393 
Ùh”li¡size
 = 
Ùh”li¡
->
	`g‘Size
();

394 
nblocks
 = (
Ùh”li¡size
 + 
MAXBLOCKSIZE
 - 1) / MAXBLOCKSIZE;

395 
­³ndWÜkli¡
<<<
nblocks
, 
MAXBLOCKSIZE
>>>(*
this
, *
Ùh”li¡
, 
	`g‘Size
());

396 
	`CudaTe¡
("appendWorklist failed");

397 
h¡¬t
, 
h’d
;

398 
	`g‘S¹End
(
h¡¬t
, 
h’d
);

399 
	`£tS¹End
(
h¡¬t
, 
h’d
 + 
Ùh”li¡size
);

401  
h’d
 + 
Ùh”li¡size
;

402 
	}
}

	@worklist_cpu.h

5 
	~<¡dio.h
>

6 
	~<¡dlib.h
>

7 
	~<time.h
>

8 
	~<f¡»am
>

9 
	~<¡ršg
>

10 
	~<veùÜ
>

11 
	~<io¡»am
>

12 
	~<¡ršg.h
>

13 
	~"SŒuùs.h
"

15 
	#MINCAPACITY
 65535

	)

16 
	#MAXOVERFLOWS
 1

	)

19 
	gWÜkli¡_ıu
::
	$WÜkli¡_ıu
() {

20 
	`š™
();

21 
	}
}

22 
	gWÜkli¡_ıu
::
	$š™
() {

23 
	`š™
(0);

24 
	}
}

25 
	gWÜkli¡_ıu
::
	$š™
(
š™Ÿlÿ·c™y
) {

26 
¡¬t
 = 
	`®loc
(1);

27 
’d
 = 
	`®loc
(1);

28 
ÿ·c™y
 = 
	`®loc
(1);

29 
	`£tC­ac™y
(
š™Ÿlÿ·c™y
);

30 
	`£tIn™ŸlSize
(0);

32 
™ems
 = 
NULL
;

33 ià(
š™Ÿlÿ·c™y
è
™ems
 = 
	`®loc
(initialcapacity);

34 
nov”æows
 = 0;

35 
	}
}

36 *
	gWÜkli¡_ıu
::
	$®loc
(
®locsize
) {

37 *
±r
 = (*è
	`m®loc
 (
®locsize
 * ());

38 ià(
±r
==
NULL
) {

40 
	`´štf
("%s(%d): AÎoÿtšg %d faed oÀCPU.\n", 
__FILE__
, 
__LINE__
, 
®locsize
);

41  
NULL
;

43  
±r
;

44 
	}
}

45 
	gWÜkli¡_ıu
::
	$g‘C­ac™y
() {

46  *
ÿ·c™y
;

47 
	}
}

48 
	gWÜkli¡_ıu
::
	$ÿlcuÏ‹Size
(
h¡¬t
, 
h’d
) {

49 ià(
h’d
 >ğ
h¡¬t
) {

51  
h’d
 - 
h¡¬t
;

54 
hÿ·c™y
 = 
	`g‘C­ac™y
();

56  
h’d
 + (
hÿ·c™y
 - 
h¡¬t
 + 1);

57 
	}
}

58 
	gWÜkli¡_ıu
::
	$g‘S¹End
(&
h¡¬t
, &
h’d
) {

61 
h¡¬t
 = *
¡¬t
;

62 
h’d
 = *
’d
;

63 
	}
}

64 
	gWÜkli¡_ıu
::
	$g‘Size
() {

65 
h¡¬t
, 
h’d
;

66 
	`g‘S¹End
(
h¡¬t
, 
h’d
);

67 ià(
h¡¬t
 !ğ0è{ 
	`´štf
("\tNOTICE CPU: hstart = %d.\n", hstart); }

68  
	`ÿlcuÏ‹Size
(
h¡¬t
, 
h’d
);

69 
	}
}

70 
	gWÜkli¡_ıu
::
	$£tS¹End
(
h¡¬t
, 
h’d
) {

73 *
¡¬t
 = 
h¡¬t
;

74 *
’d
 = 
h’d
;

75 
	}
}

76 
	gWÜkli¡_ıu
::
	$£tC­ac™y
(
hÿ·c™y
) {

78 *
ÿ·c™y
 = 
hÿ·c™y
;

79 
	}
}

80 
	gWÜkli¡_ıu
::
	$£tIn™ŸlSize
(
hsize
) {

81 
	`£tS¹End
(0, 0);

82 
	}
}

83 
	gWÜkli¡_ıu
::
	$£tSize
(
hsize
) {

84 
hÿ·c™y
 = 
	`g‘C­ac™y
();

85 ià(
hsize
 > 
hÿ·c™y
) {

86 
	`´štf
("%s(%d): bufã¸ov”æow, s‘tšg size=%d, wh’ c­ac™y=%d.\n", 
__FILE__
, 
__LINE__
, 
hsize
, 
hÿ·c™y
);

89 
h¡¬t
, 
h’d
;

90 
	`g‘S¹End
(
h¡¬t
, 
h’d
);

91 ià(
h¡¬t
 + 
hsize
 < 
hÿ·c™y
) {

92 
h’d
 = 
h¡¬t
 + 
hsize
;

94 
hsize
 -ğ
hÿ·c™y
 - 
h¡¬t
;

95 
h’d
 = 
hsize
;

97 
	`£tS¹End
(
h¡¬t
, 
h’d
);

98 
	}
}

99 
	gWÜkli¡_ıu
::
	$cİyOldToNew
(*
Şd™ems
, *
Ãw™ems
, 
Şdsize
, 
Şdÿ·c™y
) {

100 
my¡¬t
, 
my’d
;

101 
	`g‘S¹End
(
my¡¬t
, 
my’d
);

103 ià(
my¡¬t
 < 
my’d
) {

105 
	`memıy
(
Ãw™ems
, 
Şd™ems
 + 
my¡¬t
, 
Şdsize
 * ());

109 
	`memıy
(
Ãw™ems
, 
Şd™ems
 + 
my¡¬t
, (
Şdÿ·c™y
 - mystart) * ());

110 
	`memıy
(
Ãw™ems
 + (
Şdÿ·c™y
 - 
my¡¬t
), 
Şd™ems
, 
my’d
 * ());

112 
	}
}

113 
	gWÜkli¡_ıu
::
	$»®loc
(
¥aû
) {

114 
hÿ·c™y
 = 
	`g‘C­ac™y
();

116 
Ãwÿ·c™y
 = (
¥aû
 > 
MINCAPACITY
 ? space : MINCAPACITY);

117 ià(
hÿ·c™y
 == 0) {

119 
	`£tC­ac™y
(
Ãwÿ·c™y
);

120 
™ems
 = 
	`®loc
(
Ãwÿ·c™y
);

121 ià(
™ems
 =ğ
NULL
) {

125 *
™em¤—Îoc
 = 
	`®loc
(
Ãwÿ·c™y
);

126 ià(
™em¤—Îoc
 =ğ
NULL
) {

129 
Şdsize
 = 
	`g‘Size
();

131 
	`cİyOldToNew
(
™ems
, 
™em¤—Îoc
, 
Şdsize
, 
hÿ·c™y
);

132 
	`d—Îoc
();

133 
™ems
 = 
™em¤—Îoc
;

134 
	`£tC­ac™y
(
Ãwÿ·c™y
);

135 
	`£tS¹End
(0, 
Şdsize
);

139 
	}
}

140 
	gWÜkli¡_ıu
::
	$ä“Size
() {

141  
	`g‘C­ac™y
(è- 
	`g‘Size
();

142 
	}
}

143 
	gWÜkli¡_ıu
::
	$’su»S·û
(
¥aû
) {

145 ià(
	`ä“Size
(è>ğ
¥aû
) {

150 
	`»®loc
(
¥aû
);

153 
	}
}

154 
	gWÜkli¡_ıu
::
	$d—Îoc
() {

155 
	`´štf
("\nDeallocating Worklist CPU");

157 
	`ä“
(
™ems
);

158 
	`£tIn™ŸlSize
(0);

160 
	}
}

161 
	gWÜkli¡_ıu
::~
	$WÜkli¡_ıu
() {

164 
	}
}

165 
WÜkli¡_ıu
::
	$pushRªge
(*
cİyäom
, 
n™ems
) {

166 ià(
cİyäom
 =ğ
NULL
 || 
n™ems
 == 0)  0;

168 
lÿp
 = *
ÿ·c™y
, 
off£t
;

169 #´agm¨
omp
 
©omic
 
ÿ±u»


171 
off£t
 = *
’d
;

172 *
’d
 +ğ
n™ems
;

174 ià(
off£t
 >ğ
lÿp
) {

175 #´agm¨
omp
 
©omic
 
upd©e


176 *
’d
 -=
n™ems
;

182 
ii
 = 0; i˜< 
n™ems
; ++ii) {

183 
™ems
[(
off£t
 + 
ii
è% 
lÿp
] = 
cİyäom
[ii];

187 
	}
}

188 
	gWÜkli¡_ıu
::
	$pushRªgeEdges
(
¡¬tšdex
, 
n™ems
) {

189 ià(
n™ems
 == 0)  0;

191 
lÿp
 = *
ÿ·c™y
;

192 
off£t
;

193 #´agm¨
omp
 
©omic
 
ÿ±u»


195 
off£t
 = *
’d
;

196 *
’d
 +ğ
n™ems
;

199 ià((
off£t
>=
lÿp
)||((off£t+
n™ems
)>=lcap)) {

200 #´agm¨
omp
 
©omic
 
upd©e


201 *
’d
 -ğ
n™ems
;

206 
ii
 = 0; i˜< 
n™ems
; ++ii) {

207 
™ems
[(
off£t
 + 
ii
è% 
lÿp
] = 
¡¬tšdex
+ii;

212 
	}
}

214 
	gWÜkli¡_ıu
::
	$push
(
wÜk
) {

215  
	`pushRªge
(&
wÜk
, 1);

216 
	}
}

217 
	gWÜkli¡_ıu
::
	$pİRªge
(*
cİyto
, 
n™ems
) {

218 
cu¼size
 = 
	`couÁ
();

219 ià(
cu¼size
 < 
n™ems
) {

221 
n™ems
 = 
cu¼size
;

226 
off£t
 = 0;

227 
lÿp
 = *
ÿ·c™y
;

228 ià(
n™ems
) {

229 ià(*
¡¬t
 + 
n™ems
 < 
lÿp
) {

230 #´agm¨
omp
 
©omic
 
ÿ±u»


232 
off£t
 = *
¡¬t
;

233 *
¡¬t
 +ğ
n™ems
;

237 #´agm¨
omp
 
©omic
 
ÿ±u»


239 
off£t
 = *
¡¬t
;

240 *
¡¬t
 +=
n™ems
 - 
lÿp
;

245 
ii
 = 0; i˜< 
n™ems
; ++ii) {

246 
cİyto
[
ii
] = 
™ems
[(
off£t
 + iiè% 
lÿp
];

248  
n™ems
;

249 
	}
}

250 
	gWÜkli¡_ıu
::
	$pİ
(&
wÜk
) {

251  
	`pİRªge
(&
wÜk
, 1);

252 
	}
}

253 
	gWÜkli¡_ıu
::
	$pushRªgeHo¡
(*
cİyäom
, 
n™ems
) {

255 
	`’su»S·û
(
n™ems
);

256 
hsize
 = 
	`g‘Size
();

262 
	`memıy
(
™ems
 + 
hsize
 , 
cİyäom
, 
n™ems
 * ());

265 
hsize
 +ğ
n™ems
;

267 
	`£tSize
(
hsize
);

269 
	}
}

270 
	gWÜkli¡_ıu
::
	$pushHo¡
(
wÜk
) {

271 
	`pushRªgeHo¡
(&
wÜk
, 1);

272 
	}
}

273 
	gWÜkli¡_ıu
::
	$ş—r
() {

274 *
’d
 = *
¡¬t
;

275 
	}
}

276 
	gWÜkli¡_ıu
::
	$ş—rHo¡
() {

277 
	`£tSize
(0);

278 
	}
}

280 
	gWÜkli¡_ıu
::
	$myI‹ms
(&
my¡¬t
, &
my’d
) {

281 
id
 = 
	`omp_g‘_th»ad_num
();

282 
hsize
 = 
	`couÁ
();

283 
Áh»ads
 = 
	`omp_g‘_num_th»ads
();

285 ià(
Áh»ads
 > 
hsize
) {

287 ià(
id
 < 
hsize
) {

288 
my¡¬t
 = 
id
;

289 
my’d
 = 
my¡¬t
 + 1;

291 
my¡¬t
 = 
id
;

292 
my’d
 = 
my¡¬t
;

295 
n™em¥”th»ad
 = 
hsize
 / 
Áh»ads
;

296 
n™em¤emaššg
 = 
hsize
 % 
Áh»ads
;

297 
my¡¬t
 = 
id
 * 
n™em¥”th»ad
;

298 
my’d
 = 
my¡¬t
 + 
n™em¥”th»ad
;

300 ià(
id
 < 
n™em¤emaššg
) {

301 
my¡¬t
 +ğ
id
;

302 
my’d
 +ğ
id
 + 1;

304 
my¡¬t
 +ğ
n™em¤emaššg
;

305 
my’d
 +ğ
n™em¤emaššg
;

308 
	}
}

309 
	gWÜkli¡_ıu
::
	$g‘I‹m
(
©
) {

310 
hsize
 = 
	`couÁ
();

312  
	`g‘I‹mW™hš
(
©
, 
hsize
);

313 
	}
}

314 
	gWÜkli¡_ıu
::
	$g‘I‹mW™hš
(
©
, 
hsize
) {

315 ià(
©
 < 
hsize
) {

316  
™ems
[
©
];

318 
id
 = 
	`omp_g‘_th»ad_num
();

319 
	`´štf
("%s(%d):h»ad %d: bufã¸ov”æow,ƒxŒaùšg %d wh’ bufã¸sizi %d.\n", 
__FILE__
, 
__LINE__
, 
id
, 
©
, 
hsize
);

321 
	}
}

322 
	gWÜkli¡_ıu
::
	$couÁ
() {

323 ià(*
’d
 >ğ*
¡¬t
) {

324  *
’d
 - *
¡¬t
;

326  *
’d
 + (*
ÿ·c™y
 - *
¡¬t
 + 1);

328 
	}
}

330 
	#SWAPDEV
(
a
, 
b
è{ 
tmp
 =‡;‡ = b; b =mp; }

	)

393 
	$´štWÜkli¡
(
WÜkli¡_ıu
 
wl
) {

394 
¡¬t
, 
’d
;

395 
¡¬t
 = *
wl
.start;

396 
’d
 = *
wl
.end;

397 
	`´štf
("\t");

398 
ii
 = 
¡¬t
; i˜< 
’d
; ++ii) {

399 
	`´štf
("%d,", 
wl
.
	`g‘I‹m
(
ii
));

401 
	`´štf
("\n");

402 
	}
}

403 
	gWÜkli¡_ıu
::
	$´štHo¡
() {

404 #´agm¨
omp
 
sšgË


405 
	`´štWÜkli¡
(*
this
);

406 
	}
}

407 
	$­³ndWÜkli¡
(
WÜkli¡_ıu
 
d¡
, WÜkli¡_ıu 
¤c
, 
d¡size
) {

408 
¡¬t
, 
’d
;

409 
¤c
.
	`myI‹ms
(
¡¬t
, 
’d
);

411 
ii
 = 
¡¬t
; i˜< 
’d
; ++ii) {

412 
d¡
.
™ems
[
d¡size
 + 
ii
] = 
¤c
.items[ii];

414 
	}
}

415 
	gWÜkli¡_ıu
::
	$­³ndHo¡
(
WÜkli¡_ıu
 *
Ùh”li¡
) {

416 
Ùh”li¡size
 = 
Ùh”li¡
->
	`g‘Size
();

417 
	`­³ndWÜkli¡
(*
this
, *
Ùh”li¡
, 
	`g‘Size
());

418 
h¡¬t
, 
h’d
;

419 
	`g‘S¹End
(
h¡¬t
, 
h’d
);

420 
	`£tS¹End
(
h¡¬t
, 
h’d
 + 
Ùh”li¡size
);

422  
h’d
 + 
Ùh”li¡size
;

423 
	}
}

	@worklistc.h

1 #´agm¨
Úû


3 
	~"cut_sub£t.h
"

5 
	gz”o
 = 0;

7 
	sWÜkli¡
 {

8 *
	mdwl
, *
	mwl
;

9 
	mËngth
, *
	mdnsize
;

10 *
	mdšdex
;

12 
WÜkli¡
 (){

13 
	mdwl
 = 
wl
 = 
dnsize
 = 
dšdex
 = 
NULL
;

15 
WÜkli¡
(
size_t
 
nsize
)

17 
	mwl
 = (*è
ÿÎoc
(
nsize
, ());

18 
CUDA_SAFE_CALL
(
cudaM®loc
((**)&
dwl
, 
nsize
 * ()));

19 
CUDA_SAFE_CALL
(
cudaM®loc
((**)&
dnsize
, 1 * ()));

20 
CUDA_SAFE_CALL
(
cudaM®loc
((**)&
dšdex
, 1 * ()));

22 
CUDA_SAFE_CALL
(
cudaMemıy
(
dnsize
, &
nsize
, 1 * (), 
cudaMemıyHo¡ToDeviû
));

23 
CUDA_SAFE_CALL
(
cudaMemıy
((*è
dšdex
, &
z”o
, 1 * (z”o), 
cudaMemıyHo¡ToDeviû
));

26 ~
WÜkli¡
()

36 
upd©e_ıu
()

38 
	mnsize
 = 
n™ems
();

39 
CUDA_SAFE_CALL
(
cudaMemıy
(
wl
, 
dwl
, 
nsize
 * (), 
cudaMemıyDeviûToHo¡
));

42 
di¥Ïy_™ems
()

44 
	mnsize
 = 
n™ems
();

45 
CUDA_SAFE_CALL
(
cudaMemıy
(
wl
, 
dwl
, 
nsize
 * (), 
cudaMemıyDeviûToHo¡
));

47 
´štf
("WL: ");

48 
	mi
 = 0; i < 
	mnsize
; i++)

49 
´štf
("%d %d, ", 
i
, 
wl
[i]);

51 
´štf
("\n");

55 
»£t
()

57 
CUDA_SAFE_CALL
(
cudaMemıy
((*è
dšdex
, &
z”o
, 1 * (z”o), 
cudaMemıyHo¡ToDeviû
));

60 
n™ems
()

62 
	mšdex
;

63 
CUDA_SAFE_CALL
(
cudaMemıy
(&
šdex
, (*è
dšdex
, 1 * (šdex), 
cudaMemıyDeviûToHo¡
));

65  
	mšdex
;

68 
__deviû__


69 
push
(
™em
)

71 
	mlšdex
 = 
©omicAdd
((*è
dšdex
, 1);

72 if(
	mlšdex
 >ğ*
dnsize
)

75 
	mdwl
[
lšdex
] = 
™em
;

79 
__deviû__


80 
pİ
(&
™em
)

82 
	mlšdex
 = 
©omicSub
((*è
dšdex
, 1);

83 if(
	mlšdex
 <= 0)

85 *
dšdex
 = 0;

89 
	m™em
 = 
dwl
[
lšdex
 - 1];

104 
	m‹m¶©e
 <
ty³Çme
 
	mT
>

105 
__deviû__
 
__fÜûšlše__


106 
push_1™em
(
n™em
, 
™em
, 
th»ads_³r_block
)

108 
__sh¬ed__
 
ty³Çme
 
	mT
::
TempStÜage
 
‹mp_¡Üage
;

109 
__sh¬ed__
 
	mqueue_šdex
;

110 
	mtÙ®_™ems
 = 0;

111 
	mth»ad_d©a
 = 
n™em
;

113 
T
(
‹mp_¡Üage
).
ExşusiveSum
(
th»ad_d©a
,h»ad_d©a, 
tÙ®_™ems
);

115 if(
	mth»adIdx
.
	mx
 == 0)

118 
queue_šdex
 = 
©omicAdd
((*è
dšdex
, 
tÙ®_™ems
);

122 
__synùh»ads
();

124 if(
	mn™em
 == 1)

126 if(
queue_šdex
 + 
th»ad_d©a
 >ğ*
dnsize
)

128 
´štf
("GPU:ƒxûeded†’gth: %d %d %d\n", 
queue_šdex
, 
th»ad_d©a
, *
dnsize
);

133 
	mcub
::
Th»adStÜe
<
cub
::
STORE_CG
>(
dwl
 + 
queue_šdex
 + 
th»ad_d©a
, 
	m™em
);

136  
	mtÙ®_™ems
;

139 
	m‹m¶©e
 <
ty³Çme
 
	mT
>

140 
__deviû__
 
__fÜûšlše__


141 
push_n™ems
(
n_™ems
, *
™ems
, 
th»ads_³r_block
)

143 
__sh¬ed__
 
ty³Çme
 
	mT
::
TempStÜage
 
‹mp_¡Üage
;

144 
__sh¬ed__
 
	mqueue_šdex
;

145 
	mtÙ®_™ems
;

147 
	mth»ad_d©a
 = 
n_™ems
;

149 
T
(
‹mp_¡Üage
).
ExşusiveSum
(
th»ad_d©a
,h»ad_d©a, 
tÙ®_™ems
);

151 if(
	mth»adIdx
.
	mx
 == 0)

153 
queue_šdex
 = 
©omicAdd
((*è
dšdex
, 
tÙ®_™ems
);

157 
__synùh»ads
();

160 
	mi
 = 0; i < 
	mn_™ems
; i++)

163 if(
	mqueue_šdex
 + 
	mth»ad_d©a
 + 
	mi
 >ğ*
dnsize
)

165 
´štf
("GPU:ƒxûeded†’gth: %d %d %d %d\n", 
queue_šdex
, 
th»ad_d©a
, 
i
, *
dnsize
);

169 
	mdwl
[
queue_šdex
 + 
th»ad_d©a
 + 
i
] = 
™ems
[i];

172  
	mtÙ®_™ems
;

175 
__deviû__


176 
pİ_id
(
id
, &
™em
)

178 if(
	mid
 < *
	mdšdex
)

180 
	m™em
 = 
cub
::
Th»adLßd
<cub::
LOAD_CG
>(
dwl
 + 
id
);

	@cuda_launch_config.hpp

22 #´agm¨
Úû


24 
	~<c¡ddef
>

25 
	~<cuda_ruÁime_­i.h
>

35 
šlše
 
__ho¡__
 
__deviû__


36 
	g¡d
::
size_t
 
block_size_w™h_maximum_pÙ’tŸl_occu·ncy
(cÚ¡ 
cudaFuncA‰ribu‹s
 &
©Œibu‹s
,

37 cÚ¡ 
cudaDeviûPrİ
 &
´İ”t›s
);

50 
	g‹m¶©e
<
ty³Çme
 
	gUÇryFunùiÚ
>

51 
šlše
 
__ho¡__
 
__deviû__


52 
	g¡d
::
size_t
 
block_size_w™h_maximum_pÙ’tŸl_occu·ncy
(cÚ¡ 
cudaFuncA‰ribu‹s
 &
©Œibu‹s
,

53 cÚ¡ 
cudaDeviûPrİ
 &
´İ”t›s
,

54 
UÇryFunùiÚ
 
block_size_to_dyÇmic_smem_size
);

63 
	g‹m¶©e
<
ty³Çme
 
	gT
>

64 
šlše
 
__ho¡__


65 
	g¡d
::
size_t
 
maximum_»sid’cy
(
T
 
t
, cÚ¡ size_ˆ
CTA_SIZE
, cÚ¡ size_ˆ
dyÇmic_smem_by‹s
);

74 
šlše
 
__ho¡__


75 
	g¡d
::
size_t
 
maximum_»sid’cy
(cÚ¡ 
cudaFuncA‰ribu‹s
 &
©Œibu‹s
, cÚ¡ 
cudaDeviûPrİ
 &
´İ”t›s
,

76 
size_t
 
CTA_SIZE
, size_ˆ
dyÇmic_smem_by‹s
);

79 
Çme¥aû
 
	g__cuda_Ïunch_cÚfig_d‘a


82 
usšg
 
	g¡d
::
size_t
;

84 
Çme¥aû
 
	gut


88 
	g‹m¶©e
<
ty³Çme
 
	gT
>

89 
šlše
 
__ho¡__
 
__deviû__


90 
T
 
mš_
(cÚ¡ T &
lhs
, cÚ¡ T &
rhs
)

92  
	grhs
 < 
	glhs
 ?„h : 
lhs
;

96 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

97 
	sz”o_funùiÚ


99 
šlše
 
__ho¡__
 
__deviû__


100 
T
 
İ”©Ü
()(
	gT
)

108 
	g‹m¶©e
<
ty³Çme
 
	gL
,y³Çm
	gR
>

109 
šlše
 
__ho¡__
 
__deviû__
 
L
 
divide_ri
(cÚ¡ L 
x
, cÚ¡ 
R
 
y
)

111  (
	gx
 + (
	gy
 - 1)) / y;

115 
	g‹m¶©e
<
ty³Çme
 
	gL
,y³Çm
	gR
>

116 
šlše
 
__ho¡__
 
__deviû__
 
L
 
divide_rz
(cÚ¡ L 
x
, cÚ¡ 
R
 
y
)

118  
	gx
 / 
	gy
;

122 
	g‹m¶©e
<
ty³Çme
 
	gL
,y³Çm
	gR
>

123 
šlše
 
__ho¡__
 
__deviû__
 
L
 
round_i
(cÚ¡ L 
x
, cÚ¡ 
R
 
y
){  y * 
divide_ri
(x, y); }

126 
	g‹m¶©e
<
ty³Çme
 
	gL
,y³Çm
	gR
>

127 
šlše
 
__ho¡__
 
__deviû__
 
L
 
round_z
(cÚ¡ L 
x
, cÚ¡ 
R
 
y
){  y * 
divide_rz
(x, y); }

134 
šlše
 
__ho¡__
 
__deviû__


135 
size_t
 
smem_®loÿtiÚ_un™
(cÚ¡ 
cudaDeviûPrİ
 &
´İ”t›s
)

137 
	g´İ”t›s
.
	gmajÜ
)

148 
šlše
 
__ho¡__
 
__deviû__


149 
size_t
 
»g_®loÿtiÚ_un™
(cÚ¡ 
cudaDeviûPrİ
 &
´İ”t›s
, cÚ¡ size_ˆ
»gsP”Th»ad
)

151 
	g´İ”t›s
.
	gmajÜ
)

153 1:  (
´İ”t›s
.
mšÜ
 <= 1) ? 256 : 512;

154 2: 
»gsP”Th»ad
)

175 
šlše
 
__ho¡__
 
__deviû__


176 
size_t
 
w¬p_®loÿtiÚ_muÉË
(cÚ¡ 
cudaDeviûPrİ
 &
´İ”t›s
)

178  (
	g´İ”t›s
.
	gmajÜ
 <= 1) ? 2 : 1;

182 
šlše
 
__ho¡__
 
__deviû__


183 
size_t
 
num_sides_³r_muÉroûssÜ
(cÚ¡ 
cudaDeviûPrİ
 &
´İ”t›s
)

185 
	g´İ”t›s
.
	gmajÜ
)

195 
šlše
 
__ho¡__
 
__deviû__


196 
size_t
 
max_blocks_³r_muÉroûssÜ
(cÚ¡ 
cudaDeviûPrİ
 &
´İ”t›s
)

198  (
	g´İ”t›s
.
	gmajÜ
 <= 2) ? 8 : 16;

202 
šlše
 
__ho¡__
 
__deviû__


203 
size_t
 
max_aùive_blocks_³r_muÉroûssÜ
(cÚ¡ 
cudaDeviûPrİ
 &
´İ”t›s
,

204 cÚ¡ 
cudaFuncA‰ribu‹s
 &
©Œibu‹s
,

205 
size_t
 
CTA_SIZE
,

206 
size_t
 
dyÇmic_smem_by‹s
)

214 cÚ¡ 
size_t
 
	gmaxTh»adsP”SM
 = 
´İ”t›s
.
maxTh»adsP”MuÉiProûssÜ
;

215 cÚ¡ 
size_t
 
	gmaxBlocksP”SM
 = 
max_blocks_³r_muÉroûssÜ
(
´İ”t›s
);

218 cÚ¡ 
size_t
 
	gùaLim™Th»ads
 = (
CTA_SIZE
 <ğ
´İ”t›s
.
maxTh»adsP”Block
è? 
maxTh»adsP”SM
 / CTA_SIZE : 0;

219 cÚ¡ 
size_t
 
	gùaLim™Blocks
 = 
maxBlocksP”SM
;

224 cÚ¡ 
size_t
 
	gsmemAÎoÿtiÚUn™
 = 
smem_®loÿtiÚ_un™
(
´İ”t›s
);

225 cÚ¡ 
size_t
 
	gsmemBy‹s
 = 
©Œibu‹s
.
sh¬edSizeBy‹s
 + 
dyÇmic_smem_by‹s
;

226 cÚ¡ 
size_t
 
	gsmemP”CTA
 = 
ut
::
round_i
(
smemBy‹s
, 
smemAÎoÿtiÚUn™
);

229 cÚ¡ 
size_t
 
	gùaLim™SMem
 = 
smemP”CTA
 > 0 ? 
´İ”t›s
.
sh¬edMemP”Block
 / smemP”CTA : 
maxBlocksP”SM
;

234 cÚ¡ 
size_t
 
	g»gAÎoÿtiÚUn™
 = 
»g_®loÿtiÚ_un™
(
´İ”t›s
, 
©Œibu‹s
.
numRegs
);

235 cÚ¡ 
size_t
 
	gw¬pAÎoÿtiÚMuÉË
 = 
w¬p_®loÿtiÚ_muÉË
(
´İ”t›s
);

236 cÚ¡ 
size_t
 
	gnumW¬ps
 = 
ut
::
round_i
(ut::
divide_ri
(
CTA_SIZE
, 
´İ”t›s
.
w¬pSize
), 
w¬pAÎoÿtiÚMuÉË
);

239 
size_t
 
	gùaLim™Regs
;

240 if(
	g´İ”t›s
.
	gmajÜ
 <= 1)

244 cÚ¡ 
size_t
 
»gsP”CTA
 = 
ut
::
round_i
(
©Œibu‹s
.
numRegs
 * 
´İ”t›s
.
w¬pSize
 * 
numW¬ps
, 
»gAÎoÿtiÚUn™
);

245 
	gùaLim™Regs
 = 
»gsP”CTA
 > 0 ? 
´İ”t›s
.
»gsP”Block
 /„egsP”CTA : 
maxBlocksP”SM
;

251 cÚ¡ 
size_t
 
	g»gsP”W¬p
 = 
ut
::
round_i
(
©Œibu‹s
.
numRegs
 * 
´İ”t›s
.
w¬pSize
, 
»gAÎoÿtiÚUn™
);

252 cÚ¡ 
size_t
 
	gnumSides
 = 
num_sides_³r_muÉroûssÜ
(
´İ”t›s
);

253 cÚ¡ 
size_t
 
	gnumRegsP”Side
 = 
´İ”t›s
.
»gsP”Block
 / 
numSides
;

254 
	gùaLim™Regs
 = 
»gsP”W¬p
 > 0 ? ((
numRegsP”Side
 /„egsP”W¬pè* 
numSides
è/ 
numW¬ps
 : 
maxBlocksP”SM
;

260  
	gut
::
mš_
(
ùaLim™Regs
, 
ut
::mš_(
ùaLim™SMem
, ut::mš_(
ùaLim™Th»ads
, 
ùaLim™Blocks
)));

264 
	g‹m¶©e
 <
ty³Çme
 
	gUÇryFunùiÚ
>

265 
šlše
 
__ho¡__
 
__deviû__


266 
size_t
 
deçuÉ_block_size
(cÚ¡ 
cudaDeviûPrİ
 &
´İ”t›s
,

267 cÚ¡ 
cudaFuncA‰ribu‹s
 &
©Œibu‹s
,

268 
UÇryFunùiÚ
 
block_size_to_smem_size
)

270 
size_t
 
	gmax_occu·ncy
 = 
´İ”t›s
.
maxTh»adsP”MuÉiProûssÜ
;

271 
size_t
 
	gÏrge¡_blocksize
 = 
ut
::
mš_
(
´İ”t›s
.
maxTh»adsP”Block
, 
©Œibu‹s
.maxThreadsPerBlock);

272 
size_t
 
	gg¿nuÏr™y
 = 
´İ”t›s
.
w¬pSize
;

273 
size_t
 
	gmax_blocksize
 = 0;

274 
size_t
 
	ghighe¡_occu·ncy
 = 0;

276 
size_t
 
	gblocksize
 = 
Ïrge¡_blocksize
; blocksiz!ğ0; blocksiz-ğ
g¿nuÏr™y
)

278 
size_t
 
occu·ncy
 = 
blocksize
 * 
max_aùive_blocks_³r_muÉroûssÜ
(
´İ”t›s
, 
©Œibu‹s
, blocksize, 
block_size_to_smem_size
(blocksize));

280 if(
	goccu·ncy
 > 
	ghighe¡_occu·ncy
)

282 
	gmax_blocksize
 = 
blocksize
;

283 
	ghighe¡_occu·ncy
 = 
occu·ncy
;

287 if(
	ghighe¡_occu·ncy
 =ğ
max_occu·ncy
)

291  
	gmax_blocksize
;

298 
	g‹m¶©e
<
ty³Çme
 
	gUÇryFunùiÚ
>

299 
šlše
 
__ho¡__
 
__deviû__


300 
	g¡d
::
size_t
 
	$block_size_w™h_maximum_pÙ’tŸl_occu·ncy
(cÚ¡ 
cudaFuncA‰ribu‹s
 &
©Œibu‹s
,

301 cÚ¡ 
cudaDeviûPrİ
 &
´İ”t›s
,

302 
UÇryFunùiÚ
 
block_size_to_dyÇmic_smem_size
)

304  
__cuda_Ïunch_cÚfig_d‘a
::
	`deçuÉ_block_size
(
´İ”t›s
, 
©Œibu‹s
, 
block_size_to_dyÇmic_smem_size
);

305 
	}
}

308 
šlše
 
__ho¡__
 
__deviû__


309 
	g¡d
::
size_t
 
	$block_size_w™h_maximum_pÙ’tŸl_occu·ncy
(cÚ¡ 
cudaFuncA‰ribu‹s
 &
©Œibu‹s
,

310 cÚ¡ 
cudaDeviûPrİ
 &
´İ”t›s
)

312  
	`block_size_w™h_maximum_pÙ’tŸl_occu·ncy
(
©Œibu‹s
, 
´İ”t›s
, 
__cuda_Ïunch_cÚfig_d‘a
::
ut
::
z”o_funùiÚ
<
¡d
::
size_t
>());

313 
	}
}

315 
	g‹m¶©e
<
ty³Çme
 
	gT
>

316 
šlše
 
__ho¡__


317 
	g¡d
::
size_t
 
	$block_size_w™h_maximum_pÙ’tŸl_occu·ncy
(
T
 
t
)

319 
cudaE¼Ü_t
 
”r
;

320 
cudaFuncA‰ribu‹s
 
©Œibu‹s
;

321 
”r
 = 
	`cudaFuncG‘A‰ribu‹s
(&
©Œibu‹s
, 
t
);

323 ià(
”r
 !ğ
cudaSucûss
)

326 
deviû
;

327 
”r
 = 
	`cudaG‘Deviû
(&
deviû
);

329 ià(
”r
 !ğ
cudaSucûss
)

332 
cudaDeviûPrİ
 
´İ”t›s
;

333 
”r
 = 
	`cudaG‘DeviûPrİ”t›s
(&
´İ”t›s
, 
deviû
);

335 ià(
”r
 !ğ
cudaSucûss
)

338  
	`block_size_w™h_maximum_pÙ’tŸl_occu·ncy
(
©Œibu‹s
, 
´İ”t›s
);

339 
	}
}

341 
šlše
 
__ho¡__


342 
	g¡d
::
size_t
 
	$maximum_»sid’cy
(cÚ¡ 
cudaFuncA‰ribu‹s
 &
©Œibu‹s
, cÚ¡ 
cudaDeviûPrİ
 &
´İ”t›s
,

343 
size_t
 
CTA_SIZE
, size_ˆ
dyÇmic_smem_by‹s
)

345  
__cuda_Ïunch_cÚfig_d‘a
::
	`max_aùive_blocks_³r_muÉroûssÜ
(
´İ”t›s
, 
©Œibu‹s
, 
CTA_SIZE
, 
dyÇmic_smem_by‹s
);

346 
	}
}

348 
	g‹m¶©e
<
ty³Çme
 
	gT
>

349 
šlše
 
__ho¡__


350 
	g¡d
::
size_t
 
	$maximum_»sid’cy
(
T
 
t
, 
size_t
 
CTA_SIZE
, size_ˆ
dyÇmic_smem_by‹s
)

352 
cudaE¼Ü_t
 
”r
;

353 
cudaFuncA‰ribu‹s
 
©Œibu‹s
;

354 
”r
 = 
	`cudaFuncG‘A‰ribu‹s
(&
©Œibu‹s
, 
t
);

356 ià(
”r
 !ğ
cudaSucûss
)

359 
deviû
;

360 
”r
 = 
	`cudaG‘Deviû
(&
deviû
);

362 ià(
”r
 !ğ
cudaSucûss
)

365 
cudaDeviûPrİ
 
´İ”t›s
;

366 
”r
 = 
	`cudaG‘DeviûPrİ”t›s
(&
´İ”t›s
, 
deviû
);

368 ià(
”r
 !ğ
cudaSucûss
)

371  
	`maximum_»sid’cy
(
©Œibu‹s
, 
´İ”t›s
, 
CTA_SIZE
, 
dyÇmic_smem_by‹s
);

372 
	}
}

	@
1
.
0
29
398
BorderVertMapping.h
EMS_x86_64.h
PartitionVertexMapping.h
Structs.h
backward_phase.cu
bc.cu
bfs_ddV3.cu
bfs_worklistc.cu
common.h
cpu_ddV3.cu
cpu_nodebased.cu
cudaKernels.h
cutil_subset.h
gbar.cuh
gcc_cuda_compat.h
graph28.h
kernelconfig.h
list.h
myutils.h
myutils2.h
partition_metis.cu
partition_patoh.cu
patoh.h
scheduler19.h
utils.h
worklist7.h
worklist_cpu.h
worklistc.h
cuda_launch_config.hpp
